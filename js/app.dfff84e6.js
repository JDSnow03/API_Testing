(function(e){function t(t){for(var n,a,s=t[0],r=t[1],i=t[2],d=0,u=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(c,a)&&c[a]&&u.push(c[a][0]),c[a]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);b&&b(t);while(u.length)u.shift()();return l.push.apply(l,i||[]),o()}function o(){for(var e,t=0;t<l.length;t++){for(var o=l[t],n=!0,a=1;a<o.length;a++){var r=o[a];0!==c[r]&&(n=!1)}n&&(l.splice(t--,1),e=s(s.s=o[0]))}return e}var n={},c={app:0},l=[];function a(e){return s.p+"js/"+({}[e]||e)+"."+{"chunk-2d0d6e77":"e4320951"}[e]+".js"}function s(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.e=function(e){var t=[],o=c[e];if(0!==o)if(o)t.push(o[2]);else{var n=new Promise((function(t,n){o=c[e]=[t,n]}));t.push(o[2]=n);var l,r=document.createElement("script");r.charset="utf-8",r.timeout=120,s.nc&&r.setAttribute("nonce",s.nc),r.src=a(e);var i=new Error;l=function(t){r.onerror=r.onload=null,clearTimeout(d);var o=c[e];if(0!==o){if(o){var n=t&&("load"===t.type?"missing":t.type),l=t&&t.target&&t.target.src;i.message="Loading chunk "+e+" failed.\n("+n+": "+l+")",i.name="ChunkLoadError",i.type=n,i.request=l,o[1](i)}c[e]=void 0}};var d=setTimeout((function(){l({type:"timeout",target:r})}),12e4);r.onerror=r.onload=l,document.head.appendChild(r)}return Promise.all(t)},s.m=e,s.c=n,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(o,n,function(t){return e[t]}.bind(null,n));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/API_Testing/",s.oe=function(e){throw console.error(e),e};var r=window["webpackJsonp"]=window["webpackJsonp"]||[],i=r.push.bind(r);r.push=t,r=r.slice();for(var d=0;d<r.length;d++)t(r[d]);var b=i;l.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("56d7")},"008a":function(e,t,o){},"01e0":function(e,t,o){"use strict";o("e54c")},"0c21":function(e,t,o){},"17af":function(e,t,o){"use strict";o("1eaa")},1884:function(e,t,o){},"1ca3":function(e,t,o){"use strict";o("1884")},"1eaa":function(e,t,o){},"1ed8":function(e,t,o){"use strict";o("67c8")},"2cca":function(e,t,o){},"3ba0":function(e,t,o){"use strict";o("7ce1")},"43c3":function(e,t,o){},"4a7c":function(e,t,o){},"4c75":function(e,t,o){},5542:function(e,t,o){},"56d7":function(e,t,o){"use strict";o.r(t);var n=o("7a23");const c={id:"app"};function l(e,t,o,l,a,s){const r=Object(n["resolveComponent"])("router-view");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",c,[Object(n["createVNode"])(r)])}var a={name:"App",name:"App",mounted(){document.title="Print-A-Test"}},s=(o("c4f7"),o("6b0d")),r=o.n(s);const i=r()(a,[["render",l]]);var d=i,b=o("6605");const u={class:"theme-welcome"},m={class:"button-container"},p={class:"button-container"},h={class:"button-container"};function O(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",u,[t[3]||(t[3]=Object(n["createElementVNode"])("div",{class:"top-banner"},[Object(n["createElementVNode"])("div",{class:"banner-title"},"Welcome to Print-A-Test")],-1)),t[4]||(t[4]=Object(n["createElementVNode"])("div",{class:"center large-paragraph",style:{color:"#222"}}," Select the role you are logging in as:",-1)),Object(n["createElementVNode"])("div",m,[Object(n["createVNode"])(s,{to:"/TeacherLog"},{default:Object(n["withCtx"])(()=>t[0]||(t[0]=[Object(n["createElementVNode"])("button",{class:"button"},"Teacher",-1)])),_:1})]),t[5]||(t[5]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("div",p,[Object(n["createVNode"])(s,{to:"/PubLog"},{default:Object(n["withCtx"])(()=>t[1]||(t[1]=[Object(n["createElementVNode"])("button",{class:"button"},"Publisher",-1)])),_:1})]),t[6]||(t[6]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("div",h,[Object(n["createVNode"])(s,{to:"/WebmasterLog"},{default:Object(n["withCtx"])(()=>t[2]||(t[2]=[Object(n["createElementVNode"])("button",{class:"button"},"Webmaster",-1)])),_:1})])])}var j={name:"Welcome"};o("3ba0");const k=r()(j,[["render",O],["__scopeId","data-v-e7dbd576"]]);var g=k;const N={class:"theme-publisher"},E={class:"top-banner"},V={class:"banner-actions"},y={class:"center large-paragraph",style:{color:"#222"}},f={class:"page-wrapper"},w={class:"button-row"},v={key:0,class:"p_dropdown"},_={class:"p_dropdown-content"},B={key:1};function T(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",N,[Object(n["createElementVNode"])("div",E,[t[1]||(t[1]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Textbook Selection",-1)),Object(n["createElementVNode"])("div",V,[Object(n["createVNode"])(s,{to:"/",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[0]||(t[0]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",y,[Object(n["createElementVNode"])("div",f,[t[5]||(t[5]=Object(n["createTextVNode"])(" Please select or add a textbook: ")),Object(n["createElementVNode"])("div",w,[l.textbooks.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",v,[t[2]||(t[2]=Object(n["createElementVNode"])("button",{class:"p_dropbtn"},"Select Textbook",-1)),Object(n["createElementVNode"])("div",_,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.textbooks,e=>(Object(n["openBlock"])(),Object(n["createBlock"])(s,{key:e.id,to:{path:"PubQuestions",query:{title:e.title,textbook_id:e.id}}},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.title),1)]),_:2},1032,["to"]))),128))])])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",B," No courses available. ")),Object(n["createVNode"])(s,{to:"PubNewBook"},{default:Object(n["withCtx"])(()=>t[3]||(t[3]=[Object(n["createElementVNode"])("button",{class:"p_button"},"Add New Textbook",-1)])),_:1}),t[4]||(t[4]=Object(n["createElementVNode"])("br",null,null,-1))])])])])}var x=o("cee4");const C=x["a"].create({baseURL:"https://api-testing-yfy6.onrender.com",responseType:"json"});async function F(){const e=localStorage.getItem("token");if(!e)return null;try{const t=await x["a"].post("https://api-testing-yfy6.onrender.com/auth/refresh",{token:e}),o=t.data.token;return localStorage.setItem("token",o),o}catch(t){return console.error("Token refresh failed:",t),localStorage.removeItem("token"),localStorage.removeItem("user_id"),localStorage.removeItem("role"),null}}C.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer "+t),e},e=>Promise.reject(e)),C.interceptors.response.use(e=>e,async e=>{const t=e.config;if(e.response&&401===e.response.status&&!t._retry){t._retry=!0;const e=await F();if(e)return t.headers.Authorization="Bearer "+e,C(t);console.warn("Token refresh failed or user logged out.")}return Promise.reject(e)});var S=C,I=o("f761"),D={name:"PublisherHome",data(){return{textbooks:[],error:null}},created(){this.fetchTextbooks()},methods:{async fetchTextbooks(){try{console.log("Fetching textbooks...");const e=await S.get("/textbooks",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Textbooks fetched:",e.data),e.data&&e.data.textbooks?this.textbooks=e.data.textbooks:this.error="Failed to fetch textbooks data."}catch(e){console.error("Error fetching textbooks:",e),e.response?this.error=`Error: ${e.response.status} - ${e.response.data.message||e.response.statusText}`:this.error="Network error or server is not responding."}}}};o("6a83");const q=r()(D,[["render",T],["__scopeId","data-v-46fbfbd4"]]);var A=q;const Q={class:"theme-publisher"},P={class:"center large-paragraph",style:{color:"#222"}},M=["disabled"],U={key:0,class:"error-message"},$={key:1,class:"loading-message"};function L(e,t,o,c,l,a){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Q,[t[14]||(t[14]=Object(n["createElementVNode"])("div",{class:"top-banner"},[Object(n["createElementVNode"])("div",{class:"banner-title"},"Publisher Login")],-1)),Object(n["createElementVNode"])("div",P,[t[11]||(t[11]=Object(n["createTextVNode"])(" Please enter your publisher username and password: ")),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("form",{onSubmit:t[2]||(t[2]=Object(n["withModifiers"])((...e)=>a.submitForm&&a.submitForm(...e),["prevent"]))},[t[3]||(t[3]=Object(n["createElementVNode"])("label",{for:"uname"},"Username:",-1)),t[4]||(t[4]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"uname","onUpdate:modelValue":t[0]||(t[0]=e=>l.username=e)},null,512),[[n["vModelText"],l.username]]),t[5]||(t[5]=Object(n["createElementVNode"])("br",null,null,-1)),t[6]||(t[6]=Object(n["createElementVNode"])("br",null,null,-1)),t[7]||(t[7]=Object(n["createElementVNode"])("label",{for:"pass"},"Password:",-1)),t[8]||(t[8]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"password",id:"pass","onUpdate:modelValue":t[1]||(t[1]=e=>l.password=e)},null,512),[[n["vModelText"],l.password]]),t[9]||(t[9]=Object(n["createElementVNode"])("br",null,null,-1)),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("input",{type:"submit",value:"Submit",disabled:l.loading},null,8,M)],32),l.errorMessage?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",U,Object(n["toDisplayString"])(l.errorMessage),1)):Object(n["createCommentVNode"])("",!0),l.loading?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",$,"Logging in...")):Object(n["createCommentVNode"])("",!0)])])}var z={data(){return{username:"",password:"",errorMessage:"",loading:!1}},mounted(){const e=localStorage.getItem("token");if(e)try{const t=Object(I["default"])(e),o=Date.now()/1e3;t.exp>o&&"publisher"===t.role&&this.$router.push("/PubHome")}catch(t){console.error("Invalid token",t)}},methods:{async submitForm(){if(this.username&&this.password)if(this.username.trim().length<3||this.password.trim().length<6)this.errorMessage="Username must be at least 3 characters and password at least 6 characters.";else{this.loading=!0,this.errorMessage="";try{const e=await S.post("/auth/login",{username:this.username.toLowerCase(),password:this.password}),{token:t,user_id:o,role:n}=e.data;localStorage.setItem("token",t),localStorage.setItem("user_id",o),localStorage.setItem("role",n),"publisher"===n?this.$router.push("/PubHome"):(this.errorMessage="Only publishers can log in here.",localStorage.clear())}catch(e){e.response?401===e.response.status?this.errorMessage="Invalid username or password.":this.errorMessage=e.response&&e.response.data&&e.response.data.message||"An error occurred during login.":this.errorMessage="Network error. Please check your connection."}finally{this.loading=!1}}else this.errorMessage="Please enter both username and password."}}};o("17af");const R=r()(z,[["render",L],["__scopeId","data-v-800dd872"]]);var H=R;const W={class:"theme-publisher"},J={class:"top-banner"},G={class:"banner-actions"},K={class:"center large-paragraph",style:{color:"#222"}};function Y(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",W,[Object(n["createElementVNode"])("div",J,[t[8]||(t[8]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Add New Textbook",-1)),Object(n["createElementVNode"])("div",G,[Object(n["createVNode"])(s,{to:"/PubHome",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[6]||(t[6]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[7]||(t[7]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",K,[Object(n["createElementVNode"])("form",{onSubmit:t[5]||(t[5]=Object(n["withModifiers"])((...e)=>a.saveBook&&a.saveBook(...e),["prevent"]))},[t[9]||(t[9]=Object(n["createElementVNode"])("label",{for:"textbookTitle"},"Textbook Title:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"textbookTitle","onUpdate:modelValue":t[0]||(t[0]=e=>l.textbookTitle=e),style:{height:"20px"}},null,512),[[n["vModelText"],l.textbookTitle]]),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),t[11]||(t[11]=Object(n["createElementVNode"])("label",{for:"author"},"Author:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"author","onUpdate:modelValue":t[1]||(t[1]=e=>l.author=e),style:{height:"20px"}},null,512),[[n["vModelText"],l.author]]),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("label",{for:"ISBN"},"ISBN:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"ISBN","onUpdate:modelValue":t[2]||(t[2]=e=>l.ISBN=e),style:{height:"20px"}},null,512),[[n["vModelText"],l.ISBN]]),t[14]||(t[14]=Object(n["createElementVNode"])("br",null,null,-1)),t[15]||(t[15]=Object(n["createElementVNode"])("label",{for:"version"},"Version:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"version","onUpdate:modelValue":t[3]||(t[3]=e=>l.version=e),style:{height:"20px"}},null,512),[[n["vModelText"],l.version]]),t[16]||(t[16]=Object(n["createElementVNode"])("br",null,null,-1)),t[17]||(t[17]=Object(n["createElementVNode"])("label",{for:"websiteLink"},"Website Link:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"websiteLink","onUpdate:modelValue":t[4]||(t[4]=e=>l.websiteLink=e),style:{height:"20px"}},null,512),[[n["vModelText"],l.websiteLink]]),t[18]||(t[18]=Object(n["createElementVNode"])("br",null,null,-1)),t[19]||(t[19]=Object(n["createElementVNode"])("div",{class:"center large-heading"},[Object(n["createElementVNode"])("input",{type:"submit",value:"Save"})],-1))],32)])])}var X={name:"PublisherNewBook",data(){return{textbookTitle:"",author:"",ISBN:"",version:"",websiteLink:""}},methods:{async saveBook(){if(this.textbookTitle&&this.author&&this.ISBN&&this.version){const t={textbook_title:this.textbookTitle,textbook_author:this.author,textbook_isbn:this.ISBN,textbook_version:this.version,websiteLink:this.websiteLink};try{const e=await S.post("/textbooks",t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Book saved successfully:",e.data),this.$router.push({path:"/PubHome"})}catch(e){console.error("Error saving book:",e),alert("Failed to save the book. Please try again.")}}else alert("Please fill out all fields.")}}};o("8d2b");const Z=r()(X,[["render",Y],["__scopeId","data-v-4c95a948"]]);var ee=Z;const te={class:"theme-publisher"},oe={class:"top-banner"},ne={class:"banner-actions"},ce={class:"center large-paragraph",style:{color:"#222"}},le={key:0,style:{color:"red","margin-top":"10px"}};function ae(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",te,[Object(n["createElementVNode"])("div",oe,[t[6]||(t[6]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Create New Draft Pool",-1)),Object(n["createElementVNode"])("div",ne,[Object(n["createVNode"])(s,{to:"/PubHome",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[4]||(t[4]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[5]||(t[5]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",ce,[Object(n["createElementVNode"])("form",{onSubmit:t[3]||(t[3]=Object(n["withModifiers"])((...e)=>a.saveTestBank&&a.saveTestBank(...e),["prevent"]))},[t[7]||(t[7]=Object(n["createElementVNode"])("label",{for:"bankName"},"Name of Draft Pool:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"bankName","onUpdate:modelValue":t[0]||(t[0]=e=>l.bankName=e),style:{height:"20px"},required:""},null,512),[[n["vModelText"],l.bankName]]),t[8]||(t[8]=Object(n["createElementVNode"])("br",null,null,-1)),t[9]||(t[9]=Object(n["createElementVNode"])("label",{for:"bankCh"},"Textbook Chapter:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"bankCh","onUpdate:modelValue":t[1]||(t[1]=e=>l.bankChapter=e)},null,512),[[n["vModelText"],l.bankChapter]]),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),t[11]||(t[11]=Object(n["createElementVNode"])("label",{for:"bankSec"},"Textbook Section:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"bankSec","onUpdate:modelValue":t[2]||(t[2]=e=>l.bankSection=e)},null,512),[[n["vModelText"],l.bankSection]]),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("input",{type:"submit",value:"Submit"},null,-1))],32),l.error?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",le,Object(n["toDisplayString"])(l.error),1)):Object(n["createCommentVNode"])("",!0)])])}var se={name:"PublisherNewTB",data(){return{bankName:"",bankChapter:"",bankSection:"",textbookId:this.$route.query.textbook_id||"",textbookTitle:this.$route.query.title||"",error:null}},methods:{async saveTestBank(){if(this.bankName&&this.bankChapter&&this.bankSection&&this.textbookId){const t={testbank_name:this.bankName,chapter_number:this.bankChapter,section_number:this.bankSection,textbook_id:this.textbookId};try{const e=await S.post("/testbanks/publisher",t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Test bank saved successfully:",e.data),this.$router.push({path:"/PubQuestions",query:{title:this.textbookTitle,textbook_id:this.textbookId}})}catch(e){console.error("Error saving test bank:",e)}}}}};o("716a");const re=r()(se,[["render",ae],["__scopeId","data-v-6c70d6b4"]]);var ie=re;const de={class:"theme-publisher"},be={class:"top-banner"},ue={class:"banner-title"},me={class:"banner-actions"},pe={key:0,class:"popup-overlay"},he={class:"form-popup-modal"},Oe={class:"page-wrapper"},je={class:"button-row"},ke={class:"p_dropdown"},ge={class:"p_dropbtn"},Ne={class:"p_dropdown-content"},Ee=["onClick"],Ve={class:"p_dropdown"},ye={class:"p_dropdown-content"},fe={id:"selectedQuestionType",style:{color:"#222"},class:"center large-paragraph"},we=["onClick"],ve={key:0,style:{"margin-top":"10px"}},_e=["src"],Be={key:1},Te={key:2},xe={key:3},Ce={key:4},Fe={key:5,class:"p_button-group"},Se=["onClick"],Ie=["onClick"],De=["onClick"],qe={key:0,class:"popup-overlay"},Ae={class:"form-popup-modal"},Qe={class:"form-container",style:{display:"flex","flex-direction":"column","align-items":"center",gap:"10px","margin-top":"1rem"}},Pe=["onClick"],Me={class:"popup-overlay"},Ue={class:"form-popup-modal"},$e={key:0},Le=["value"],ze={key:1},Re={key:2},He={key:3},We={key:4},Je=["onUpdate:modelValue"],Ge=["onUpdate:modelValue"],Ke=["onClick"],Ye={key:5},Xe={key:6},Ze={key:7},et=["src"],tt={key:8},ot=["src"];function nt(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",de,[Object(n["createElementVNode"])("div",be,[Object(n["createElementVNode"])("div",ue,Object(n["toDisplayString"])(l.textbookTitle),1),Object(n["createElementVNode"])("div",me,[Object(n["createVNode"])(s,{to:"/PubHome",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[25]||(t[25]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[26]||(t[26]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),l.editBlockedPopup?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",pe,[Object(n["createElementVNode"])("div",he,[t[27]||(t[27]=Object(n["createElementVNode"])("h2",null,"Cannot Edit Question",-1)),Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(l.editBlockedReason),1),t[28]||(t[28]=Object(n["createElementVNode"])("p",null,"A new copy will be made instead.",-1)),Object(n["createElementVNode"])("button",{class:"btn",onClick:t[0]||(t[0]=(...e)=>a.createCopyInstead&&a.createCopyInstead(...e))},"Create a Copy"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[1]||(t[1]=e=>l.editBlockedPopup=!1)},"Cancel")])])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",Oe,[Object(n["createElementVNode"])("div",je,[Object(n["createElementVNode"])("div",ke,[Object(n["createElementVNode"])("button",ge,Object(n["toDisplayString"])(l.selectedTestBank?l.selectedTestBank.name:"Select Draft Pool"),1),Object(n["createElementVNode"])("div",Ne,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.testBanks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("a",{key:e.testbank_id,href:"#",onClick:Object(n["withModifiers"])(t=>a.selectTestBank(e),["prevent"])},Object(n["toDisplayString"])(e.name),9,Ee))),128))])]),Object(n["createVNode"])(s,{to:{path:"PubNewTB",query:{title:l.textbookTitle,textbook_id:l.textbookId}}},{default:Object(n["withCtx"])(()=>t[29]||(t[29]=[Object(n["createElementVNode"])("button",{class:"p_button"},"New Draft Pool",-1)])),_:1},8,["to"]),Object(n["createElementVNode"])("div",Ve,[t[30]||(t[30]=Object(n["createElementVNode"])("button",{class:"p_dropbtn"},"Question Type",-1)),Object(n["createElementVNode"])("div",ye,[Object(n["createElementVNode"])("a",{onClick:t[2]||(t[2]=e=>a.fetchQuestions("True/False"))},"True/False"),Object(n["createElementVNode"])("a",{onClick:t[3]||(t[3]=e=>a.fetchQuestions("Multiple Choice"))},"Multiple Choice"),Object(n["createElementVNode"])("a",{onClick:t[4]||(t[4]=e=>a.fetchQuestions("Matching"))},"Matching"),Object(n["createElementVNode"])("a",{onClick:t[5]||(t[5]=e=>a.fetchQuestions("Fill in the Blank"))},"Fill in the Blank"),Object(n["createElementVNode"])("a",{onClick:t[6]||(t[6]=e=>a.fetchQuestions("Short Answer"))},"Short Answer"),Object(n["createElementVNode"])("a",{onClick:t[7]||(t[7]=e=>a.fetchQuestions("Essay"))},"Essay")])]),Object(n["createElementVNode"])("button",{class:"p_button",onClick:t[8]||(t[8]=(...e)=>a.edit&&a.edit(...e))},"New Question")]),Object(n["createElementVNode"])("div",fe,Object(n["toDisplayString"])(l.selectedQuestionType),1),t[73]||(t[73]=Object(n["createElementVNode"])("hr",null,null,-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.questions,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:o,class:Object(n["normalizeClass"])(["p_question-box",{selected:l.selectedQuestionId===e.id}]),onClick:t=>a.toggleQuestionSelection(e.id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.text),1),t[45]||(t[45]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[31]||(t[31]=Object(n["createElementVNode"])("strong",null,"Type:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.type),1)]),t[46]||(t[46]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[32]||(t[32]=Object(n["createElementVNode"])("strong",null,"Chapter:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.chapter||"N/A"),1)]),t[47]||(t[47]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[33]||(t[33]=Object(n["createElementVNode"])("strong",null,"Section:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.section||"N/A"),1)]),t[48]||(t[48]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[34]||(t[34]=Object(n["createElementVNode"])("strong",null,"Points:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.points),1)]),t[49]||(t[49]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[35]||(t[35]=Object(n["createElementVNode"])("strong",null,"Estimated Time:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.time)+" minutes",1)]),t[50]||(t[50]=Object(n["createElementVNode"])("br",null,null,-1)),e.image_url?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ve,[t[36]||(t[36]=Object(n["createElementVNode"])("strong",null,"Attached Image:",-1)),t[37]||(t[37]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("img",{src:e.image_url,alt:"Attached Image",style:{"max-width":"100%","margin-top":"5px"}},null,8,_e)])):Object(n["createCommentVNode"])("",!0),"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Be,[t[38]||(t[38]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.answer?"True":"False"),1)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Te,[t[39]||(t[39]=Object(n["createElementVNode"])("strong",null,"Correct Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.correctOption&&e.correctOption.option_text||"Not specified"),1),t[40]||(t[40]=Object(n["createElementVNode"])("br",null,null,-1)),t[41]||(t[41]=Object(n["createElementVNode"])("strong",null,"Other Options:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.incorrectOptions,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.option_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",xe,[t[42]||(t[42]=Object(n["createElementVNode"])("strong",null,"Pairs:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.pairs,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.term)+" - "+Object(n["toDisplayString"])(e.definition),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ce,[t[43]||(t[43]=Object(n["createElementVNode"])("strong",null,"Correct Answer(s):",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.blanks,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.correct_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("span",null,[t[44]||(t[44]=Object(n["createElementVNode"])("strong",null,"Grading Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.instructions||"None"),1)]),l.selectedQuestionId===e.id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Fe,[e.is_published?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:0,onClick:Object(n["withModifiers"])(t=>a.editQuestion(e),["stop"])},"Edit",8,Se)),e.is_published?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:1,onClick:Object(n["withModifiers"])(t=>a.deleteQuestion(e.id),["stop"])},"Delete",8,Ie)),Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>a.openAddToTestBank(e.id),["stop"])},"Add to Draft Pool",8,De)])):Object(n["createCommentVNode"])("",!0)],10,we))),128))]),l.showAddToTBModal?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",qe,[Object(n["createElementVNode"])("div",Ae,[t[51]||(t[51]=Object(n["createElementVNode"])("h2",{style:{"text-align":"center"}},"Select Draft Pool",-1)),Object(n["createElementVNode"])("div",Qe,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.testBanks.filter(e=>!e.is_published),e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:e.testbank_id,class:"t_button",style:{width:"100%"},onClick:t=>a.assignQuestionToTestBank(e.testbank_id)},Object(n["toDisplayString"])(e.name),9,Pe))),128)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",style:{width:"100%"},onClick:t[9]||(t[9]=(...e)=>a.closeAddToTBModal&&a.closeAddToTBModal(...e))}," Close ")])])])):Object(n["createCommentVNode"])("",!0),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",Me,[Object(n["createElementVNode"])("div",Ue,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[24]||(t[24]=Object(n["withModifiers"])((...e)=>a.handleQuestionSave&&a.handleQuestionSave(...e),["prevent"]))},[Object(n["createElementVNode"])("h1",null,Object(n["toDisplayString"])(l.editingQuestionId?"Edit Question":"New Question"),1),t[59]||(t[59]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Chapter Number")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=e=>l.questionData.chapter=e),required:""},null,512),[[n["vModelText"],l.questionData.chapter]]),t[60]||(t[60]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Section Number")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=e=>l.questionData.section=e),required:""},null,512),[[n["vModelText"],l.questionData.section]]),t[61]||(t[61]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Question Type"),Object(n["createElementVNode"])("br")],-1)),l.editingQuestionId?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",$e,[Object(n["createElementVNode"])("input",{type:"text",value:l.selectedQuestionType,disabled:"",class:"readonly-input"},null,8,Le)])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ze,[Object(n["withDirectives"])(Object(n["createElementVNode"])("select",{"onUpdate:modelValue":t[12]||(t[12]=e=>l.selectedQuestionType=e),required:""},t[52]||(t[52]=[Object(n["createElementVNode"])("option",{disabled:"",value:""},"Select a type",-1),Object(n["createElementVNode"])("option",null,"True/False",-1),Object(n["createElementVNode"])("option",null,"Multiple Choice",-1),Object(n["createElementVNode"])("option",null,"Matching",-1),Object(n["createElementVNode"])("option",null,"Fill in the Blank",-1),Object(n["createElementVNode"])("option",null,"Short Answer",-1),Object(n["createElementVNode"])("option",null,"Essay",-1)]),512),[[n["vModelSelect"],l.selectedQuestionType]])])),t[62]||(t[62]=Object(n["createElementVNode"])("br",null,null,-1)),t[63]||(t[63]=Object(n["createElementVNode"])("br",null,null,-1)),t[64]||(t[64]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Question Text")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>l.questionData.question=e),required:""},null,512),[[n["vModelText"],l.questionData.question]]),"True/False"===l.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Re,[t[54]||(t[54]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("select",{"onUpdate:modelValue":t[14]||(t[14]=e=>l.questionData.answer=e)},t[53]||(t[53]=[Object(n["createElementVNode"])("option",{value:"True"},"True",-1),Object(n["createElementVNode"])("option",{value:"False"},"False",-1)]),512),[[n["vModelSelect"],l.questionData.answer]])])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===l.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",He,[t[55]||(t[55]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Correct Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=e=>l.questionData.answer=e)},null,512),[[n["vModelText"],l.questionData.answer]]),t[56]||(t[56]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Incorrect Answer Choices (comma-separated)")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[16]||(t[16]=e=>l.questionData.answerChoices=e)},null,512),[[n["vModelText"],l.questionData.answerChoices]])])):Object(n["createCommentVNode"])("",!0),"Matching"===l.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",We,[t[57]||(t[57]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Matching Pairs")],-1)),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.matchingPairs,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:t},[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t=>e.term=t,placeholder:"Term"},null,8,Je),[[n["vModelText"],e.term]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t=>e.definition=t,placeholder:"Definition"},null,8,Ge),[[n["vModelText"],e.definition]]),Object(n["createElementVNode"])("button",{type:"button",onClick:e=>a.removePair(t)},"Remove",8,Ke)]))),128)),Object(n["createElementVNode"])("button",{type:"button",onClick:t[17]||(t[17]=(...e)=>a.addPair&&a.addPair(...e))},"Add Pair")])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===l.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ye,[t[58]||(t[58]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Correct Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[18]||(t[18]=e=>l.questionData.answer=e)},null,512),[[n["vModelText"],l.questionData.answer]])])):Object(n["createCommentVNode"])("",!0),"Essay"===l.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Xe)):Object(n["createCommentVNode"])("",!0),t[65]||(t[65]=Object(n["createElementVNode"])("br",null,null,-1)),t[66]||(t[66]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Points Worth")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[19]||(t[19]=e=>l.questionData.points=e),required:""},null,512),[[n["vModelText"],l.questionData.points]]),t[67]||(t[67]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Estimated Time (in minutes)")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[20]||(t[20]=e=>l.questionData.time=e),required:""},null,512),[[n["vModelText"],l.questionData.time]]),t[68]||(t[68]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Grading Instructions")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[21]||(t[21]=e=>l.questionData.instructions=e),required:""},null,512),[[n["vModelText"],l.questionData.instructions]]),t[69]||(t[69]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Attached Image")],-1)),l.editingQuestionId&&l.imagePreview?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ze,[Object(n["createElementVNode"])("img",{src:l.imagePreview,alt:"Attached",style:{"max-width":"100%"}},null,8,et)])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",tt,[Object(n["createElementVNode"])("input",{type:"file",onChange:t[22]||(t[22]=(...e)=>a.handleImageUpload&&a.handleImageUpload(...e)),accept:"image/*"},null,32),l.imagePreview?(Object(n["openBlock"])(),Object(n["createElementBlock"])("img",{key:0,src:l.imagePreview,alt:"Preview",style:{"max-width":"100%"}},null,8,ot)):Object(n["createCommentVNode"])("",!0)])),t[70]||(t[70]=Object(n["createElementVNode"])("br",null,null,-1)),t[71]||(t[71]=Object(n["createElementVNode"])("br",null,null,-1)),t[72]||(t[72]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Save",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[23]||(t[23]=(...e)=>a.closeForm&&a.closeForm(...e))},"Close")],32)])],512),[[n["vShow"],l.showForm]])])])}var ct={name:"PubQuestions",data(){return{textbookTitle:"",textbookId:"",testBanks:[],selectedTestBank:null,selectedQuestionType:"",questions:[],selectedQuestionId:null,showForm:!1,showAddToTBModal:!1,questionToAddToTB:null,matchingPairs:[],imagePreview:"",editingQuestionId:null,oldMCOptionIds:[],editBlockedPopup:!1,editBlockedReason:"",questionData:{chapter:"",section:"",question:"",reference:"",answer:"",answerChoices:"",points:"",time:"",instructions:"",imageFile:null}}},methods:{async handleQuestionSave(){try{let e,t;const o=!!this.editingQuestionId,n=this.questions.find(e=>e.id===this.editingQuestionId);if(this.questionData.imageFile){if(e=new FormData,e.append("file",this.questionData.imageFile),e.append("question_text",this.questionData.question),e.append("default_points",this.questionData.points),e.append("est_time",this.questionData.time),e.append("chapter_number",this.questionData.chapter),e.append("section_number",this.questionData.section),e.append("grading_instructions",this.questionData.instructions),e.append("type",this.selectedQuestionType),e.append("source","manual"),e.append("textbook_id",this.textbookId),"True/False"===this.selectedQuestionType)e.append("true_false_answer","True"===this.questionData.answer);else if("Multiple Choice"===this.selectedQuestionType){const t=this.questionData.answerChoices.split(",").map(e=>e.trim()).filter(Boolean),o=[{option_text:this.questionData.answer.trim(),is_correct:!0},...t.map(e=>({option_text:e,is_correct:!1}))];e.append("options",JSON.stringify(o))}else"Matching"===this.selectedQuestionType?e.append("matches",JSON.stringify(this.matchingPairs.map(e=>({prompt_text:e.term,match_text:e.definition})))):"Fill in the Blank"===this.selectedQuestionType?e.append("blanks",JSON.stringify([{correct_text:this.questionData.answer}])):"Short Answer"===this.selectedQuestionType?e.append("answer",this.questionData.answer):"Essay"===this.selectedQuestionType&&e.append("grading_instructions",this.questionData.instructions);for(let[t,o]of e.entries())console.log(t+":",o);t={headers:{Authorization:"Bearer "+localStorage.getItem("token"),"Content-Type":"multipart/form-data"}}}else{if(e={question_text:this.questionData.question,default_points:parseInt(this.questionData.points),est_time:parseInt(this.questionData.time),chapter_number:this.questionData.chapter,section_number:this.questionData.section,grading_instructions:this.questionData.instructions,type:this.selectedQuestionType,source:"manual",textbook_id:this.textbookId},"True/False"===this.selectedQuestionType)e.true_false_answer="True"===this.questionData.answer;else if("Multiple Choice"===this.selectedQuestionType){const t=this.questionData.answerChoices.split(",").map(e=>e.trim()).filter(Boolean);e.options=[{option_text:this.questionData.answer.trim(),is_correct:!0},...t.map(e=>({option_text:e,is_correct:!1}))],o&&this.oldMCOptionIds.length>0&&(e.to_delete=this.oldMCOptionIds)}else if("Matching"===this.selectedQuestionType){if(e.matches=this.matchingPairs.map(e=>({prompt_text:e.term,match_text:e.definition})),o&&n){const t=(n.pairs||[]).map(e=>e.match_id);e.to_delete=t}}else"Fill in the Blank"===this.selectedQuestionType?e.blanks=[{correct_text:this.questionData.answer}]:"Short Answer"===this.selectedQuestionType?e.answer=this.questionData.answer:"Essay"===this.selectedQuestionType&&(e.grading_instructions=this.questionData.instructions);t={headers:{Authorization:"Bearer "+localStorage.getItem("token")}}}o?await S.patch("/questions/"+this.editingQuestionId,e,t):await S.post("/questions",e,t),this.closeForm(),this.resetForm(),this.fetchQuestions(this.selectedQuestionType)}catch(e){let t="Something went wrong.";e&&e.response&&e.response.data&&(t=e.response.data.error||e.response.data.message||t),alert("Save failed: "+t),console.error("Error saving question:",e)}},async fetchTestBanks(){try{const e=await S.get("/testbanks/publisher",{params:{textbook_id:this.textbookId},headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.testBanks=e.data.testbanks}catch(e){console.error("Error loading test banks:",e)}},async fetchQuestions(e){this.selectedQuestionType=e;try{const t=await S.get("/questions",{headers:{Authorization:"Bearer "+localStorage.getItem("token")},params:{textbook_id:this.textbookId,type:e}});Array.isArray(t.data.questions)?this.questions=t.data.questions.map(e=>{const t={text:e.question_text,type:e.type,points:e.default_points,id:e.id,instructions:e.grading_instructions||"",time:e.est_time,chapter:e.chapter_number,section:e.section_number,image_url:e.attachment&&e.attachment.url?e.attachment.url:"",is_published:e.is_published||!1};switch(e.type){case"True/False":return{...t,answer:e.true_false_answer};case"Multiple Choice":return{...t,correctOption:e.correct_option||null,incorrectOptions:e.incorrect_options||[]};case"Matching":return{...t,pairs:(e.matches||[]).map(e=>({term:e.prompt_text,definition:e.match_text}))};case"Fill in the Blank":return{...t,blanks:e.blanks||[]};case"Short Answer":return t;case"Essay":return t;default:return t}}):this.questions=[]}catch(t){console.error("Error fetching questions:",t),this.questions=[]}},openAddToTestBank(e){this.questionToAddToTB=e,this.showAddToTBModal=!0},closeAddToTBModal(){this.questionToAddToTB=null,this.showAddToTBModal=!1},async assignQuestionToTestBank(e){if(this.questionToAddToTB)try{await S.post(`/testbanks/publisher/${e}/questions`,{question_ids:[this.questionToAddToTB]},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),alert("Question successfully added to testbank!"),this.closeAddToTBModal()}catch(t){console.error("Failed to add question to testbank:",t);let e="Failed to add question.";t.response&&t.response.data&&t.response.data.error&&(e=t.response.data.error)}},selectTestBank(e){this.$router.push({name:"PubViewTB",query:{testbank_id:e.testbank_id,name:e.name,title:this.textbookTitle,textbook_id:this.textbookId,chapter:e.chapter_number,section:e.section_number}})},toggleQuestionSelection(e){this.selectedQuestionId=this.selectedQuestionId===e?null:e},selectQuestionType(e){this.selectedQuestionType=e,this.edit()},edit(){this.showForm=!0},closeForm(){this.showForm=!1,this.resetForm()},addPair(){this.matchingPairs.push({term:"",definition:""})},removePair(e){this.matchingPairs.splice(e,1)},handleImageUpload(e){const t=e.target.files[0];if(t){this.questionData.imageFile=t;const e=new FileReader;e.onload=e=>{this.imagePreview=e.target.result},e.readAsDataURL(t)}},resetForm(){this.questionData={chapter:"",section:"",question:"",reference:"",answer:"",answerChoices:"",points:"",time:"",instructions:"",imageFile:null},this.selectedQuestionType="",this.matchingPairs=[],this.imagePreview="",this.editingQuestionId=null,this.oldMCOptionIds=[];const e=document.querySelector('input[type="file"]');e&&(e.value="")},async editQuestion(e){try{const t=await S.get(`/questions/${e.id}/used_in`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(t.data.is_used)return this.editBlockedReason=`This question is used in a "${t.data.tests[0].status}" test: "${t.data.tests[0].name}".`,this.editingQuestionId=e.id,void(this.editBlockedPopup=!0)}catch(t){return console.error("Error checking question status:",t),void alert("Could not verify question status.")}this.editingQuestionId=e.id,this.questionData.question=e.text,this.questionData.chapter=e.chapter,this.questionData.section=e.section,this.questionData.points=e.points,this.questionData.time=e.time,this.questionData.instructions=e.instructions,this.questionData.answer=e.answer||"",this.selectedQuestionType=e.type,this.imagePreview=e.image_url||"","Multiple Choice"===e.type?(this.questionData.answer=e.correctOption&&e.correctOption.option_text||"",this.questionData.answerChoices=e.incorrectOptions.map(e=>e.option_text).join(", "),this.oldMCOptionIds=[],e.correctOption&&e.correctOption.option_id&&this.oldMCOptionIds.push(e.correctOption.option_id),Array.isArray(e.incorrectOptions)&&e.incorrectOptions.forEach(e=>{e.option_id&&this.oldMCOptionIds.push(e.option_id)})):"Matching"===e.type&&(this.matchingPairs=e.pairs.map(e=>({term:e.term,definition:e.definition}))),this.showForm=!0},async deleteQuestion(e){if(confirm("Are you sure you want to delete this question?"))try{await S.delete("/questions/"+e,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.questions=this.questions.filter(t=>t.id!==e)}catch(t){console.error(t),alert("Failed to delete question.")}},async createCopyInstead(){try{await S.post(`/questions/${this.editingQuestionId}/copy_to_textbook`,{textbook_id:this.textbookId},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});alert("A copy of the question was created. You can now edit it."),this.editBlockedPopup=!1,this.fetchQuestions(this.selectedQuestionType)}catch(e){console.error("Failed to create copy:",e),alert("Failed to create a copy of this question.")}}},mounted(){this.textbookTitle=this.$route.query.title||"Book Title",this.textbookId=this.$route.query.textbook_id||"",this.textbookId&&this.fetchTestBanks()}};o("ef75");const lt=r()(ct,[["render",nt],["__scopeId","data-v-3e943274"]]);var at=lt;const st={class:"theme-publisher"},rt={class:"top-banner"},it={class:"banner-title"},dt={class:"banner-actions"},bt={class:"page-wrapper"},ut={id:"feedbackContainer"},mt={key:0},pt={key:1},ht={key:2},Ot=["onClick"],jt={key:0,class:"feedback-section"},kt={key:1},gt={key:2,class:"p_button-group"},Nt=["onClick"],Et={key:0,class:"popup-overlay"},Vt={class:"form-popup-modal"};function yt(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",st,[Object(n["createElementVNode"])("div",rt,[Object(n["createElementVNode"])("div",it,"Draft Pool: "+Object(n["toDisplayString"])(l.selectedTestBank),1),Object(n["createElementVNode"])("div",dt,[Object(n["createVNode"])(s,{to:"/PubHome",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[3]||(t[3]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[4]||(t[4]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",bt,[Object(n["createVNode"])(s,{to:{path:"/PubViewTB",query:{name:l.selectedTestBank,textbook_id:l.textbookId,testbank_id:e.$route.query.testbank_id,title:e.$route.query.title}}},{default:Object(n["withCtx"])(()=>t[5]||(t[5]=[Object(n["createElementVNode"])("button",{class:"p_button"},"Return to Draft Pools",-1)])),_:1},8,["to"]),t[11]||(t[11]=Object(n["createElementVNode"])("hr",null,null,-1)),Object(n["createElementVNode"])("div",ut,[l.loading?(Object(n["openBlock"])(),Object(n["createElementBlock"])("p",mt,"Loading feedback...")):0===l.feedbackList.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("p",pt,"No questions in this draft pool have feedback yet.")):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ht,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.feedbackList,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:o,class:Object(n["normalizeClass"])(["p_question-box",{selected:l.selectedQuestionId===e.question_id}]),onClick:t=>a.toggleQuestionSelection(e.question_id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.question_text)+" ",1),e.feedback&&e.feedback.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",jt,[t[6]||(t[6]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Feedback:")],-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.feedback,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},[Object(n["createTextVNode"])(' "'+Object(n["toDisplayString"])(e.comment)+'" — ',1),Object(n["createElementVNode"])("em",null,Object(n["toDisplayString"])(e.username)+" ("+Object(n["toDisplayString"])(e.role)+")",1)]))),128))])])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",kt,t[7]||(t[7]=[Object(n["createElementVNode"])("p",null,"No feedback yet.",-1)]))),l.selectedQuestionId===e.question_id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",gt,[Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>a.openFeedbackForm(e.question_id),["stop"])},"Leave Feedback",8,Nt)])):Object(n["createCommentVNode"])("",!0)],10,Ot))),128)),l.showFeedbackForm?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Et,[Object(n["createElementVNode"])("div",Vt,[t[8]||(t[8]=Object(n["createElementVNode"])("h2",null,"Leave Feedback",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>l.feedbackText=e),rows:"5",placeholder:"Enter your comment here..."},null,512),[[n["vModelText"],l.feedbackText]]),t[9]||(t[9]=Object(n["createElementVNode"])("br",null,null,-1)),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("button",{class:"btn",onClick:t[1]||(t[1]=(...e)=>a.submitFeedback&&a.submitFeedback(...e))},"Submit"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[2]||(t[2]=(...e)=>a.closeFeedbackForm&&a.closeFeedbackForm(...e))},"Cancel")])])):Object(n["createCommentVNode"])("",!0)]))])])])}var ft={name:"PubViewFeedback",data(){return{testbankId:null,textbookId:this.$route.query.textbook_id||null,selectedTestBank:"",feedbackList:[],loading:!0,userRole:"",selectedQuestionId:null,showFeedbackForm:!1,selectedQuestionIdForFeedback:null,feedbackText:""}},async mounted(){const e=this.$route.query;this.testbankId=parseInt(e.testbank_id),this.selectedTestBank=e.title||"No Draft Pool Selected";const t=localStorage.getItem("token");if(t){const e=JSON.parse(atob(t.split(".")[1]));this.userRole=e.role}this.fetchFeedbackByTestbank()},methods:{async fetchFeedbackByTestbank(){try{const e=await S.get(`/feedback/${this.testbankId}/questions-with-feedback`);this.feedbackList=e.data,console.log("Feedback loaded:",this.feedbackList)}catch(e){console.error("Error loading feedback:",e)}finally{this.loading=!1}},toggleQuestionSelection(e){this.selectedQuestionId=this.selectedQuestionId===e?null:e},openFeedbackForm(e){this.selectedQuestionIdForFeedback=e,this.feedbackText="",this.showFeedbackForm=!0},closeFeedbackForm(){this.selectedQuestionIdForFeedback=null,this.feedbackText="",this.showFeedbackForm=!1},async submitFeedback(){try{await S.post("/feedback/create",{question_id:this.selectedQuestionIdForFeedback,comment_field:this.feedbackText},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.closeFeedbackForm();const e=this.feedbackList.find(e=>e.question_id===this.selectedQuestionIdForFeedback);e&&(e.feedback||(e.feedback=[]),e.feedback.push({comment:this.feedbackText,username:"You",role:this.userRole}))}catch(e){console.error("Error submitting feedback:",e)}}}};o("da98");const wt=r()(ft,[["render",yt],["__scopeId","data-v-50d05966"]]);var vt=wt;const _t={class:"theme-publisher"},Bt={class:"top-banner"},Tt={class:"banner-title"},xt={class:"banner-actions"},Ct={class:"page-wrapper"},Ft={class:"button-row"},St=["disabled"],It={key:0,class:"popup-overlay"},Dt={class:"form-popup-modal"},qt={key:1,class:"publish-warning"},At={id:"questionsContainer"},Qt=["onClick"],Pt={key:0},Mt={key:1},Ut={key:2},$t={key:3},Lt={key:4},zt={key:0},Rt=["src"],Ht={key:5,class:"p_button-group"},Wt=["onClick","disabled","title"];function Jt(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",_t,[Object(n["createElementVNode"])("div",Bt,[Object(n["createElementVNode"])("div",Tt,"Draft Pool: "+Object(n["toDisplayString"])(l.selectedTestBank),1),Object(n["createElementVNode"])("div",xt,[Object(n["createVNode"])(s,{to:"/PubHome",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[9]||(t[9]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[10]||(t[10]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",Ct,[Object(n["createElementVNode"])("div",Ft,[Object(n["createElementVNode"])("button",{class:"p_button",onClick:t[0]||(t[0]=e=>l.showEditForm=!0)},"Edit Draft Pool Info"),Object(n["createVNode"])(s,{to:{path:"/PubQuestions",query:{title:l.textbookTitle,textbook_id:l.textbookId}}},{default:Object(n["withCtx"])(()=>t[11]||(t[11]=[Object(n["createElementVNode"])("button",{class:"p_button"},"Return to Question Page",-1)])),_:1},8,["to"]),Object(n["createVNode"])(s,{to:{name:"PubViewFeedback",query:{testbank_id:l.selectedTestBankId,title:l.selectedTestBank,textbook_id:l.textbookId}}},{default:Object(n["withCtx"])(()=>t[12]||(t[12]=[Object(n["createElementVNode"])("button",{class:"p_button"},"View Feedback",-1)])),_:1},8,["to"]),Object(n["createElementVNode"])("button",{class:"p_button",onClick:t[1]||(t[1]=(...e)=>a.publishTestbank&&a.publishTestbank(...e)),disabled:l.published},Object(n["toDisplayString"])(l.published?"Draft Pool Published":"Publish Draft Pool"),9,St),l.published?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:0,class:"p_button delete",onClick:t[2]||(t[2]=(...e)=>a.deleteTestBank&&a.deleteTestBank(...e))}," Delete Draft Pool "))]),l.showEditForm?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",It,[Object(n["createElementVNode"])("div",Dt,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[7]||(t[7]=Object(n["withModifiers"])((...e)=>a.updateTestBank&&a.updateTestBank(...e),["prevent"]))},[t[13]||(t[13]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Draft Pool Name:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>l.editForm.name=e),required:""},null,512),[[n["vModelText"],l.editForm.name]]),t[14]||(t[14]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Chapter Number:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>l.editForm.chapter=e),required:""},null,512),[[n["vModelText"],l.editForm.chapter]]),t[15]||(t[15]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Section Number:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>l.editForm.section=e),required:""},null,512),[[n["vModelText"],l.editForm.section]]),t[16]||(t[16]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Save Changes",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[6]||(t[6]=e=>l.showEditForm=!1)},"Cancel")],32)])])):Object(n["createCommentVNode"])("",!0),l.published?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",qt,t[17]||(t[17]=[Object(n["createElementVNode"])("strong",null,"Note:",-1),Object(n["createTextVNode"])(" This draft pool has been published. Question details can no longer be edited or removed. The draft pool cannot be deleted or modified. ")]))):Object(n["createCommentVNode"])("",!0),t[39]||(t[39]=Object(n["createElementVNode"])("hr",null,null,-1)),t[40]||(t[40]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("div",At,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.selectedQuestions,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("p",{key:e},Object(n["toDisplayString"])(e),1))),128))]),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.questions,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:o,class:Object(n["normalizeClass"])(["p_question-box",{selected:l.selectedQuestionId===e.id}]),onClick:t=>a.toggleQuestionSelection(e.id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.text),1),t[32]||(t[32]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[18]||(t[18]=Object(n["createElementVNode"])("strong",null,"Type:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.type),1)]),t[33]||(t[33]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[19]||(t[19]=Object(n["createElementVNode"])("strong",null,"Chapter:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.chapter||"N/A"),1)]),t[34]||(t[34]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[20]||(t[20]=Object(n["createElementVNode"])("strong",null,"Section:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.section||"N/A"),1)]),t[35]||(t[35]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[21]||(t[21]=Object(n["createElementVNode"])("strong",null,"Points:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.points),1)]),t[36]||(t[36]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[22]||(t[22]=Object(n["createElementVNode"])("strong",null,"Estimated Time:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.time)+" minutes",1)]),t[37]||(t[37]=Object(n["createElementVNode"])("br",null,null,-1)),"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Pt,[t[23]||(t[23]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.answer?"True":"False"),1)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Mt,[t[24]||(t[24]=Object(n["createElementVNode"])("strong",null,"Correct Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.correctOption&&e.correctOption.option_text||"Not specified"),1),t[25]||(t[25]=Object(n["createElementVNode"])("br",null,null,-1)),t[26]||(t[26]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Other Options:")],-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.incorrectOptions,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t,class:"incorrect-answer"},Object(n["toDisplayString"])(e.option_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ut,[t[27]||(t[27]=Object(n["createElementVNode"])("strong",null,"Correct Answer(s):",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.blanks,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.correct_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",$t,[t[28]||(t[28]=Object(n["createElementVNode"])("strong",null,"Pairs:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.pairs,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.term)+" - "+Object(n["toDisplayString"])(e.definition),1))),128))])])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("span",null,[t[29]||(t[29]=Object(n["createElementVNode"])("strong",null,"Grading Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.instructions||"None"),1)]),t[38]||(t[38]=Object(n["createElementVNode"])("br",null,null,-1)),e.attachment&&e.attachment.url?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Lt,[t[30]||(t[30]=Object(n["createElementVNode"])("strong",null,"Attachment:",-1)),t[31]||(t[31]=Object(n["createElementVNode"])("br",null,null,-1)),e.attachment.name.match(/\.(jpg|jpeg|png|gif)$/i)?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",zt,[Object(n["createElementVNode"])("img",{src:e.attachment.url,alt:"Attachment",style:{"max-width":"250px","margin-top":"10px"}},null,8,Rt)])):Object(n["createCommentVNode"])("",!0)])):Object(n["createCommentVNode"])("",!0),l.selectedQuestionId!==e.id||l.published?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ht,[Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>a.removeQuestionFromTestBank(e.id),["stop"]),disabled:l.published,title:l.published?"Published — cannot remove question":"Remove from Draft Pool"},Object(n["toDisplayString"])(l.published?"Published - Cannot Remove":"Remove from Draft Pool"),9,Wt)]))],10,Qt))),128))]),Object(n["createElementVNode"])("input",{type:"file",id:"fileInput",style:{display:"none"},onChange:t[8]||(t[8]=(...t)=>e.handleFileUpload&&e.handleFileUpload(...t))},null,32)])])}var Gt={name:"PublisherViewTB",data(){return{showPopup:!1,showEditForm:!1,textbookTitle:this.$route.query.title||"Book Title",textbookId:this.$route.query.textbook_id||"",selectedTestBank:this.$route.query.name||"No Draft Pool Selected",selectedTestBankId:this.$route.query.testbank_id||this.$route.params.testbank_id||null,selectedQuestionId:null,published:!1,questions:[],editForm:{name:this.$route.query.name||"",chapter:this.$route.query.chapter||"",section:this.$route.query.section||""}}},computed:{selectedQuestions(){return this.questions[this.selectedTestBank]||[]}},async mounted(){await this.checkPublishedStatus(),await this.loadQuestions()},methods:{selectTestBank(e){this.selectedTestBank=e},edit(){this.showPopup=!0},closeForm(){this.showPopup=!1,this.showEditForm=!1},async updateTestBank(){try{await S.put("/testbanks/publisher/"+this.selectedTestBankId,{name:this.editForm.name,chapter_number:this.editForm.chapter,section_number:this.editForm.section},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.selectedTestBank=this.editForm.name,this.showEditForm=!1}catch(e){console.error("Error updating test bank:",e)}},async loadQuestions(){if(this.selectedTestBankId)try{const e=await S.get(`/testbanks/publisher/${this.selectedTestBankId}/questions`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),t=e.data.questions||[];this.questions=t.map(e=>{const t={id:e.id,text:e.question_text,type:e.type,chapter:e.chapter_number||"N/A",section:e.section_number||"N/A",points:e.default_points||"N/A",time:e.est_time||"N/A",instructions:e.grading_instructions||"None",attachment:e.attachment||null};switch(e.type){case"True/False":return{...t,answer:e.true_false_answer};case"Multiple Choice":return{...t,correctOption:e.correct_option||null,incorrectOptions:e.incorrect_options||[]};case"Matching":return{...t,pairs:(e.matches||[]).map(e=>({term:e.prompt_text,definition:e.match_text}))};case"Fill in the Blank":return{...t,blanks:e.blanks||[]};case"Short Answer":return{...t,answer:e.answer||""};case"Essay":return t;default:return t}})}catch(e){console.error("Error loading test bank questions:",e)}},toggleQuestionSelection(e){this.selectedQuestionId===e?this.selectedQuestionId=null:this.selectedQuestionId=e},async removeQuestionFromTestBank(e){if(confirm("Are you sure you want to remove this question from the Draft Pool?"))try{await S.delete(`/testbanks/${this.selectedTestBankId}/questions/${e}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.questions=this.questions.filter(t=>t.id!==e),this.selectedQuestionId=null}catch(t){console.error("Error removing question:",t)}},async publishTestbank(){if(this.selectedTestBankId)try{await S.post(`/testbanks/${this.selectedTestBankId}/publish`,{},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.published=!0}catch(e){console.error("Error publishing test bank:",e)}},async deleteTestBank(){if(!this.published&&confirm("Are you sure you want to delete this entire draft pool? This action cannot be undone."))try{await S.delete("/testbanks/"+this.selectedTestBankId,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.$router.push({path:"/PubQuestions",query:{title:this.textbookTitle,textbook_id:this.textbookId}})}catch(e){console.error("Error deleting draft pool:",e)}},async checkPublishedStatus(){try{const e=await S.get("/testbanks/publisher",{headers:{Authorization:"Bearer "+localStorage.getItem("token")},params:{textbook_id:this.textbookId}}),t=e.data.testbanks||[],o=t.find(e=>e.testbank_id==this.selectedTestBankId);o?this.published=!0===o.is_published:console.warn("Testbank not found in returned list")}catch(e){console.error("Failed to fetch testbank status:",e)}}}};o("e5d9");const Kt=r()(Gt,[["render",Jt],["__scopeId","data-v-0dcbdc32"]]);var Yt=Kt;const Xt={class:"theme-teacher"},Zt={class:"top-banner"},eo={class:"t_banner-actions"},to={class:"center large-paragraph",style:{color:"#222"}},oo={class:"page-wrapper"},no={class:"button-row"},co={key:0,class:"t_dropdown"},lo={class:"t_dropdown-content"},ao=["onClick"],so={key:1},ro={class:"center large-paragraph",style:{color:"#222"}},io={class:"button-row"},bo={key:0,class:"popup-overlay"},uo={class:"form-popup-modal"},mo={class:"form-container"},po={style:{"list-style-type":"none","padding-left":"0"}},ho=["onClick"],Oo={key:1,class:"popup-overlay"},jo={class:"form-popup-modal"},ko={style:{"list-style-type":"none","padding-left":"0"}},go={style:{display:"flex","align-items":"center"}},No=["value"],Eo={style:{display:"flex","justify-content":"center",gap:"10px","margin-top":"20px"}};function Vo(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Xt,[Object(n["createElementVNode"])("div",Zt,[t[7]||(t[7]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Course Selection",-1)),Object(n["createElementVNode"])("div",eo,[Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[6]||(t[6]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",to,[Object(n["createElementVNode"])("div",oo,[t[18]||(t[18]=Object(n["createTextVNode"])(" Download all your question data: ")),t[19]||(t[19]=Object(n["createElementVNode"])("div",{class:"button-row"},[Object(n["createElementVNode"])("button",{class:"t_button"},"Download Questions")],-1)),t[20]||(t[20]=Object(n["createTextVNode"])(" Please select or create a course: ")),Object(n["createElementVNode"])("div",no,[l.courses.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",co,[t[8]||(t[8]=Object(n["createElementVNode"])("button",{class:"t_dropbtn"},"Select Course",-1)),Object(n["createElementVNode"])("div",lo,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.courses,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("a",{key:e.id,onClick:t=>a.selectCourse(e)},Object(n["toDisplayString"])(e.title),9,ao))),128))])])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",so," No courses available. ")),Object(n["createVNode"])(s,{to:"TeacherNewClass"},{default:Object(n["withCtx"])(()=>t[9]||(t[9]=[Object(n["createElementVNode"])("button",{class:"t_button"},"Create New Course",-1)])),_:1})]),Object(n["createElementVNode"])("div",ro,[t[10]||(t[10]=Object(n["createTextVNode"])(" Test Options: ")),Object(n["createElementVNode"])("div",io,[Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[0]||(t[0]=(...e)=>a.viewPreviousTests&&a.viewPreviousTests(...e))},"View Previous Tests"),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[1]||(t[1]=(...e)=>a.chooseTestToPublish&&a.chooseTestToPublish(...e))},"Choose Test to Publish")])]),l.showPopup?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",bo,[Object(n["createElementVNode"])("div",uo,[Object(n["createElementVNode"])("form",mo,[t[11]||(t[11]=Object(n["createTextVNode"])(" Your Finalized Tests ")),Object(n["createElementVNode"])("ul",po,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.testFiles,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:e.test_id},[e.download_url&&e.hasAnswerKey?(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:0,class:"t_button",onClick:Object(n["withModifiers"])(t=>a.downloadTestAndKey(e),["prevent"])},Object(n["toDisplayString"])(e.name),9,ho)):Object(n["createCommentVNode"])("",!0)]))),128))]),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[2]||(t[2]=e=>l.showPopup=!1)},"Close")])])])):Object(n["createCommentVNode"])("",!0),l.showPublishSelector?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Oo,[Object(n["createElementVNode"])("div",jo,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[5]||(t[5]=Object(n["withModifiers"])((...e)=>a.publishSelectedTest&&a.publishSelectedTest(...e),["prevent"])),style:{"font-size":"16px"}},[t[13]||(t[13]=Object(n["createElementVNode"])("h1",{style:{"align-items":"center"}}," Choose a Finalized Test to Publish:",-1)),t[14]||(t[14]=Object(n["createElementVNode"])("strong",null,"Note:",-1)),t[15]||(t[15]=Object(n["createTextVNode"])(" Any questions on tests that are published can no longer be edited or deleted. ")),t[16]||(t[16]=Object(n["createElementVNode"])("br",null,null,-1)),t[17]||(t[17]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("ul",ko,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.testFiles,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:e.test_id,style:{"margin-bottom":"8px"}},[Object(n["createElementVNode"])("label",go,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=e=>l.selectedTestIdToPublish=e),value:e.test_id,style:{"margin-right":"10px"}},null,8,No),[[n["vModelRadio"],l.selectedTestIdToPublish]]),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.name),1)])]))),128))]),Object(n["createElementVNode"])("div",Eo,[t[12]||(t[12]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Confirm Publish",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[4]||(t[4]=e=>l.showPublishSelector=!1)},"Cancel")])],32)])])):Object(n["createCommentVNode"])("",!0)])]),t[21]||(t[21]=Object(n["createElementVNode"])("br",null,null,-1))])}var yo={name:"TeacherHome",data(){return{courses:[],error:null,testFiles:[],showPopup:!1,showPublishSelector:!1,selectedTestIdToPublish:null}},created(){this.fetchCourses()},methods:{async fetchCourses(){try{console.log("Fetching courses...");const e=await S.get("/courses",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Courses fetched:",e.data),Array.isArray(e.data)?this.courses=e.data.map(e=>({id:e.course_id,title:e.course_name,textbook_id:e.textbook_id})):this.error="Failed to fetch course data."}catch(e){console.error("Error fetching course:",e),e.response?this.error=e.response.data.error||e.response.statusText:this.error="Network error or server is not responding."}},selectCourse(e){this.$router.push({name:"TeacherQuestions",query:{courseId:e.id,courseTitle:e.title,textbook_id:e.textbook_id}})},async viewPreviousTests(){try{const e=await S.get("/tests/final",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),t=e.data.final_tests||[],o=await Promise.all(t.map(async e=>{try{const t=await S.get(`/tests/${e.test_id}/answer_key`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.hasAnswerKey=!(!t.data||!t.data.file_url)}catch{e.hasAnswerKey=!1}return e}));this.testFiles=o,this.showPopup=!0}catch(e){console.error("Failed to fetch final tests:",e),alert("Could not load previous tests.")}},async downloadTestAndKey(e){if(!e.download_url)return void alert("Test file not available for download.");const t=document.createElement("a");t.href=e.download_url,t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t);try{const t=await S.get(`/tests/${e.test_id}/answer_key`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(t.data.file_url){const e=document.createElement("a");e.href=t.data.file_url,e.download="",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}catch(o){console.warn(`Failed to download answer key for test ${e.test_id}:`,o)}},async chooseTestToPublish(){try{const e=await S.get("/tests/final",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.testFiles=e.data.final_tests||[],this.selectedTestIdToPublish=null,this.showPublishSelector=!0}catch(e){console.error("Failed to load final tests for publishing:",e),alert("Could not load test list.")}},async publishSelectedTest(){if(this.selectedTestIdToPublish)try{await S.post(`/tests/${this.selectedTestIdToPublish}/publish`,{},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.showPublishSelector=!1}catch(e){console.error("❌ Publish failed:",e.response&&e.response.data||e.message),alert("Failed to publish the selected test.")}else alert("Please select a test to publish.")}}};o("6bc6");const fo=r()(yo,[["render",Vo],["__scopeId","data-v-d53dde1e"]]);var wo=fo;const vo={class:"theme-teacher"},_o={class:"center large-paragraph",style:{color:"#222"}},Bo=["disabled"],To={key:0,class:"error-message"},xo={key:1,class:"loading-message"};function Co(e,t,o,c,l,a){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",vo,[t[14]||(t[14]=Object(n["createElementVNode"])("div",{class:"top-banner"},[Object(n["createElementVNode"])("div",{class:"banner-title"},"Teacher Login")],-1)),Object(n["createElementVNode"])("div",_o,[t[11]||(t[11]=Object(n["createTextVNode"])(" Please enter your teacher username and password: ")),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("form",{onSubmit:t[2]||(t[2]=Object(n["withModifiers"])((...e)=>a.submitForm&&a.submitForm(...e),["prevent"]))},[t[3]||(t[3]=Object(n["createElementVNode"])("label",{for:"uname"},"Username:",-1)),t[4]||(t[4]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"uname","onUpdate:modelValue":t[0]||(t[0]=e=>l.username=e)},null,512),[[n["vModelText"],l.username]]),t[5]||(t[5]=Object(n["createElementVNode"])("br",null,null,-1)),t[6]||(t[6]=Object(n["createElementVNode"])("br",null,null,-1)),t[7]||(t[7]=Object(n["createElementVNode"])("label",{for:"pass"},"Password:",-1)),t[8]||(t[8]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"password",id:"pass","onUpdate:modelValue":t[1]||(t[1]=e=>l.password=e)},null,512),[[n["vModelText"],l.password]]),t[9]||(t[9]=Object(n["createElementVNode"])("br",null,null,-1)),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("input",{type:"submit",value:"Submit",disabled:l.loading},null,8,Bo)],32),l.errorMessage?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",To,Object(n["toDisplayString"])(l.errorMessage),1)):Object(n["createCommentVNode"])("",!0),l.loading?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",xo,"Logging in...")):Object(n["createCommentVNode"])("",!0)])])}var Fo={data(){return{username:"",password:"",errorMessage:"",loading:!1}},mounted(){const e=localStorage.getItem("token");if(e)try{const t=Object(I["default"])(e),o=Date.now()/1e3;console.log("Decoded token:",t),t.exp>o&&"teacher"===t.role&&this.$router.push("/TeacherHome")}catch(t){console.error("Invalid token",t)}},methods:{async submitForm(){if(this.username&&this.password)if(this.username.trim().length<3||this.password.trim().length<6)this.errorMessage="Username must be at least 3 characters and password at least 6 characters.";else{this.loading=!0,this.errorMessage="";try{const e=await S.post("/auth/login",{username:this.username.toLowerCase(),password:this.password}),{token:t,user_id:o,role:n}=e.data;localStorage.setItem("token",t),localStorage.setItem("user_id",o),localStorage.setItem("role",n),"teacher"===n?this.$router.push("/TeacherHome"):(this.errorMessage="Only teachers can log in here.",localStorage.clear())}catch(e){e.response?401===e.response.status?this.errorMessage="Invalid username or password.":this.errorMessage=e.response&&e.response.data&&e.response.data.message||"An error occurred during login.":this.errorMessage="Network error. Please check your connection."}finally{this.loading=!1}}else this.errorMessage="Please enter both username and password."}}};o("a9f9");const So=r()(Fo,[["render",Co],["__scopeId","data-v-29f43bdf"]]);var Io=So;const Do={class:"theme-teacher"},qo={class:"top-banner"},Ao={class:"t_banner-actions"},Qo={class:"center large-paragraph",style:{color:"#222"}},Po=["value"],Mo={key:0,style:{color:"red","margin-top":"10px"}};function Uo(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Do,[Object(n["createElementVNode"])("div",qo,[t[6]||(t[6]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Create New Class",-1)),Object(n["createElementVNode"])("div",Ao,[Object(n["createVNode"])(s,{to:"/TeacherHome",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[4]||(t[4]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[5]||(t[5]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",Qo,[Object(n["createElementVNode"])("form",{onSubmit:t[3]||(t[3]=Object(n["withModifiers"])((...e)=>a.saveCourse&&a.saveCourse(...e),["prevent"]))},[t[7]||(t[7]=Object(n["createElementVNode"])("label",{for:"courseTitle"},"Course Title:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"courseTitle","onUpdate:modelValue":t[0]||(t[0]=e=>l.courseTitle=e),style:{height:"20px"}},null,512),[[n["vModelText"],l.courseTitle]]),t[8]||(t[8]=Object(n["createElementVNode"])("br",null,null,-1)),t[9]||(t[9]=Object(n["createElementVNode"])("label",{for:"courseNumber"},"Course Number:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"courseNumber","onUpdate:modelValue":t[1]||(t[1]=e=>l.courseNumber=e),style:{height:"20px"}},null,512),[[n["vModelText"],l.courseNumber]]),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),t[11]||(t[11]=Object(n["createElementVNode"])("label",{for:"textbookTitle"},"Textbook Title:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("select",{id:"textbookTitle","onUpdate:modelValue":t[2]||(t[2]=e=>l.selectedTextbookId=e),style:{height:"50px",width:"200px"},required:""},[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.textbooks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("option",{key:e.id,value:e.id},Object(n["toDisplayString"])(e.title),9,Po))),128))],512),[[n["vModelSelect"],l.selectedTextbookId]]),l.textbooks.length?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Mo," No textbooks available. ")),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("div",{class:"center large-heading"},[Object(n["createElementVNode"])("input",{type:"submit",value:"Save"})],-1))],32)])])}var $o={name:"TeacherNewClass",data(){return{courseTitle:"",courseNumber:"",selectedTextbookId:null,textbooks:[],error:null}},created(){this.fetchTextbooks()},methods:{async fetchTextbooks(){try{console.log("Fetching textbooks...");const e=await S.get("/textbooks/all",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Textbooks fetched:",e.data),e.data&&e.data.textbooks?this.textbooks=e.data.textbooks:this.error="Failed to fetch textbooks data."}catch(e){console.error("Error fetching textbooks:",e),e.response?this.error=`Error: ${e.response.status} - ${e.response.data.message||e.response.statusText}`:this.error="Network error or server is not responding."}},selectTextbook(e){this.selectedTextbookId=e.id,this.selectedTextbookTitle=e.title},async saveCourse(){if(this.courseTitle&&this.courseNumber&&this.selectedTextbookId){const t={course_name:this.courseTitle,course_number:this.courseNumber,textbook_id:this.selectedTextbookId};try{const e=await S.post("/courses",t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Course saved successfully:",e.data),this.$router.push({path:"/TeacherHome"})}catch(e){console.error("Error saving course:",e)}}}}};o("1ca3");const Lo=r()($o,[["render",Uo],["__scopeId","data-v-37be9029"]]);var zo=Lo;const Ro={class:"theme-teacher"},Ho={class:"top-banner"},Wo={class:"t_banner-actions"},Jo={class:"center large-paragraph",style:{color:"#222"}};function Go(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ro,[Object(n["createElementVNode"])("div",Ho,[t[6]||(t[6]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Create New Draft Pool",-1)),Object(n["createElementVNode"])("div",Wo,[Object(n["createVNode"])(s,{to:"/TeacherHome",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[4]||(t[4]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[5]||(t[5]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",Jo,[Object(n["createElementVNode"])("form",{onSubmit:t[3]||(t[3]=Object(n["withModifiers"])((...e)=>a.saveTestBank&&a.saveTestBank(...e),["prevent"]))},[t[7]||(t[7]=Object(n["createElementVNode"])("label",{for:"bankName"},"Name of Draft Pool:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"bankName","onUpdate:modelValue":t[0]||(t[0]=e=>l.bankName=e),style:{height:"20px"}},null,512),[[n["vModelText"],l.bankName]]),t[8]||(t[8]=Object(n["createElementVNode"])("br",null,null,-1)),t[9]||(t[9]=Object(n["createElementVNode"])("br",null,null,-1)),t[10]||(t[10]=Object(n["createElementVNode"])("label",{for:"bankCh"},"Textbook Chapter:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"bankCh","onUpdate:modelValue":t[1]||(t[1]=e=>l.bankChapter=e),style:{height:"20px"}},null,512),[[n["vModelText"],l.bankChapter]]),t[11]||(t[11]=Object(n["createElementVNode"])("br",null,null,-1)),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("label",{for:"bankSec"},"Textbook Section:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"bankSec","onUpdate:modelValue":t[2]||(t[2]=e=>l.bankSection=e),style:{height:"20px"}},null,512),[[n["vModelText"],l.bankSection]]),t[14]||(t[14]=Object(n["createElementVNode"])("br",null,null,-1)),t[15]||(t[15]=Object(n["createElementVNode"])("br",null,null,-1)),t[16]||(t[16]=Object(n["createElementVNode"])("input",{type:"submit",value:"Submit"},null,-1))],32)])])}var Ko={name:"TeacherNewTB",data(){return{courseId:this.$route.query.courseId||"",courseTitle:this.$route.query.courseTitle||"",bankName:"",bankChapter:"",bankSection:""}},methods:{async saveTestBank(){if(this.bankName&&this.bankChapter&&this.bankSection&&this.courseId){const t={testbank_name:this.bankName,chapter_number:this.bankChapter,section_number:this.bankSection,course_id:this.courseId};try{const e=await S.post("/testbanks/teacher",t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Test bank saved successfully:",e.data),alert("Test bank saved successfully!"),this.$router.push({path:"/TeacherQuestions",query:{courseTitle:this.$route.query.courseTitle,courseId:this.courseId}})}catch(e){console.error("Error saving test bank:",e),alert("Failed to save the test bank. Please try again.")}}else alert("Please fill out all fields.")}}};o("b1c0");const Yo=r()(Ko,[["render",Go],["__scopeId","data-v-67b0bed1"]]);var Xo=Yo;const Zo={class:"theme-teacher"},en={class:"top-banner"},tn={class:"t_banner-actions"},on={class:"center large-paragraph",style:{color:"#222"}},nn={class:"button-row"},cn={key:0},ln={key:0,class:"center large-paragraph",style:{color:"#555"}},an={key:1,class:"center large-paragraph",style:{color:"#222"}},sn={key:2},rn=["onClick"],dn={key:0},bn={key:1},un={key:2},mn={key:3},pn={key:4},hn={key:5},On={key:6,class:"feedback-section"},jn={key:0},kn={key:0},gn={key:0},Nn={key:7},En={key:0},Vn=["src","alt"],yn={key:8,class:"button-group"},fn=["onClick"],wn=["onClick"],vn={key:1},_n={key:0,class:"center large-paragraph",style:{color:"#555"}},Bn={key:1,class:"center large-paragraph",style:{color:"#222"}},Tn={key:2},xn=["onClick"],Cn={key:0},Fn={key:1},Sn={key:2},In={key:3},Dn={key:4},qn={key:5},An={key:6,class:"feedback-section"},Qn={key:0},Pn={key:0},Mn={key:0},Un={key:7},$n={key:0},Ln=["src","alt"],zn={key:8,class:"button-group"},Rn=["onClick"],Hn=["onClick"],Wn={key:0,class:"popup-overlay"},Jn={class:"form-popup-modal"},Gn={class:"button-row"},Kn={key:1,class:"popup-overlay"},Yn={class:"form-popup-modal"},Xn={style:{display:"flex","flex-direction":"column","align-items":"flex-start"}},Zn=["onClick"],ec={style:{width:"100%"}};function tc(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Zo,[Object(n["createElementVNode"])("div",en,[t[9]||(t[9]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Community Resources",-1)),Object(n["createElementVNode"])("div",tn,[Object(n["createVNode"])(s,{to:"/TeacherHome",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[7]||(t[7]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[8]||(t[8]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",on,[t[48]||(t[48]=Object(n["createTextVNode"])(" Please select an option to view: ")),Object(n["createElementVNode"])("div",nn,[Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[0]||(t[0]=(...e)=>a.viewPublishedTests&&a.viewPublishedTests(...e))},"Published Tests"),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[1]||(t[1]=(...e)=>a.fetchFeedback&&a.fetchFeedback(...e))},"View Community Draft Pools")]),"published"===l.viewing?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",cn,[l.loadingPublished?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ln," Loading published draft pools... ")):0===l.fullTestbanks.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",an," No published draft pools available for this course. ")):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",sn,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.fullTestbanks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.testbank_id,class:"published-bank"},[Object(n["createElementVNode"])("h3",null,Object(n["toDisplayString"])(e.name)+" (Chapter "+Object(n["toDisplayString"])(e.chapter_number)+", Section "+Object(n["toDisplayString"])(e.section_number)+")",1),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.questions,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.id,class:Object(n["normalizeClass"])(["question-box",{selected:l.selectedQuestionId===e.id}]),onClick:t=>a.toggleQuestionSelection(e.id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.question_text),1),t[25]||(t[25]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[10]||(t[10]=Object(n["createElementVNode"])("strong",null,"Type:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.type),1)]),t[26]||(t[26]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[11]||(t[11]=Object(n["createElementVNode"])("strong",null,"Chapter:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.chapter_number||"N/A"),1)]),t[27]||(t[27]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[12]||(t[12]=Object(n["createElementVNode"])("strong",null,"Section:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.section_number||"N/A"),1)]),t[28]||(t[28]=Object(n["createElementVNode"])("br",null,null,-1)),"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",dn,[t[13]||(t[13]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.true_false_answer?"True":"False"),1)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",bn,[t[14]||(t[14]=Object(n["createElementVNode"])("span",{class:"correct-answer"},"Correct Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.correct_option&&e.correct_option.option_text||"Not specified")+" ",1),t[15]||(t[15]=Object(n["createElementVNode"])("br",null,null,-1)),t[16]||(t[16]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Other Options:")],-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.incorrect_options,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t,class:"incorrect-answer"},Object(n["toDisplayString"])(e.option_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",un,[t[17]||(t[17]=Object(n["createElementVNode"])("strong",null,"Pairs:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.matches,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.prompt_text)+" - "+Object(n["toDisplayString"])(e.match_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",mn,[t[18]||(t[18]=Object(n["createElementVNode"])("strong",null,"Correct Answers:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.blanks,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.correct_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Short Answer"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",pn,[t[19]||(t[19]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.answer||"Not provided"),1)])):Object(n["createCommentVNode"])("",!0),"Essay"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",hn,[t[20]||(t[20]=Object(n["createElementVNode"])("strong",null,"Essay Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.grading_instructions||"None"),1)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",null,[t[21]||(t[21]=Object(n["createElementVNode"])("strong",null,"Grading Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.grading_instructions||"None"),1)]),e.feedback&&e.feedback.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",On,[t[23]||(t[23]=Object(n["createElementVNode"])("strong",null,"Feedback:",-1)),e.feedback&&e.feedback.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",jn,[void 0!==e.class_average?(Object(n["openBlock"])(),Object(n["createElementBlock"])("p",kn,[t[22]||(t[22]=Object(n["createElementVNode"])("strong",null,"Average Question Rating:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.class_average.toFixed(1))+"/100 ",1)])):Object(n["createCommentVNode"])("",!0)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.feedback,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},[Object(n["createElementVNode"])("em",null,Object(n["toDisplayString"])(e.username)+" ("+Object(n["toDisplayString"])(e.role)+")",1),Object(n["createTextVNode"])(': "'+Object(n["toDisplayString"])(e.comment_field)+'" ',1),void 0!==e.rating?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",gn," - Class Average: "+Object(n["toDisplayString"])(e.rating)+"/100",1)):Object(n["createCommentVNode"])("",!0)]))),128))])])):Object(n["createCommentVNode"])("",!0),e.attachment||e.attachments&&e.attachments.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Nn,[t[24]||(t[24]=Object(n["createElementVNode"])("strong",null,"Attachments:",-1)),Object(n["createElementVNode"])("ul",null,[e.attachment?(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",En,[Object(n["createElementVNode"])("img",{src:e.attachment.url,alt:e.attachment.name,style:{"max-width":"100%","margin-top":"10px"}},null,8,Vn)])):Object(n["createCommentVNode"])("",!0)])])):Object(n["createCommentVNode"])("",!0),l.selectedQuestionId===e.id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",yn,[Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>a.openFeedbackForm(e.id),["stop"])},"Leave Feedback",8,fn),Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>a.openTestBankModal(e.id),["stop"])},"Add to Draft Pool",8,wn)])):Object(n["createCommentVNode"])("",!0)],10,rn))),128))]))),128))]))])):Object(n["createCommentVNode"])("",!0),"published-tests"===l.viewing?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",vn,[l.loadingPublished?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",_n," Loading published tests... ")):0===l.fullTestbanks.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Bn," No published tests available for this course. ")):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Tn,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.fullTestbanks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.testbank_id,class:"published-bank"},[Object(n["createElementVNode"])("h3",null,Object(n["toDisplayString"])(e.name)+" (Chapter "+Object(n["toDisplayString"])(e.chapter_number)+", Section "+Object(n["toDisplayString"])(e.section_number)+")",1),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.questions,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.id,class:Object(n["normalizeClass"])(["question-box",{selected:l.selectedQuestionId===e.id}]),onClick:t=>a.toggleQuestionSelection(e.id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.question_text),1),t[44]||(t[44]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[29]||(t[29]=Object(n["createElementVNode"])("strong",null,"Type:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.type),1)]),t[45]||(t[45]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[30]||(t[30]=Object(n["createElementVNode"])("strong",null,"Chapter:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.chapter_number||"N/A"),1)]),t[46]||(t[46]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[31]||(t[31]=Object(n["createElementVNode"])("strong",null,"Section:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.section_number||"N/A"),1)]),t[47]||(t[47]=Object(n["createElementVNode"])("br",null,null,-1)),"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Cn,[t[32]||(t[32]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.true_false_answer?"True":"False"),1)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Fn,[t[33]||(t[33]=Object(n["createElementVNode"])("span",{class:"correct-answer"},"Correct Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.correct_option&&e.correct_option.option_text||"Not specified")+" ",1),t[34]||(t[34]=Object(n["createElementVNode"])("br",null,null,-1)),t[35]||(t[35]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Other Options:")],-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.incorrect_options,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t,class:"incorrect-answer"},Object(n["toDisplayString"])(e.option_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Sn,[t[36]||(t[36]=Object(n["createElementVNode"])("strong",null,"Pairs:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.matches,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.prompt_text)+" - "+Object(n["toDisplayString"])(e.match_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",In,[t[37]||(t[37]=Object(n["createElementVNode"])("strong",null,"Correct Answers:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.blanks,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.correct_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Short Answer"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Dn,[t[38]||(t[38]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.answer||"Not provided"),1)])):Object(n["createCommentVNode"])("",!0),"Essay"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",qn,[t[39]||(t[39]=Object(n["createElementVNode"])("strong",null,"Essay Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.grading_instructions||"None"),1)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",null,[t[40]||(t[40]=Object(n["createElementVNode"])("strong",null,"Grading Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.grading_instructions||"None"),1)]),e.feedback&&e.feedback.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",An,[t[42]||(t[42]=Object(n["createElementVNode"])("strong",null,"Feedback:",-1)),e.feedback&&e.feedback.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Qn,[void 0!==e.class_average?(Object(n["openBlock"])(),Object(n["createElementBlock"])("p",Pn,[t[41]||(t[41]=Object(n["createElementVNode"])("strong",null,"Average Question Rating:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.class_average.toFixed(1))+"/100 ",1)])):Object(n["createCommentVNode"])("",!0)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.feedback,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},[Object(n["createElementVNode"])("em",null,Object(n["toDisplayString"])(e.username)+" ("+Object(n["toDisplayString"])(e.role)+")",1),Object(n["createTextVNode"])(': "'+Object(n["toDisplayString"])(e.comment_field)+'" ',1),void 0!==e.rating?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",Mn," - Class Average: "+Object(n["toDisplayString"])(e.rating)+"/100",1)):Object(n["createCommentVNode"])("",!0)]))),128))])])):Object(n["createCommentVNode"])("",!0),e.attachment||e.attachments&&e.attachments.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Un,[t[43]||(t[43]=Object(n["createElementVNode"])("strong",null,"Attachments:",-1)),Object(n["createElementVNode"])("ul",null,[e.attachment?(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",$n,[Object(n["createElementVNode"])("img",{src:e.attachment.url,alt:e.attachment.name,style:{"max-width":"100%","margin-top":"10px"}},null,8,Ln)])):Object(n["createCommentVNode"])("",!0)])])):Object(n["createCommentVNode"])("",!0),l.selectedQuestionId===e.id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",zn,[Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>a.openFeedbackForm(e.id),["stop"])},"Leave Feedback",8,Rn),Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>a.openTestBankModal(e.id),["stop"])},"Add to Draft Pool",8,Hn)])):Object(n["createCommentVNode"])("",!0)],10,xn))),128))]))),128))]))])):Object(n["createCommentVNode"])("",!0)]),l.showFeedbackForm?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Wn,[Object(n["createElementVNode"])("div",Jn,[t[49]||(t[49]=Object(n["createElementVNode"])("h2",null,"Leave Feedback",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>l.feedbackText=e),rows:"5",style:{width:"100%"},placeholder:"Enter your comment here..."},null,512),[[n["vModelText"],l.feedbackText]]),t[50]||(t[50]=Object(n["createElementVNode"])("br",null,null,-1)),t[51]||(t[51]=Object(n["createElementVNode"])("br",null,null,-1)),t[52]||(t[52]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Please enter class average for this question: (0–100):")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>l.feedbackRating=e),min:"0",max:"100",style:{width:"100%"}},null,512),[[n["vModelText"],l.feedbackRating]]),t[53]||(t[53]=Object(n["createElementVNode"])("br",null,null,-1)),t[54]||(t[54]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("div",Gn,[Object(n["createElementVNode"])("button",{class:"btn",onClick:t[4]||(t[4]=(...e)=>a.submitFeedback&&a.submitFeedback(...e))},"Submit"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[5]||(t[5]=(...e)=>a.closeFeedbackForm&&a.closeFeedbackForm(...e))},"Cancel")])])])):Object(n["createCommentVNode"])("",!0),l.showTestBankModal?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Kn,[Object(n["createElementVNode"])("div",Yn,[t[55]||(t[55]=Object(n["createElementVNode"])("h2",null,"Select draft pool to add question to:",-1)),Object(n["createElementVNode"])("div",Xn,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.unpublishedDraftPools,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.testbank_id,style:{"margin-bottom":"10px",width:"100%"}},[Object(n["createElementVNode"])("button",{class:"t_button",style:{width:"100%"},onClick:t=>a.assignToDraftPool(e.testbank_id)},Object(n["toDisplayString"])(e.name),9,Zn)]))),128)),Object(n["createElementVNode"])("div",ec,[Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",style:{width:"100%","margin-top":"20px"},onClick:t[6]||(t[6]=(...e)=>a.closeTestBankModal&&a.closeTestBankModal(...e))}," Close ")])])])])):Object(n["createCommentVNode"])("",!0)])}var oc={name:"TeacherPubQ",data(){return{courseId:"",textbookId:"",fullTestbanks:[],viewing:"",showFeedbackForm:!1,selectedQuestionIdForFeedback:null,feedbackText:"",testBanks:[],selectedQuestionToAdd:null,showTestBankModal:!1,selectedQuestionId:null,loadingPublished:!1,feedbackRating:""}},mounted(){this.courseId=this.$route.query.course_id,this.fetchCourseTextbook(),this.fetchTeacherTestbanks()},computed:{unpublishedDraftPools(){return this.testBanks.filter(e=>!e.is_published)}},methods:{async fetchFeedback(){this.viewing="published",this.loadingPublished=!0;try{const e=await S.get("/resources/full-testbanks?course_id="+this.courseId,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.fullTestbanks=e.data.testbanks||[],console.log("Full published testbanks loaded:",this.fullTestbanks);for(const t of this.fullTestbanks)for(const e of t.questions)await this.loadFeedbackForQuestion(e),console.log("Fetched questions:",t.questions),e.attachment&&!e.attachments&&(e.attachments=[e.attachment])}catch(e){console.error("Failed to load testbanks:",e),alert("Could not load published testbanks.")}finally{this.loadingPublished=!1}},async fetchCourseTextbook(){try{const e=await S.get("/courses/"+this.courseId,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.textbookId=e.data.textbook_id,console.log("Fetched textbook ID:",this.textbookId)}catch(e){console.error("Failed to fetch course textbook:",e)}},async viewPublishedTests(){this.viewing="published-tests",this.fullTestbanks=[],this.loadingPublished=!0;try{if(!this.textbookId){const e=await S.get("/courses/"+this.courseId,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.textbookId=e.data.textbook_id}const t=await S.get("/courses",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),o=(t.data||[]).filter(e=>e.textbook_id==this.textbookId).map(e=>e.course_id),n=await S.get("/tests/published",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),c=(n.data||[]).filter(e=>o.includes(e.course_id));for(const l of c)try{const e=await S.get(`/resources/tests/${l.test_id}/questions`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),t=e.data.questions||[];for(const o of t)await this.loadFeedbackForQuestion(o),o.attachment&&!o.attachments&&(o.attachments=[o.attachment]),console.log("Attachment for question",o.id,":",o.attachment);this.fullTestbanks.push({testbank_id:l.test_id,name:l.name||"Test "+l.test_id,chapter_number:"N/A",section_number:"N/A",questions:t})}catch(e){console.error("❌ Failed to fetch questions for test ID "+l.test_id,e)}finally{this.loadingPublished=!1}console.log("✅ Published test questions loaded:",this.fullTestbanks)}catch(e){console.error("🚨 Failed to load published tests:",e)}},async fetchTeacherTestbanks(){try{const e=await S.get("/testbanks/teacher?course_id="+this.courseId,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.testBanks=e.data.testbanks||[]}catch(e){console.error("Failed to load teacher testbanks:",e)}},toggleQuestionSelection(e){this.selectedQuestionId=this.selectedQuestionId===e?null:e},openFeedbackForm(e){this.selectedQuestionIdForFeedback=e,this.feedbackText="",this.showFeedbackForm=!0},closeFeedbackForm(){this.selectedQuestionIdForFeedback=null,this.feedbackText="",this.showFeedbackForm=!1},async submitFeedback(){try{console.log("Submitting feedback:",{question_id:this.selectedQuestionIdForFeedback,comment_field:this.feedbackText,rating:this.feedbackRating}),await S.post("/feedback/create",{question_id:this.selectedQuestionIdForFeedback,comment_field:this.feedbackText,rating:this.feedbackRating||null},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.closeFeedbackForm()}catch(e){console.error("Error submitting feedback:",e),alert("❌ Failed to submit feedback.")}},openTestBankModal(e){this.selectedQuestionToAdd=e,this.showTestBankModal=!0},closeTestBankModal(){this.selectedQuestionToAdd=null,this.showTestBankModal=!1},async assignToDraftPool(e){try{await S.post(`/testbanks/${e}/questions`,{question_ids:[this.selectedQuestionToAdd]},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.closeTestBankModal()}catch(t){console.error("Failed to assign to draft pool:",t)}},async loadFeedbackForQuestion(e){try{const t=await S.get("/feedback/question/"+e.id,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),o=t.data.feedback||[];e.feedback=o.map(e=>({...e,comment_field:e.comment||e.comment_field})),e.newRating="",null!==t.data.class_average&&(e.class_average=t.data.class_average)}catch(t){console.error("Failed to load feedback for question "+e.id,t)}},async submitRating(e,t){try{await S.post("/feedback/create",{question_id:e,rating:t},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),alert("✅ Rating submitted!");const o=this.fullTestbanks.flatMap(e=>e.questions).find(t=>t.id===e);o&&await this.loadFeedbackForQuestion(o)}catch(o){console.error(`Error submitting rating for question ${e}:`,o),alert("❌ Failed to submit rating.")}}}};o("1ed8");const nc=r()(oc,[["render",tc],["__scopeId","data-v-6bde37a5"]]);var cc=nc;const lc={class:"theme-teacher"},ac={class:"top-banner"},sc={class:"banner-title"},rc={class:"t_banner-actions"},ic={key:0,class:"popup-overlay"},dc={class:"form-popup-modal"},bc={style:{"margin-top":"15px"}},uc={class:"page-wrapper"},mc={class:"button-row"},pc={class:"t_dropdown"},hc={class:"t_dropbtn"},Oc={class:"t_dropdown-content"},jc=["onClick"],kc={class:"t_dropdown"},gc={class:"t_dropdown-content"},Nc={id:"selectedQuestionType",style:{color:"#222"},class:"center large-paragraph"},Ec=["onClick"],Vc={key:0},yc={key:1},fc={key:2},wc={key:3},vc={key:4},_c=["src"],Bc={key:5,class:"button-group"},Tc=["onClick"],xc=["onClick"],Cc=["onClick"],Fc={class:"popup-overlay"},Sc={class:"form-popup-modal"},Ic={style:{display:"flex","flex-direction":"column","align-items":"flex-start"}},Dc=["onClick"],qc={class:"form-container",style:{width:"100%"}},Ac={key:1,class:"popup-overlay"},Qc={class:"form-popup-modal"},Pc={style:{"list-style-type":"none","padding-left":"0"}},Mc=["onClick"],Uc={class:"popup-overlay"},$c={class:"form-popup-modal"},Lc={key:0},zc={key:1},Rc=["value"],Hc={key:2},Wc={key:3},Jc={key:4},Gc=["onUpdate:modelValue"],Kc=["onUpdate:modelValue"],Yc=["onClick"],Xc={key:5},Zc={key:6},el={key:7},tl=["src"],ol={key:8},nl=["src"],cl={key:2,class:"popup-overlay"},ll={class:"form-popup-modal"};function al(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",lc,[Object(n["createElementVNode"])("div",ac,[Object(n["createElementVNode"])("div",sc,Object(n["toDisplayString"])(l.courseTitle),1),Object(n["createElementVNode"])("div",rc,[Object(n["createVNode"])(s,{to:"/TeacherHome",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[35]||(t[35]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[36]||(t[36]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),l.editBlockedPopup?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ic,[Object(n["createElementVNode"])("div",dc,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[2]||(t[2]=Object(n["withModifiers"])(()=>{},["prevent"]))},[t[37]||(t[37]=Object(n["createElementVNode"])("h1",null,"Cannot Edit Question",-1)),Object(n["createElementVNode"])("p",bc,Object(n["toDisplayString"])(l.editBlockedReason),1),t[38]||(t[38]=Object(n["createElementVNode"])("p",null,"A new copy will be made instead.",-1)),t[39]||(t[39]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn",onClick:t[0]||(t[0]=(...e)=>a.createCopyInstead&&a.createCopyInstead(...e))},"Create a Copy"),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[1]||(t[1]=e=>l.editBlockedPopup=!1)},"Cancel")],32)])])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",uc,[Object(n["createElementVNode"])("div",mc,[Object(n["createElementVNode"])("div",pc,[Object(n["createElementVNode"])("button",hc,Object(n["toDisplayString"])(l.selectedTestBank?l.selectedTestBank.name:"Select Draft Pool"),1),Object(n["createElementVNode"])("div",Oc,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.testBanks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("a",{key:e.testbank_id,href:"#",onClick:Object(n["withModifiers"])(t=>a.selectTestBank(e),["prevent"])},Object(n["toDisplayString"])(e.name),9,jc))),128))])]),Object(n["createVNode"])(s,{to:{path:"/TeacherNewTB",query:{courseId:l.courseId,courseTitle:l.courseTitle}}},{default:Object(n["withCtx"])(()=>t[40]||(t[40]=[Object(n["createElementVNode"])("button",{class:"t_button"},"New Draft Pool",-1)])),_:1},8,["to"]),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[3]||(t[3]=(...e)=>a.importTest&&a.importTest(...e))},"Import Test"),Object(n["createElementVNode"])("div",kc,[t[41]||(t[41]=Object(n["createElementVNode"])("button",{class:"t_dropbtn"},"Question Type",-1)),Object(n["createElementVNode"])("div",gc,[Object(n["createElementVNode"])("a",{onClick:t[4]||(t[4]=e=>a.selectQuestionType("True/False"))},"True/False"),Object(n["createElementVNode"])("a",{onClick:t[5]||(t[5]=e=>a.selectQuestionType("Multiple Choice"))},"Multiple Choice"),Object(n["createElementVNode"])("a",{onClick:t[6]||(t[6]=e=>a.selectQuestionType("Matching"))},"Matching"),Object(n["createElementVNode"])("a",{onClick:t[7]||(t[7]=e=>a.selectQuestionType("Fill in the Blank"))},"Fill in the Blank"),Object(n["createElementVNode"])("a",{onClick:t[8]||(t[8]=e=>a.selectQuestionType("Short Answer"))},"Short Answer"),Object(n["createElementVNode"])("a",{onClick:t[9]||(t[9]=e=>a.selectQuestionType("Essay"))},"Essay")])]),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[10]||(t[10]=e=>l.showCourseEditPopup=!0)},"Edit Course Info"),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[11]||(t[11]=(...e)=>a.edit&&a.edit(...e))},"New Question"),Object(n["createVNode"])(s,{to:{name:"TeacherPubQ",query:{course_id:l.courseId,textbook_id:l.textbookId}}},{default:Object(n["withCtx"])(()=>t[42]||(t[42]=[Object(n["createElementVNode"])("button",{class:"t_button"},"Community Resources",-1)])),_:1},8,["to"]),Object(n["createElementVNode"])("div",Nc,Object(n["toDisplayString"])(l.selectedQuestionType),1)]),t[43]||(t[43]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Note:"),Object(n["createTextVNode"])(" Import one Canvas quiz in the QTI at a time please.")],-1)),t[44]||(t[44]=Object(n["createElementVNode"])("hr",null,null,-1))]),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.questions,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:o,class:Object(n["normalizeClass"])(["question-box",{selected:l.selectedQuestionId===e.id}]),onClick:t=>a.toggleQuestionSelection(e.id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.text),1),t[58]||(t[58]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[45]||(t[45]=Object(n["createElementVNode"])("strong",null,"Type:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.type),1)]),t[59]||(t[59]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[46]||(t[46]=Object(n["createElementVNode"])("strong",null,"Chapter:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.chapter||"N/A"),1)]),t[60]||(t[60]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[47]||(t[47]=Object(n["createElementVNode"])("strong",null,"Section:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.section||"N/A"),1)]),t[61]||(t[61]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[48]||(t[48]=Object(n["createElementVNode"])("strong",null,"Points:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.points),1)]),t[62]||(t[62]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[49]||(t[49]=Object(n["createElementVNode"])("strong",null,"Estimated Time:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.time)+" minutes",1)]),t[63]||(t[63]=Object(n["createElementVNode"])("br",null,null,-1)),"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Vc,[t[50]||(t[50]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.answer?"True":"False"),1)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",yc,[t[51]||(t[51]=Object(n["createElementVNode"])("strong",null,"Correct Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.correctOption&&e.correctOption.option_text||"Not specified"),1),t[52]||(t[52]=Object(n["createElementVNode"])("br",null,null,-1)),t[53]||(t[53]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Other Options:")],-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.incorrectOptions,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t,class:"incorrect-answer"},Object(n["toDisplayString"])(e.option_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",fc,[t[54]||(t[54]=Object(n["createElementVNode"])("strong",null,"Correct Answer(s):",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.blanks,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.correct_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",wc,[t[55]||(t[55]=Object(n["createElementVNode"])("strong",null,"Pairs:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.pairs,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.term)+" - "+Object(n["toDisplayString"])(e.definition),1))),128))])])):Object(n["createCommentVNode"])("",!0),e.image_url?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",vc,[t[56]||(t[56]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Attached Image:")],-1)),Object(n["createElementVNode"])("img",{src:e.image_url,alt:"Question Attachment:",style:{"max-width":"100%","max-height":"400px","margin-bottom":"10px"}},null,8,_c)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("span",null,[t[57]||(t[57]=Object(n["createElementVNode"])("strong",null,"Grading Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.instructions||"None"),1)]),t[64]||(t[64]=Object(n["createElementVNode"])("br",null,null,-1)),l.selectedQuestionId===e.id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Bc,[Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>a.editQuestion(e),["stop"])},"Edit",8,Tc),Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>a.deleteQuestion(e.id),["stop"])},"Delete",8,xc),Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>a.openAddToTestBank(e.id),["stop"])},"Add to Draft Pool",8,Cc)])):Object(n["createCommentVNode"])("",!0)],10,Ec))),128))]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",Fc,[Object(n["createElementVNode"])("div",Sc,[t[65]||(t[65]=Object(n["createElementVNode"])("h2",null,"Select draft pool to add question to:",-1)),Object(n["createElementVNode"])("div",Ic,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.testBanks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.testbank_id,style:{"margin-bottom":"10px",width:"100%"}},[Object(n["createElementVNode"])("button",{class:"t_button",style:{width:"100%"},onClick:t=>a.assignQuestionToTestBank(e.testbank_id)},Object(n["toDisplayString"])(e.name),9,Dc)]))),128)),Object(n["createElementVNode"])("div",qc,[Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",style:{width:"100%"},onClick:t[12]||(t[12]=(...e)=>a.closeAddToTBModal&&a.closeAddToTBModal(...e))}," Close ")])])])],512),[[n["vShow"],l.showAddToTBModal]]),Object(n["createElementVNode"])("input",{type:"file",id:"fileInput",style:{display:"none"},onChange:t[13]||(t[13]=(...e)=>a.handleFileUpload&&a.handleFileUpload(...e))},null,32),e.showPopup?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ac,[Object(n["createElementVNode"])("div",Qc,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[15]||(t[15]=Object(n["withModifiers"])(()=>{},["prevent"]))},[t[66]||(t[66]=Object(n["createElementVNode"])("h3",null,"Your Finalized Tests",-1)),Object(n["createElementVNode"])("ul",Pc,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.testFiles,t=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t.test_id},[t.download_url&&t.hasAnswerKey?(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:0,class:"t_button",onClick:o=>e.downloadTestAndKey(t)},Object(n["toDisplayString"])(t.name),9,Mc)):Object(n["createCommentVNode"])("",!0)]))),128))]),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[14]||(t[14]=(...e)=>a.closeForm&&a.closeForm(...e))},"Close")],32)])])):Object(n["createCommentVNode"])("",!0),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",Uc,[Object(n["createElementVNode"])("div",$c,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[30]||(t[30]=Object(n["withModifiers"])((...e)=>a.handleQuestionSave&&a.handleQuestionSave(...e),["prevent"]))},[Object(n["createElementVNode"])("h1",null,Object(n["toDisplayString"])(l.editingQuestionId?"Edit Question":"New Question"),1),t[76]||(t[76]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Chapter Number")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[16]||(t[16]=e=>l.chapter=e),required:""},null,512),[[n["vModelText"],l.chapter]]),t[77]||(t[77]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Section Number")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[17]||(t[17]=e=>l.section=e),required:""},null,512),[[n["vModelText"],l.section]]),t[78]||(t[78]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Question Type"),Object(n["createElementVNode"])("br")],-1)),l.editingQuestionId?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",zc,[Object(n["createElementVNode"])("input",{type:"text",value:l.selectedQuestionType,disabled:""},null,8,Rc)])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Lc,[Object(n["withDirectives"])(Object(n["createElementVNode"])("select",{"onUpdate:modelValue":t[18]||(t[18]=e=>l.selectedQuestionType=e),required:""},t[67]||(t[67]=[Object(n["createElementVNode"])("option",{disabled:"",value:""},"Select a type",-1),Object(n["createElementVNode"])("option",null,"True/False",-1),Object(n["createElementVNode"])("option",null,"Multiple Choice",-1),Object(n["createElementVNode"])("option",null,"Matching",-1),Object(n["createElementVNode"])("option",null,"Fill in the Blank",-1),Object(n["createElementVNode"])("option",null,"Short Answer",-1),Object(n["createElementVNode"])("option",null,"Essay",-1)]),512),[[n["vModelSelect"],l.selectedQuestionType]])])),t[79]||(t[79]=Object(n["createElementVNode"])("br",null,null,-1)),t[80]||(t[80]=Object(n["createElementVNode"])("br",null,null,-1)),t[81]||(t[81]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Question Text")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[19]||(t[19]=e=>l.question=e),required:""},null,512),[[n["vModelText"],l.question]]),"True/False"===l.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Hc,[t[69]||(t[69]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("select",{"onUpdate:modelValue":t[20]||(t[20]=e=>l.answer=e)},t[68]||(t[68]=[Object(n["createElementVNode"])("option",{value:"True"},"True",-1),Object(n["createElementVNode"])("option",{value:"False"},"False",-1)]),512),[[n["vModelSelect"],l.answer]])])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===l.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Wc,[t[70]||(t[70]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Correct Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[21]||(t[21]=e=>l.answer=e)},null,512),[[n["vModelText"],l.answer]]),t[71]||(t[71]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Incorrect Answer Choices (comma-separated)")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[22]||(t[22]=e=>l.answerChoices=e)},null,512),[[n["vModelText"],l.answerChoices]])])):Object(n["createCommentVNode"])("",!0),"Matching"===l.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Jc,[t[72]||(t[72]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Matching Pairs")],-1)),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.matchingPairs,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:t},[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t=>e.term=t,placeholder:"Term"},null,8,Gc),[[n["vModelText"],e.term]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t=>e.definition=t,placeholder:"Definition"},null,8,Kc),[[n["vModelText"],e.definition]]),Object(n["createElementVNode"])("button",{type:"button",onClick:e=>a.removePair(t)},"Remove",8,Yc)]))),128)),Object(n["createElementVNode"])("button",{type:"button",onClick:t[23]||(t[23]=(...e)=>a.addPair&&a.addPair(...e))},"Add Pair")])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===l.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Xc,[t[73]||(t[73]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Correct Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[24]||(t[24]=e=>l.answer=e)},null,512),[[n["vModelText"],l.answer]])])):Object(n["createCommentVNode"])("",!0),"Essay"===l.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Zc)):Object(n["createCommentVNode"])("",!0),t[82]||(t[82]=Object(n["createElementVNode"])("br",null,null,-1)),t[83]||(t[83]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Points Worth")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[25]||(t[25]=e=>l.points=e),required:""},null,512),[[n["vModelText"],l.points]]),t[84]||(t[84]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Estimated Time (in minutes)")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[26]||(t[26]=e=>l.time=e),required:""},null,512),[[n["vModelText"],l.time]]),t[85]||(t[85]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Grading Instructions")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[27]||(t[27]=e=>l.instructions=e),required:""},null,512),[[n["vModelText"],l.instructions]]),l.editingQuestionId?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",el,[t[74]||(t[74]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Upload Image")],-1)),Object(n["createElementVNode"])("input",{type:"file",onChange:t[28]||(t[28]=(...e)=>a.handleImageUpload&&a.handleImageUpload(...e)),accept:"image/*"},null,32),l.imagePreview?(Object(n["openBlock"])(),Object(n["createElementBlock"])("img",{key:0,src:l.imagePreview,alt:"Preview",style:{"max-width":"100%"}},null,8,tl)):Object(n["createCommentVNode"])("",!0)])),l.editingQuestionId&&l.imagePreview?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ol,[t[75]||(t[75]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Attached Image:")],-1)),Object(n["createElementVNode"])("img",{src:l.imagePreview,alt:"Attached Image",style:{"max-width":"100%","max-height":"300px","margin-bottom":"10px"}},null,8,nl)])):Object(n["createCommentVNode"])("",!0),t[86]||(t[86]=Object(n["createElementVNode"])("br",null,null,-1)),t[87]||(t[87]=Object(n["createElementVNode"])("br",null,null,-1)),t[88]||(t[88]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Save",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[29]||(t[29]=(...e)=>a.closeForm&&a.closeForm(...e))},"Close")],32)])],512),[[n["vShow"],l.showForm]]),l.showCourseEditPopup?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",cl,[Object(n["createElementVNode"])("div",ll,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[34]||(t[34]=Object(n["withModifiers"])((...e)=>a.saveCourseInfo&&a.saveCourseInfo(...e),["prevent"]))},[t[89]||(t[89]=Object(n["createElementVNode"])("h1",null,"Edit Course Info",-1)),t[90]||(t[90]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Course Title")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[31]||(t[31]=e=>l.editCourseTitle=e),required:""},null,512),[[n["vModelText"],l.editCourseTitle]]),t[91]||(t[91]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Course Number")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[32]||(t[32]=e=>l.editCourseNumber=e),required:""},null,512),[[n["vModelText"],l.editCourseNumber]]),t[92]||(t[92]=Object(n["createElementVNode"])("br",null,null,-1)),t[93]||(t[93]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Save",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[33]||(t[33]=e=>l.showCourseEditPopup=!1)},"Cancel")],32)])])):Object(n["createCommentVNode"])("",!0)])}var sl={name:"TeacherQuestions",data(){return{courseTitle:this.$route.query.courseTitle||"Untitled Course",courseId:this.$route.query.courseId||null,textbookId:this.$route.query.textbook_id,chapter:"",section:"",question:"",reference:"",answer:"",answerChoices:"",points:"",time:"",instructions:"",image:"",imagePreview:"",selectedQuestionType:"",matchingPairs:[],questions:[],selectedQuestionId:null,editingQuestionId:null,showForm:!1,selectedTestBank:null,testBanks:[],showCourseEditPopup:!1,editCourseTitle:this.$route.query.courseTitle||"",editCourseNumber:"",showAddToTBModal:!1,questionToAddToTB:null,oldMCOptionIds:[],editBlockedPopup:!1,editBlockedReason:""}},mounted(){const e=this.$route.params.id;console.log("Viewing testbank:",e),this.loadTestbanks(),this.$route.query.testBankName&&(this.selectedTestBank={name:this.$route.query.testBankName})},methods:{openAddToTestBank(e){this.questionToAddToTB=e,this.showAddToTBModal=!0},closeAddToTBModal(){this.questionToAddToTB=null,this.showAddToTBModal=!1},async assignQuestionToTestBank(e){if(this.questionToAddToTB)try{await S.post(`/testbanks/${e}/questions`,{question_ids:[this.questionToAddToTB]},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.closeAddToTBModal()}catch(t){console.error("Failed to add question to testbank:",t)}},openCourseEditPopup(){const e=this.courseTitle.trim().split(" ");this.editCourseNumber=e.length>1?e.pop():"",this.editCourseTitle=e.join(" "),this.showCourseEditPopup=!0},async saveCourseInfo(){try{await S.patch("/courses/"+this.courseId,{course_name:this.editCourseTitle,course_number:this.editCourseNumber},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});const e=`${this.editCourseTitle} ${this.editCourseNumber}`.trim();this.courseTitle=e,document.title=e,this.showCourseEditPopup=!1}catch(e){console.error("Failed to update course:",e)}},async loadTestbanks(){try{const e=await S.get("/testbanks/teacher?course_id="+this.courseId,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.testBanks=e.data.testbanks}catch(e){console.error("Failed to load teacher testbanks:",e)}},selectTestBank(e){this.selectedTestBank=e,this.selectedTestbankId=e.value,this.$router.push({name:"TeacherViewTB",params:{id:e.testbank_id},query:{courseId:this.courseId,courseTitle:this.courseTitle,testBankId:e.testbank_id,testBankName:e.name,chapter:e.chapter_number,section:e.section_number}})},async fetchQuestions(e){this.selectedQuestionType=e;try{const t=await S.get("/questions",{headers:{Authorization:"Bearer "+localStorage.getItem("token")},params:{course_id:this.$route.query.courseId,type:e}});console.log("Questions fetched:",t.data),Array.isArray(t.data.questions)?this.questions=t.data.questions.map(e=>{const t={text:e.question_text,type:e.type,points:e.default_points,id:e.id,instructions:e.grading_instructions||"",time:e.est_time,chapter:e.chapter_number,section:e.section_number,image_url:e.attachment&&e.attachment.url?e.attachment.url:""};switch(e.type){case"True/False":return{...t,answer:e.true_false_answer};case"Multiple Choice":return{...t,correctOption:e.correct_option||null,incorrectOptions:e.incorrect_options||[]};case"Matching":return{...t,pairs:(e.matches||[]).map(e=>({match_id:e.match_id,term:e.prompt_text,definition:e.match_text}))};case"Fill in the Blank":return{...t,blanks:e.blanks||[],instructions:e.grading_instructions||""};case"Short Answer":return{...t,answer:e.answer||""};case"Essay":return{...t,instructions:e.instructions||""};default:return t}}):this.questions=[]}catch(t){console.error("Error fetching questions:",t),this.questions=[]}},displayQuestionType(e){this.selectedQuestionType="Selected Question Type: "+e},created(){console.log("Query Parameters:",this.$route.query)},importTest(){document.getElementById("fileInput").click()},async handleFileUpload(e){const t=e.target.files[0];if(!t)return void alert("No file selected.");const o=new FormData;o.append("file",t);try{const e=await S.post("/qti/upload",o,{headers:{Authorization:"Bearer "+localStorage.getItem("token"),"Content-Type":"multipart/form-data"}}),t=e.data.file_path;console.log("File uploaded successfully:",t);const n=await S.post("/qti/import",{file_path:t},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),c=n.data.import_id;console.log("QTI import created. Import ID:",c);const l=await S.post("qti/save/"+c,{course_id:this.courseId},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Questions imported successfully:",l.data),this.fetchQuestions(this.selectedQuestionType)}catch(n){console.error("QTI import Failed:",n)}},async handleQuestionSave(){try{let e,t;const o=this.questions.find(e=>e.id===this.editingQuestionId),n=!!this.editingQuestionId,c={question_text:this.question,default_points:parseInt(this.points),est_time:parseInt(this.time),chapter_number:this.chapter,section_number:this.section,grading_instructions:this.instructions,type:this.selectedQuestionType,source:"manual",course_id:this.courseId};let l=[];if("Multiple Choice"===this.selectedQuestionType){const e=this.answerChoices.split(",").map(e=>e.trim()).filter(Boolean),t=this.answer.trim();if(!t)return void alert("Correct answer cannot be empty.");if(l.push({option_text:t,is_correct:!0}),e.forEach(e=>{l.push({option_text:e,is_correct:!1})}),!l.some(e=>e.is_correct))return void alert("Multiple Choice questions must have at least one correct answer.")}if(this.image){e=new FormData,e.append("file",this.image);for(const[t,o]of Object.entries(c))e.append(t,o);switch(this.selectedQuestionType){case"True/False":e.append("true_false_answer","True"===this.answer);break;case"Multiple Choice":e.append("options",JSON.stringify(l)),n&&this.oldMCOptionIds.length>0&&e.append("to_delete",JSON.stringify(this.oldMCOptionIds));break;case"Matching":if(e.append("matches",JSON.stringify(this.matchingPairs.map(e=>({prompt_text:e.term,match_text:e.definition})))),n&&o){const t=(o.pairs||[]).map(e=>e.match_id);e.append("to_delete",JSON.stringify(t))}break;case"Fill in the Blank":if(e.append("blanks",JSON.stringify([{correct_text:this.answer}])),n&&o){const t=(o.blanks||[]).map(e=>e.blank_id);e.append("to_delete",JSON.stringify(t))}break;case"Short Answer":e.append("answer",this.answer);break;case"Essay":e.append("grading_instructions",this.instructions);break}t={headers:{Authorization:"Bearer "+localStorage.getItem("token"),"Content-Type":"multipart/form-data"}}}else{switch(e={...c},this.selectedQuestionType){case"True/False":e.true_false_answer="True"===this.answer;break;case"Multiple Choice":e.options=l,n&&this.oldMCOptionIds.length>0&&(e.to_delete=this.oldMCOptionIds);break;case"Matching":if(e.matches=this.matchingPairs.map(e=>({prompt_text:e.term,match_text:e.definition})),n&&o){const t=(o.pairs||[]).map(e=>e.match_id);e.to_delete=t}break;case"Fill in the Blank":if(e.blanks=[{correct_text:this.answer}],n&&o){const t=(o.blanks||[]).map(e=>e.blank_id);e.to_delete=t}break;case"Short Answer":e.answer=this.answer;break;case"Essay":e.grading_instructions=this.instructions;break}t={headers:{Authorization:"Bearer "+localStorage.getItem("token")}}}n?await S.patch("/questions/"+this.editingQuestionId,e,t):await S.post("/questions",e,t),this.closeForm(),this.resetForm(),this.fetchQuestions(this.selectedQuestionType)}catch(e){let t="Something went wrong.";e&&e.response&&e.response.data&&(t=e.response.data.error||e.response.data.message||t),console.error("Error saving question:",e)}},selectQuestionType(e){this.selectedQuestionType="Selected Question Type: "+e,this.fetchQuestions(e)},edit(){this.resetForm(),this.showForm=!0},closeForm(){this.showForm=!1},addPair(){this.matchingPairs.push({term:"",definition:""})},removePair(e){this.matchingPairs.splice(e,1)},handleImageUpload(e){const t=e.target.files[0];if(t){this.image=t;const e=new FileReader;e.onload=e=>{this.imagePreview=e.target.result},e.readAsDataURL(t)}},resetForm(){this.chapter="",this.section="",this.question="",this.reference="",this.answer="",this.answerChoices="",this.points="",this.time="",this.instructions="",this.image="",this.imagePreview="",this.matchingPairs=[],this.selectedQuestionType="",this.editingQuestionId=null,this.image="",this.imagePreview=""},async editQuestion(e){try{const t=await S.get(`/questions/${e.id}/used_in`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(t.data.is_used)return this.editBlockedReason=`This question is used in a "${t.data.tests[0].status}" test: "${t.data.tests[0].name}".`,this.editingQuestionId=e.id,void(this.editBlockedPopup=!0)}catch(o){return console.error("Error checking question status:",o),void alert("Could not verify question status.")}this.editingQuestionId=e.id,this.question=e.text,this.chapter=e.chapter,this.section=e.section,this.points=e.points,this.time=e.time,this.instructions=e.grading_instructions,this.answer=e.answer||"",this.selectedQuestionType=e.type,"Multiple Choice"===e.type?(this.answer=e.correctOption&&e.correctOption.option_text||"",this.answerChoices=(e.incorrectOptions||[]).map(e=>e.option_text).join(", "),this.oldMCOptionIds=[],e.correctOption&&e.correctOption.option_id&&this.oldMCOptionIds.push(e.correctOption.option_id),Array.isArray(e.incorrectOptions)&&e.incorrectOptions.forEach(e=>{e.option_id&&this.oldMCOptionIds.push(e.option_id)})):"Matching"===e.type&&(this.matchingPairs=(e.pairs||[]).map(e=>({term:e.term,definition:e.definition}))),this.imagePreview=e.image_url||"",this.image=null,this.showForm=!0;const t=document.getElementById("q_edit");t&&t.style&&(t.style.display="block")},toggleQuestionSelection(e){this.selectedQuestionId=this.selectedQuestionId===e?null:e},async deleteQuestion(e){if(confirm("Are you sure you want to delete this question?"))try{await S.delete("/questions/"+e,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.questions=this.questions.filter(t=>t.id!==e)}catch(t){console.error(t)}},async createCopyInstead(){try{await S.post(`/questions/${this.editingQuestionId}/copy_to_course`,{course_id:this.courseId},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});alert("A copy of the question was created. You can now edit it."),this.editBlockedPopup=!1,this.fetchQuestions(this.selectedQuestionType)}catch(e){console.error("Failed to create copy:",e),alert("Failed to create a copy of this question.")}}}};o("bc37");const rl=r()(sl,[["render",al],["__scopeId","data-v-0b9b87d2"]]);var il=rl;const dl={class:"theme-teacher"},bl={class:"top-banner"},ul={class:"banner-title"},ml={class:"t_banner-actions"},pl={class:"button-row"},hl={class:"export-note"},Ol={class:"export-note"},jl={key:0,class:"popup-overlay"},kl={class:"form-popup-modal"},gl={class:"form-container"},Nl={class:"popup-button-group"},El={key:1,class:"popup-overlay"},Vl={class:"form-popup-modal"},yl={class:"form-container"},fl={style:{display:"flex","justify-content":"center",gap:"10px","margin-top":"20px"}},wl={key:2,class:"popup-overlay"},vl={class:"form-popup-modal"},_l={class:"button-group"},Bl={key:3,class:"popup-overlay"},Tl={class:"form-popup-modal"},xl=["value"],Cl={key:0},Fl={key:1},Sl={key:2},Il=["onUpdate:modelValue"],Dl={key:3},ql=["onUpdate:modelValue"],Al=["onUpdate:modelValue"],Ql={class:"question-list-container"},Pl=["onClick"],Ml={class:"drag-header"},Ul={key:0,class:"question-image-preview"},$l=["src"],Ll={key:1},zl={type:"A"},Rl={class:"question-type-label"},Hl={key:2},Wl={class:"correct-answer-display"},Jl={class:"question-type-label"},Gl={key:3},Kl={class:"matching-container"},Yl={class:"matching-prompts"},Xl={class:"matching-answers"},Zl={class:"matching-footer"},ea={class:"correct-answer-display"},ta={class:"question-type-label"},oa={key:4},na={class:"correct-answer-display"},ca={class:"question-type-label"},la={key:5},aa={class:"correct-answer-display"},sa={class:"question-type-label"},ra={key:6},ia={key:7,class:"button-group"},da=["onClick"],ba=["onClick"];function ua(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link"),r=Object(n["resolveComponent"])("draggable");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",dl,[Object(n["createElementVNode"])("div",bl,[Object(n["createElementVNode"])("div",ul,Object(n["toDisplayString"])(l.testOptions.testName||"Test Template"),1),Object(n["createElementVNode"])("div",ml,[Object(n["createVNode"])(s,{to:"/TeacherHome",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[19]||(t[19]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[20]||(t[20]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",pl,[Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[0]||(t[0]=e=>l.showBackWarning=!0)},"Back to Draft Pool"),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[1]||(t[1]=e=>l.exportWarning=!0)},"Export Test to Document")]),t[53]||(t[53]=Object(n["createElementVNode"])("p",{class:"export-note"},[Object(n["createElementVNode"])("strong",null,"Note:"),Object(n["createTextVNode"])(" Anything displayed in "),Object(n["createElementVNode"])("span",{class:"green-text"},"green"),Object(n["createTextVNode"])(" will not appear on the student test but will be included in the test key. "),Object(n["createElementVNode"])("br"),Object(n["createTextVNode"])(" If selected, a cover page and any uploaded graphic will be added automatically to the exported document. ")],-1)),Object(n["createElementVNode"])("p",hl,[t[21]||(t[21]=Object(n["createElementVNode"])("strong",null,"Total Test Time:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(a.totalEstimatedTime)+" minutes ",1)]),Object(n["createElementVNode"])("p",Ol,[t[22]||(t[22]=Object(n["createElementVNode"])("strong",null,"Total Points:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(a.totalPoints)+" points ",1)]),t[54]||(t[54]=Object(n["createElementVNode"])("hr",null,null,-1)),l.showBackWarning?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",jl,[Object(n["createElementVNode"])("div",kl,[Object(n["createElementVNode"])("div",gl,[t[23]||(t[23]=Object(n["createElementVNode"])("h2",{style:{"text-align":"center"}},"Warning",-1)),t[24]||(t[24]=Object(n["createElementVNode"])("p",{style:{"text-align":"center","font-size":"18px"}}," If you go back to the Draft Pool, any unsaved changes on this page may be lost. ",-1)),Object(n["createElementVNode"])("div",Nl,[Object(n["createElementVNode"])("button",{class:"btn",onClick:t[2]||(t[2]=(...e)=>a.confirmBack&&a.confirmBack(...e))},"Continue"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[3]||(t[3]=e=>l.showBackWarning=!1)},"Cancel")])])])])):Object(n["createCommentVNode"])("",!0),l.exportWarning?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",El,[Object(n["createElementVNode"])("div",Vl,[Object(n["createElementVNode"])("div",yl,[t[25]||(t[25]=Object(n["createElementVNode"])("h2",{style:{"text-align":"center"}},"Confirm Export",-1)),t[26]||(t[26]=Object(n["createElementVNode"])("p",{style:{"text-align":"center","font-size":"18px"}}," Exporting will generate a Word document based on the current test setup. Any unsaved changes will not be included. Continue? ",-1)),Object(n["createElementVNode"])("div",fl,[Object(n["createElementVNode"])("button",{class:"btn",onClick:t[4]||(t[4]=(...e)=>a.confirmExport&&a.confirmExport(...e))},"Yes, Export"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[5]||(t[5]=e=>l.exportWarning=!1)},"Cancel")])])])])):Object(n["createCommentVNode"])("",!0),l.editBlockedPopup?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",wl,[Object(n["createElementVNode"])("div",vl,[t[27]||(t[27]=Object(n["createElementVNode"])("h2",null,"Cannot Edit Question",-1)),Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(l.editBlockedReason),1),t[28]||(t[28]=Object(n["createElementVNode"])("p",null,"A new copy will be made and inserted to your draft pool instead.",-1)),Object(n["createElementVNode"])("div",_l,[Object(n["createElementVNode"])("button",{onClick:t[6]||(t[6]=(...e)=>a.createCopyInstead&&a.createCopyInstead(...e))},"Create a Copy"),Object(n["createElementVNode"])("button",{onClick:t[7]||(t[7]=e=>l.editBlockedPopup=!1)},"Cancel")])])])):Object(n["createCommentVNode"])("",!0),l.showEditForm?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Bl,[Object(n["createElementVNode"])("div",Tl,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[17]||(t[17]=Object(n["withModifiers"])((...e)=>a.saveEditedQuestion&&a.saveEditedQuestion(...e),["prevent"]))},[t[35]||(t[35]=Object(n["createElementVNode"])("h2",null,"Edit Question",-1)),t[36]||(t[36]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Chapter Number")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=e=>l.editForm.chapter=e),required:""},null,512),[[n["vModelText"],l.editForm.chapter]]),t[37]||(t[37]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Section Number")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>l.editForm.section=e),required:""},null,512),[[n["vModelText"],l.editForm.section]]),t[38]||(t[38]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Question Text")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=e=>l.editForm.question_text=e),required:""},null,512),[[n["vModelText"],l.editForm.question_text]]),t[39]||(t[39]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Question Type")],-1)),Object(n["createElementVNode"])("input",{type:"text",value:l.editForm.type,disabled:""},null,8,xl),"True/False"===l.editForm.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Cl,[t[30]||(t[30]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("select",{"onUpdate:modelValue":t[11]||(t[11]=e=>l.editForm.true_false_answer=e)},t[29]||(t[29]=[Object(n["createElementVNode"])("option",{value:!0},"True",-1),Object(n["createElementVNode"])("option",{value:!1},"False",-1)]),512),[[n["vModelSelect"],l.editForm.true_false_answer]])])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===l.editForm.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Fl,[t[31]||(t[31]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Correct Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>l.editForm.correct_option.option_text=e)},null,512),[[n["vModelText"],l.editForm.correct_option.option_text]]),t[32]||(t[32]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Incorrect Answers (readonly)")],-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.editForm.incorrect_options,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.option_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===l.editForm.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Sl,[t[33]||(t[33]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Blanks")],-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.editForm.blanks,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t=>e.correct_text=t},null,8,Il),[[n["vModelText"],e.correct_text]])]))),128))])])):Object(n["createCommentVNode"])("",!0),"Matching"===l.editForm.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Dl,[t[34]||(t[34]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Matching Pairs")],-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.editForm.matches,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t=>e.prompt_text=t,placeholder:"Prompt"},null,8,ql),[[n["vModelText"],e.prompt_text]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t=>e.match_text=t,placeholder:"Match"},null,8,Al),[[n["vModelText"],e.match_text]])]))),128))])])):Object(n["createCommentVNode"])("",!0),t[40]||(t[40]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Points")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>l.editForm.points=e),required:""},null,512),[[n["vModelText"],l.editForm.points]]),t[41]||(t[41]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Estimated Time (in minutes)")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>l.editForm.est_time=e),required:""},null,512),[[n["vModelText"],l.editForm.est_time]]),t[42]||(t[42]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Grading Instructions")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=e=>l.editForm.grading_instructions=e)},null,512),[[n["vModelText"],l.editForm.grading_instructions]]),t[43]||(t[43]=Object(n["createElementVNode"])("br",null,null,-1)),t[44]||(t[44]=Object(n["createElementVNode"])("br",null,null,-1)),t[45]||(t[45]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Save",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[16]||(t[16]=e=>l.showEditForm=!1)},"Cancel")],32)])])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",Ql,[Object(n["createVNode"])(r,{modelValue:l.questions,"onUpdate:modelValue":t[18]||(t[18]=e=>l.questions=e),"item-key":"id",class:"drag-list",handle:".drag-handle",onUpdate:a.saveOrder},{header:Object(n["withCtx"])(()=>t[46]||(t[46]=[])),item:Object(n["withCtx"])(({element:e,index:o})=>[Object(n["createElementVNode"])("div",{class:Object(n["normalizeClass"])(["question-box",{selected:l.selectedQuestionId===e.id}]),onClick:t=>a.toggleQuestionSelection(e.id)},[Object(n["createElementVNode"])("div",Ml,[t[47]||(t[47]=Object(n["createElementVNode"])("span",{class:"drag-handle",title:"Drag to reorder"},"✥",-1)),Object(n["createElementVNode"])("h3",null,Object(n["toDisplayString"])(o+1)+". "+Object(n["toDisplayString"])(e.question_text),1)]),e.attachment&&e.attachment.url?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ul,[Object(n["createElementVNode"])("img",{src:e.attachment.url,alt:"Question Image",style:{"max-width":"100%","max-height":"300px","margin-top":"10px","margin-bottom":"10px"}},null,8,$l)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ll,[Object(n["createElementVNode"])("ol",zl,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.shuffleOptions(e),(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:e.option_id||t,class:Object(n["normalizeClass"])({"correct-answer":e.is_correct})},Object(n["toDisplayString"])(e.option_text),3))),128))]),Object(n["createElementVNode"])("div",Rl,Object(n["toDisplayString"])(e.type),1)])):"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Hl,[t[48]||(t[48]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Answer:"),Object(n["createTextVNode"])(" __________________________")],-1)),Object(n["createElementVNode"])("p",Wl," Correct Answer: "+Object(n["toDisplayString"])(e.blanks.map(e=>e.correct_text).join(", ")),1),Object(n["createElementVNode"])("div",Jl,Object(n["toDisplayString"])(e.type),1)])):"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Gl,[Object(n["createElementVNode"])("div",Kl,[Object(n["createElementVNode"])("div",Yl,[t[49]||(t[49]=Object(n["createElementVNode"])("h4",null,"Match the following:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.getShuffledMatches(e),(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(t+1)+". "+Object(n["toDisplayString"])(e.prompt_text),1))),128))])]),Object(n["createElementVNode"])("div",Xl,[t[50]||(t[50]=Object(n["createElementVNode"])("h4",null,"Answer Bank:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.getShuffledAnswerBank(e),(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(String.fromCharCode(65+t))+". "+Object(n["toDisplayString"])(e),1))),128))])])]),Object(n["createElementVNode"])("div",Zl,[Object(n["createElementVNode"])("p",ea," Correct Matches: "+Object(n["toDisplayString"])(a.getMatchingKeyString(e)),1),Object(n["createElementVNode"])("div",ta,Object(n["toDisplayString"])(e.type),1)])])):"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",oa,[t[51]||(t[51]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Answer:"),Object(n["createTextVNode"])(" __________________________")],-1)),Object(n["createElementVNode"])("p",na," Correct Answer: "+Object(n["toDisplayString"])(e.true_false_answer?"True":"False"),1),Object(n["createElementVNode"])("div",ca,Object(n["toDisplayString"])(e.type),1)])):"Short Answer"===e.type||"Essay"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",la,[Object(n["createElementVNode"])("p",aa," Grading Instructions: "+Object(n["toDisplayString"])(e.grading_instructions||"None provided"),1),Object(n["createElementVNode"])("div",sa,Object(n["toDisplayString"])(e.type),1)])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ra,[Object(n["createElementVNode"])("em",null,"Type: "+Object(n["toDisplayString"])(e.type),1)])),l.selectedQuestionId===e.id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ia,[Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>a.editQuestion(e),["stop"])},"Edit",8,da),Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>a.removeFromTest(e.id),["stop"])},"Remove from Test",8,ba)])):Object(n["createCommentVNode"])("",!0)],10,Pl)]),footer:Object(n["withCtx"])(()=>t[52]||(t[52]=[])),_:1},8,["modelValue","onUpdate"])])])}var ma=o("b76a"),pa=o.n(ma),ha=o("21a6"),Oa={components:{draggable:pa.a},data(){const e=JSON.parse(localStorage.getItem("testOptions")||"{}");return{questions:[],testOptions:{testName:e.testName||this.$route.query.testBankName||"Test Template",coverPage:!0===e.coverPage||"true"===e.coverPage,selectedTemplate:e.selectedTemplate||"All Questions",uploadedImage:e.uploadedImage||"",graphicPreview:e.graphicPreview||"",selectedTypes:this.$route.query.selectedTypes?JSON.parse(this.$route.query.selectedTypes):e.selectedTypes||[]},testBankId:this.$route.query.testBankId,showBackWarning:!1,hasUnsavedChanges:!0,publishWarning:!1,exportWarning:!1,selectedQuestionId:null,editingQuestionId:null,editBlockedPopup:!1,editBlockedReason:"",showEditForm:!1,editForm:{question_text:"",chapter:"",section:"",type:"",points:"",est_time:"",grading_instructions:""}}},mounted(){this.fetchQuestions(),window.addEventListener("beforeunload",this.confirmExit)},beforeDestroy(){window.removeEventListener("beforeunload",this.confirmExit)},watch:{questions:{deep:!0,handler(e){const t=e.map(e=>e.id);localStorage.setItem("questionOrder_"+this.testBankId,JSON.stringify(t))}}},computed:{totalEstimatedTime(){return this.questions.reduce((e,t)=>{const o=parseInt(t.est_time,10);return e+(isNaN(o)?0:o)},0)},totalPoints(){return this.questions.reduce((e,t)=>{const o=parseFloat(t.default_points);return e+(isNaN(o)?0:o)},0)}},methods:{async editQuestion(e){try{const t=await S.get(`/questions/${e.id}/used_in`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(t.data.is_used)return this.editBlockedReason=`This question is used in a "${t.data.tests[0].status}" test: "${t.data.tests[0].name}".`,this.editingQuestionId=e.id,void(this.editBlockedPopup=!0);this.editingQuestionId=e.id,this.editForm={question_text:e.question_text,chapter:e.chapter_number,section:e.section_number,type:e.type,points:e.default_points,est_time:e.est_time,grading_instructions:e.grading_instructions||"",correct_option:e.correct_option||null,incorrect_options:e.incorrect_options||[],blanks:e.blanks||[],matches:e.matches||[],true_false_answer:e.true_false_answer},this.showEditForm=!0}catch(t){console.error("Error checking question status:",t),alert("Could not verify question status.")}},async createCopyInstead(){try{const e=await S.post(`/questions/${this.editingQuestionId}/copy_to_course`,{course_id:this.$route.query.courseId},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),t=e.data.new_question_id;if(!t)throw new Error("New question ID not returned.");await S.delete(`/testbanks/${this.testBankId}/questions/${this.editingQuestionId}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});const o="questionOrder_"+this.testBankId,n=JSON.parse(localStorage.getItem(o)||"[]"),c=n.filter(e=>e!==this.editingQuestionId);localStorage.setItem(o,JSON.stringify(c)),await S.post(`/testbanks/${this.testBankId}/questions`,{question_ids:[t]},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),await this.fetchQuestions(),this.$nextTick(()=>{const e=this.questions.find(e=>e.id===t);if(!e)return void alert("Newly copied question not found after refresh.");const o=document.querySelector(`[data-id="${e.id}"]`);o&&o.scrollIntoView({behavior:"smooth",block:"center"}),this.editingQuestionId=e.id,this.selectedQuestionId=e.id,this.editForm={question_text:e.question_text,chapter:e.chapter_number,section:e.section_number,type:e.type,points:e.default_points,est_time:e.est_time,grading_instructions:e.grading_instructions||"",correct_option:e.correct_option||null,incorrect_options:e.incorrect_options||[],blanks:e.blanks||[],matches:e.matches||[],true_false_answer:e.true_false_answer},this.editBlockedPopup=!1,this.showEditForm=!0})}catch(e){console.error("❌ Failed to create or edit copy:",e),alert("An error occurred while replacing the uneditable question.")}},async saveEditedQuestion(){try{const e={question_text:this.editForm.question_text,chapter_number:this.editForm.chapter,section_number:this.editForm.section,default_points:parseFloat(this.editForm.points),est_time:parseInt(this.editForm.est_time),grading_instructions:this.editForm.grading_instructions};"True/False"===this.editForm.type&&(e.true_false_answer=this.editForm.true_false_answer),"Multiple Choice"===this.editForm.type&&(e.options=[{option_text:this.editForm.correct_option.option_text,is_correct:!0},...this.editForm.incorrect_options.map(e=>({option_text:e.option_text,is_correct:!1}))]),"Fill in the Blank"===this.editForm.type&&(e.blanks=this.editForm.blanks.map(e=>({correct_text:e.correct_text}))),"Matching"===this.editForm.type&&(e.matches=this.editForm.matches.map(e=>({prompt_text:e.prompt_text,match_text:e.match_text})));await S.patch("/questions/"+this.editingQuestionId,e,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});alert("✅ Question updated!"),this.showEditForm=!1,await this.fetchQuestions()}catch(e){console.error("❌ Failed to update question:",e),alert("Could not update question.")}},blobToFile(e,t){return new File([e],t,{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"})},async uploadAnswerKey(e,t){const o=new FormData;o.append("file",t);try{const t=await S.post(`/tests/${e}/upload_answer_key`,o,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+localStorage.getItem("token")}});console.log("✅ Answer key uploaded:",t.data)}catch(n){console.error("❌ Failed to upload answer key:",n),alert("The answer key could not be saved to the backend.")}},async publishTest(){try{const e=localStorage.getItem("finalizedTestId");if(!e)return void alert("❌ No finalized test found. Please export the test first.");await S.post(`/tests/${e}/publish`,{},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),alert("✅ Test successfully published!"),localStorage.removeItem("finalizedTestId")}catch(e){console.error("❌ Failed to publish test:",e.response&&e.response.data||e.message),alert("An error occurred while publishing. Check the console.")}},async finalizeTestBeforeExport(){try{const e=this.testOptions.selectedTemplate||"All Questions",t={test_bank_id:parseInt(this.testBankId),name:this.testOptions.testName,estimated_time:this.totalEstimatedTime>0?this.totalEstimatedTime:1,test_instructions:"",course_id:parseInt(this.$route.query.courseId),type:e};"All Questions"!==e&&(t.question_ids=this.questions.map(e=>e.id)),console.log("🟡 Finalizing test with payload:",t);const o=await S.post("/tests/finalize",t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(201===o.status){const e=o.data.test_id;return{testId:e,questionCount:o.data.question_count}}throw new Error("Finalize test failed with non-201 response")}catch(e){throw console.error("❌ Finalize error:",e.response&&e.response.data||e.message),alert("Failed to finalize test. See console for details."),e}},dataUrlToFile(e,t){const o=e.split(","),n=o[0].match(/:(.*?);/)[1],c=atob(o[1]);let l=c.length;const a=new Uint8Array(l);while(l--)a[l]=c.charCodeAt(l);return new File([a],t,{type:n})},async confirmExport(){this.exportWarning=!1;try{const e=await this.finalizeTestBeforeExport(),t=e.testId;localStorage.setItem("finalizedTestId",t),await this.exportToWord(e)}catch(e){console.error("Export canceled due to finalize error")}},confirmPublish(){this.publishWarning=!1,this.publishTest()},confirmExit(e){this.hasUnsavedChanges&&(e.preventDefault(),e.returnValue="")},confirmBack(){this.showBackWarning=!1,this.goBackTB()},goBackTB(){this.$router.push({path:"/TeacherViewTB",query:{courseId:this.$route.query.courseId,courseTitle:this.$route.query.courseTitle,testBankId:this.testBankId,testBankName:this.$route.query.testBankName}})},toggleQuestionSelection(e){this.selectedQuestionId=this.selectedQuestionId===e?null:e},removeFromTest(e){if(confirm("Remove this question from the test?")){this.questions=this.questions.filter(t=>t.id!==e),this.selectedQuestionId=null;const t="questionOrder_"+this.testBankId,o=JSON.parse(localStorage.getItem(t)||"[]"),n=o.filter(t=>t!==e);localStorage.setItem(t,JSON.stringify(n))}},async fetchQuestions(){try{const e=this.testOptions.selectedTypes||[],t={test_bank_id:this.testBankId};e.includes("All Questions")||(t.types=JSON.stringify(e));const o=await S.get("/tests/draft-questions",{params:t,headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),n=o.data.questions||[],c=localStorage.getItem("questionOrder_"+this.testBankId);let l=[];if(c){const e=JSON.parse(c),t=new Map(n.map(e=>[e.id,e]));l=e.map(e=>t.get(e)).filter(Boolean),n.forEach(t=>{e.includes(t.id)||l.push(t)})}else l=n;this.questions=JSON.parse(JSON.stringify(l)),this.questions.forEach(e=>{e._shuffledAnswers&&delete e._shuffledAnswers})}catch(e){console.error("❌ Failed to fetch questions:",e)}},saveOrder(){const e=this.questions.map(e=>e.id);localStorage.setItem("questionOrder_"+this.testBankId,JSON.stringify(e))},shuffleOptions(e){const t=[...e.incorrect_options,e.correct_option].map(e=>({...e,is_correct:!!e.is_correct}));for(let o=t.length-1;o>0;o--){const e=Math.floor(Math.random()*(o+1));[t[o],t[e]]=[t[e],t[o]]}return t},shuffleArray(e){const t=[...e];for(let o=t.length-1;o>0;o--){const e=Math.floor(Math.random()*(o+1));[t[o],t[e]]=[t[e],t[o]]}return t},getShuffledBlanks(e){return this.shuffleArray(e.blanks||[])},getShuffledMatches(e){const t=e.matches||[],o=t.map(e=>e.prompt_text),n=this.getShuffledAnswerBank(e);return o.map((e,t)=>({prompt_text:e,match_text:n[t]}))},getShuffledAnswerBank(e){if(!e._shuffledAnswers){const t=e.matches||[],o=this.shuffleArray(t.map(e=>e.match_text));e._shuffledAnswers=o}return e._shuffledAnswers},getMatchingKeyString(e){const t=this.getShuffledAnswerBank(e);return(e.matches||[]).map((e,o)=>{const n=t.findIndex(t=>t===e.match_text);return`${o+1} → ${String.fromCharCode(65+n)}`}).join(", ")},async exportToWord(e){const t=this.questions.reduce((e,t)=>{const o=parseFloat(t.default_points);return e+(isNaN(o)?0:o)},0),n=this.questions.reduce((e,t)=>{const o=parseInt(t.est_time,10);return e+(isNaN(o)?0:o)},0),c=t,l=this.totalEstimatedTime||n,{Document:a,Packer:s,Paragraph:r,TextRun:i,ImageRun:d,Table:b,TableRow:u,TableCell:m,HeadingLevel:p,AlignmentType:h,BorderStyle:O,ThematicBreak:j,WidthType:k}=await o.e("chunk-2d0d6e77").then(o.bind(null,"7514")),g=()=>new r(new j),N=new r({children:[],pageBreakBefore:!0}),E=()=>{const e=[new r({text:this.testOptions.testName,heading:p.TITLE,alignment:h.CENTER,spacing:{after:200}}),new r({text:"Version: XXXX",heading:p.HEADING_1,alignment:h.CENTER,spacing:{after:200}}),new r({text:"Name: __________________________",spacing:{after:400}}),new r({text:"Date: __________________________",spacing:{after:400}}),new r({text:"Course: "+(this.$route.query.courseTitle||"N/A")}),new r({text:"Time Allowed: "+(this.totalEstimatedTime||"N/A")+" minutes",spacing:{after:400}}),g(),new r({text:"Instructions:",heading:p.HEADING_2,spacing:{after:100}}),...[`This exam is worth ${c} points.`,`You have ${l||"N/A"} minutes to complete the exam.`,"Read each question carefully.","Be sure to answer all questions, do not leave anything blank.","Turn in all work and scratch paper with your exam.","You may not use any external materials unless permitted by the instructor.","This exam is closed-book, closed-notes, and no external devices or help.","Check your work before submitting."].map(e=>new r({text:e,bullet:{level:0},spacing:{after:100}})),N];return e},V=async()=>{const e=[new r({text:this.testOptions.testName+" - Version: XXXX",heading:p.HEADING_1,spacing:{after:300}}),new r({text:"Name: __________________________",spacing:{after:400}}),new r({text:`Score: ______ / ${c} points`,spacing:{after:400}}),g()];for(let o=0;o<this.questions.length;o++){const n=this.questions[o];if(n.attachment&&n.attachment.url)try{const t=await fetch(n.attachment.url),o=await t.arrayBuffer(),c=new Uint8Array(o);e.push(new r({children:[new d({data:c,transformation:{width:500,height:300}})],spacing:{after:100}}))}catch(t){console.warn(`⚠ Failed to fetch image for question ${o+1}:`,t)}if(e.push(new r({text:`${o+1}. ${n.question_text}`,spacing:{after:200}})),"Multiple Choice"===n.type){const t=this.shuffleOptions(n);t.forEach((t,o)=>{e.push(new r({text:`${String.fromCharCode(65+o)}. ${t.option_text}`,indent:{left:720},spacing:{after:100}}))})}else if("True/False"===n.type)e.push(new r("True/False: __________________________"));else if("Fill in the Blank"===n.type)e.push(new r("Blank: _____________________"));else if("Short Answer"===n.type)for(let t=0;t<15;t++)e.push(new r(" "));else if("Essay"===n.type)for(let t=0;t<30;t++)e.push(new r(" "));else if("Matching"===n.type){e.push(new r({spacing:{after:200}}));const t=this.getShuffledMatches(n),o=(this.getShuffledAnswerBank(n),t.map((e,t)=>{const o=`${t+1}. ${e.prompt_text}`,n=`${String.fromCharCode(65+t)}. ${e.match_text}`;return new u({children:[new m({width:{size:50,type:k.PERCENTAGE},children:[new r({text:o,spacing:{after:150}})],margins:{top:100,bottom:100}}),new m({width:{size:50,type:k.PERCENTAGE},children:[new r({text:n,spacing:{after:150}})],margins:{top:100,bottom:100}})]})}));e.push(new b({rows:o,width:{size:100,type:k.PERCENTAGE},borders:{top:{style:O.NONE,size:0,color:"FFFFFF"},bottom:{style:O.NONE,size:0,color:"FFFFFF"},left:{style:O.NONE,size:0,color:"FFFFFF"},right:{style:O.NONE,size:0,color:"FFFFFF"},insideHorizontal:{style:O.NONE,size:0,color:"FFFFFF"},insideVertical:{style:O.NONE,size:0,color:"FFFFFF"}}})),e.push(new r({text:" ",spacing:{after:300}}))}e.push(new r({text:" ",spacing:{after:300}}))}return e},y=()=>{const e=[new r({children:[new i({text:this.testOptions.testName+" - Test Key",bold:!0,size:32,color:"FF0000"})],spacing:{after:300}})];return this.questions.forEach((t,o)=>{let n="";if("Multiple Choice"===t.type){const e=this.shuffleOptions(t),o=e.findIndex(e=>e.is_correct);n=`Correct Answer: ${String.fromCharCode(65+o)}. ${e[o].option_text}`}else"True/False"===t.type?n="Correct Answer: "+(t.true_false_answer?"True":"False"):"Fill in the Blank"===t.type?n="Correct Answer: "+t.blanks.map(e=>e.correct_text).join(", "):"Short Answer"===t.type||"Essay"===t.type?n="Grading Instructions: "+(t.grading_instructions||"None"):"Matching"===t.type&&(n="Correct Matches: "+this.getMatchingKeyString(t));e.push(new r({text:`${o+1}. ${t.question_text}`,spacing:{after:100}}),new r({children:[new i({text:n,color:"FF0000"})],spacing:{after:300}}))}),e},f=async()=>{const e=[];if(this.testOptions.graphicPreview)try{const t=this.testOptions.graphicPreview.split(",")[1],o=window.atob(t),n=new Uint8Array(o.length);for(let e=0;e<o.length;e++)n[e]=o.charCodeAt(e);e.push(new r({children:[],pageBreakBefore:!0}),new r({text:"Resource Page",heading:p.HEADING_1,spacing:{after:300}}),new r({children:[new d({data:n,transformation:{width:500,height:300}})],spacing:{after:300}}))}catch(t){console.error("⚠ Failed to load image for resource page:",t),e.push(new r("⚠ Could not load the uploaded image."))}return e},w=await f(),v=new a({sections:[{properties:{},children:[].concat(this.testOptions.coverPage?E():[]).concat(await V()).concat(w)}],styles:{default:{document:{run:{font:"Arial",size:24}}}}}),_=new a({sections:[{properties:{},children:y()}],styles:{default:{document:{run:{font:"Arial",size:24}}}}}),[B,T]=await Promise.all([s.toBlob(v),s.toBlob(_)]),x=this.blobToFile(B,(this.testOptions.testName||"GeneratedTest")+".docx"),C=this.blobToFile(T,(this.testOptions.testName||"TestKey")+".key.docx"),F=e.testId;try{const e=new FormData;e.append("file",x),await S.post(`/tests/${F}/upload_pdf`,e,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+localStorage.getItem("token")}}),await this.uploadAnswerKey(F,C)}catch(I){console.error("❌ Upload failed:",I),alert("Failed to upload test or answer key.")}Object(ha["saveAs"])(B,(this.testOptions.testName||"GeneratedTest")+".docx"),Object(ha["saveAs"])(T,(this.testOptions.testName||"TestKey")+".key.docx")}}};o("c8e0");const ja=r()(Oa,[["render",ua],["__scopeId","data-v-f9825cd8"]]);var ka=ja;const ga={class:"theme-teacher"},Na={class:"top-banner"},Ea={class:"banner-title"},Va={style:{"font-size":"16px",color:"#222"}},ya={class:"t_banner-actions"},fa={class:"center large-paragraph",style:{color:"#222"}},wa={class:"button-row"},va={key:0,class:"popup-overlay"},_a={class:"form-popup-modal"},Ba={class:"form-container"},Ta={class:"popup-button-group"},xa={key:1,class:"popup-overlay"},Ca={class:"form-popup-modal"},Fa={class:"form-container"},Sa={style:{"text-align":"center"}},Ia={class:"popup-button-group",style:{"text-align":"center","margin-top":"1rem"}},Da={key:2,class:"popup-overlay"},qa={class:"form-popup-modal"},Aa={class:"center large-paragraph",style:{color:"#222"}},Qa={key:0,class:"popup-overlay"},Pa={class:"form-popup-modal"},Ma={class:"checkbox-label"},Ua={class:"checkbox-group"},$a={key:0,style:{"margin-top":"10px"}},La=["src"],za=["onClick"],Ra={key:0},Ha={key:1},Wa={key:2},Ja={key:3},Ga={key:4},Ka={key:5},Ya={key:6},Xa=["src"],Za={key:7,class:"button-group"},es=["onClick"];function ts(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ga,[Object(n["createElementVNode"])("div",Na,[Object(n["createElementVNode"])("div",Ea,[Object(n["createTextVNode"])("Test Draft: "+Object(n["toDisplayString"])(l.testBankName),1),t[22]||(t[22]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",Va," Chapter "+Object(n["toDisplayString"])(a.displayChapter||"N/A")+", Section "+Object(n["toDisplayString"])(a.displaySection||"N/A"),1)]),Object(n["createElementVNode"])("div",ya,[Object(n["createVNode"])(s,{to:"/TeacherHome",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[23]||(t[23]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[24]||(t[24]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",fa,[Object(n["createVNode"])(s,{to:{path:"/TeacherQuestions",query:{courseTitle:l.courseTitle,courseId:l.courseId}}},{default:Object(n["withCtx"])(()=>t[25]||(t[25]=[Object(n["createElementVNode"])("button",{class:"t_button"},"Return to Question Page",-1)])),_:1},8,["to"]),t[68]||(t[68]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("div",wa,[Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[0]||(t[0]=e=>l.showEditForm=!0)},"Edit Draft Pool Info"),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[1]||(t[1]=e=>l.showCreateTestWarning=!0)},"Create New Test"),t[26]||(t[26]=Object(n["createElementVNode"])("br",null,null,-1))]),t[69]||(t[69]=Object(n["createElementVNode"])("hr",null,null,-1)),l.showDeleteConfirm?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",va,[Object(n["createElementVNode"])("div",_a,[Object(n["createElementVNode"])("div",Ba,[t[27]||(t[27]=Object(n["createElementVNode"])("h2",{style:{"text-align":"center"}},"Confirm Removal",-1)),t[28]||(t[28]=Object(n["createElementVNode"])("p",{style:{"text-align":"center"}},"Are you sure you want to remove this question from the test bank?",-1)),Object(n["createElementVNode"])("div",Ta,[Object(n["createElementVNode"])("button",{class:"btn",onClick:t[2]||(t[2]=(...e)=>a.confirmRemoveQuestion&&a.confirmRemoveQuestion(...e))},"Yes, Remove"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[3]||(t[3]=e=>l.showDeleteConfirm=!1)},"Cancel")])])])])):Object(n["createCommentVNode"])("",!0),l.showInfoPopup?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",xa,[Object(n["createElementVNode"])("div",Ca,[Object(n["createElementVNode"])("div",Fa,[Object(n["createElementVNode"])("p",Sa,Object(n["toDisplayString"])(l.popupMessage),1),Object(n["createElementVNode"])("div",Ia,[Object(n["createElementVNode"])("button",{class:"btn",onClick:t[4]||(t[4]=e=>l.showInfoPopup=!1)},"OK")])])])])):Object(n["createCommentVNode"])("",!0),l.showEditForm?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Da,[Object(n["createElementVNode"])("div",qa,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[9]||(t[9]=Object(n["withModifiers"])((...e)=>a.updateTestBank&&a.updateTestBank(...e),["prevent"]))},[t[29]||(t[29]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Draft Pool Name:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>l.editForm.name=e),required:""},null,512),[[n["vModelText"],l.editForm.name]]),t[30]||(t[30]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Chapter Number:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>l.editForm.chapter=e),required:""},null,512),[[n["vModelText"],l.editForm.chapter]]),t[31]||(t[31]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Section Number:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=e=>l.editForm.section=e),required:""},null,512),[[n["vModelText"],l.editForm.section]]),t[32]||(t[32]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Save Changes",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[8]||(t[8]=e=>l.showEditForm=!1)},"Cancel")],32)])])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",Aa,[l.showCreateTestWarning?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Qa,[Object(n["createElementVNode"])("div",Pa,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[21]||(t[21]=Object(n["withModifiers"])((...e)=>a.goToCreateTest&&a.goToCreateTest(...e),["prevent"]))},[t[42]||(t[42]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Test Name:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=e=>l.testOptions.testName=e),placeholder:"Enter a name for this test",required:""},null,512),[[n["vModelText"],l.testOptions.testName]]),Object(n["createElementVNode"])("label",Ma,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=e=>l.testOptions.coverPage=e)},null,512),[[n["vModelCheckbox"],l.testOptions.coverPage]]),t[33]||(t[33]=Object(n["createTextVNode"])(" Add a cover page "))]),t[43]||(t[43]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Select Question Types for Your Test:")],-1)),Object(n["createElementVNode"])("div",Ua,[Object(n["createElementVNode"])("label",null,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"checkbox",value:"All Questions","onUpdate:modelValue":t[12]||(t[12]=e=>l.testOptions.selectedTypes=e)},null,512),[[n["vModelCheckbox"],l.testOptions.selectedTypes]]),t[34]||(t[34]=Object(n["createTextVNode"])(" All Questions "))]),Object(n["createElementVNode"])("label",null,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"checkbox",value:"True/False","onUpdate:modelValue":t[13]||(t[13]=e=>l.testOptions.selectedTypes=e)},null,512),[[n["vModelCheckbox"],l.testOptions.selectedTypes]]),t[35]||(t[35]=Object(n["createTextVNode"])(" True/False "))]),Object(n["createElementVNode"])("label",null,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"checkbox",value:"Multiple Choice","onUpdate:modelValue":t[14]||(t[14]=e=>l.testOptions.selectedTypes=e)},null,512),[[n["vModelCheckbox"],l.testOptions.selectedTypes]]),t[36]||(t[36]=Object(n["createTextVNode"])(" Multiple Choice "))]),Object(n["createElementVNode"])("label",null,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"checkbox",value:"Short Answer","onUpdate:modelValue":t[15]||(t[15]=e=>l.testOptions.selectedTypes=e)},null,512),[[n["vModelCheckbox"],l.testOptions.selectedTypes]]),t[37]||(t[37]=Object(n["createTextVNode"])(" Short Answer "))]),Object(n["createElementVNode"])("label",null,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"checkbox",value:"Essay","onUpdate:modelValue":t[16]||(t[16]=e=>l.testOptions.selectedTypes=e)},null,512),[[n["vModelCheckbox"],l.testOptions.selectedTypes]]),t[38]||(t[38]=Object(n["createTextVNode"])(" Essay "))]),Object(n["createElementVNode"])("label",null,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"checkbox",value:"Matching","onUpdate:modelValue":t[17]||(t[17]=e=>l.testOptions.selectedTypes=e)},null,512),[[n["vModelCheckbox"],l.testOptions.selectedTypes]]),t[39]||(t[39]=Object(n["createTextVNode"])(" Matching "))]),Object(n["createElementVNode"])("label",null,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"checkbox",value:"Fill in the Blank","onUpdate:modelValue":t[18]||(t[18]=e=>l.testOptions.selectedTypes=e)},null,512),[[n["vModelCheckbox"],l.testOptions.selectedTypes]]),t[40]||(t[40]=Object(n["createTextVNode"])(" Fill in the Blank "))])]),t[44]||(t[44]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Embedded Graphic:")],-1)),Object(n["createElementVNode"])("input",{type:"file",accept:"image/*",onChange:t[19]||(t[19]=(...e)=>a.handleGraphicUpload&&a.handleGraphicUpload(...e))},null,32),l.testOptions.graphicPreview?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",$a,[t[41]||(t[41]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Preview:")],-1)),Object(n["createElementVNode"])("img",{src:l.testOptions.graphicPreview,alt:"Uploaded Graphic Preview",style:{"max-width":"100%","max-height":"200px",border:"1px solid #ccc"}},null,8,La)])):Object(n["createCommentVNode"])("",!0),t[45]||(t[45]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Yes, Continue",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[20]||(t[20]=e=>l.showCreateTestWarning=!1)},"Cancel")],32)])])):Object(n["createCommentVNode"])("",!0)]),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.selectedQuestions,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.id,class:Object(n["normalizeClass"])(["question-box",{selected:l.selectedQuestionId===e.id}]),onClick:t=>a.toggleQuestionSelection(e.id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.question_text),1),t[61]||(t[61]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[46]||(t[46]=Object(n["createElementVNode"])("strong",null,"Type:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.type),1)]),t[62]||(t[62]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[47]||(t[47]=Object(n["createElementVNode"])("strong",null,"Chapter:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.chapter_number||"N/A"),1)]),t[63]||(t[63]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[48]||(t[48]=Object(n["createElementVNode"])("strong",null,"Section:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.section_number||"N/A"),1)]),t[64]||(t[64]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[49]||(t[49]=Object(n["createElementVNode"])("strong",null,"Points:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.default_points),1)]),t[65]||(t[65]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[50]||(t[50]=Object(n["createElementVNode"])("strong",null,"Estimated Time:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.est_time)+" minutes",1)]),t[66]||(t[66]=Object(n["createElementVNode"])("br",null,null,-1)),"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ra,[t[51]||(t[51]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.true_false_answer?"True":"False"),1)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ha,[t[52]||(t[52]=Object(n["createElementVNode"])("strong",null,"Correct Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.correct_option&&e.correct_option.option_text||"Not specified"),1),t[53]||(t[53]=Object(n["createElementVNode"])("br",null,null,-1)),t[54]||(t[54]=Object(n["createElementVNode"])("strong",null,"Other Options:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.incorrect_options||[],(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.option_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Wa,[t[55]||(t[55]=Object(n["createElementVNode"])("strong",null,"Pairs:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.matches||[],(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.prompt_text)+" - "+Object(n["toDisplayString"])(e.match_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ja,[t[56]||(t[56]=Object(n["createElementVNode"])("strong",null,"Correct Answer(s):",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.blanks||[],(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.correct_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Short Answer"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ga,[t[57]||(t[57]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.answer||"Not provided"),1)])):Object(n["createCommentVNode"])("",!0),"Essay"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ka,[t[58]||(t[58]=Object(n["createElementVNode"])("strong",null,"Essay Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.grading_instructions||"None"),1)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("span",null,[t[59]||(t[59]=Object(n["createElementVNode"])("strong",null,"Grading Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.grading_instructions||"None"),1)]),e.attachment&&e.attachment.url?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ya,[t[60]||(t[60]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Attached Image:")],-1)),Object(n["createElementVNode"])("img",{src:e.attachment.url,alt:"Attachment",style:{"max-width":"100%","max-height":"300px",margin:"10px 0"}},null,8,Xa)])):Object(n["createCommentVNode"])("",!0),l.selectedQuestionId===e.id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Za,[Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>a.promptRemoveQuestion(e.id),["stop"])},"Remove",8,es)])):Object(n["createCommentVNode"])("",!0),t[67]||(t[67]=Object(n["createElementVNode"])("hr",null,null,-1))],10,za))),128))])])}var os={name:"TeacherViewTB",data(){return{showPopup:!1,showEditForm:!1,showEditQuestionForm:!1,showCreateTestWarning:!1,testFiles:[],selectedQuestions:[],selectedQuestionId:null,editingQuestionData:{},editingQuestionId:null,courseId:this.$route.query.courseId||"",courseTitle:this.$route.query.courseTitle||"",testBankId:this.$route.query.testBankId||"",testBankName:this.$route.query.testBankName||"",editForm:{name:this.$route.query.testBankName||"",chapter:"",section:""},testOptions:{testName:"",coverPage:!1,selectedTemplate:"",graphicFile:null,graphicFileName:"",graphicPreview:"",selectedTypes:[]},showDeleteConfirm:!1,questionIdToDelete:null,popupMessage:"",showInfoPopup:!1}},computed:{displayChapter(){return this.editForm.chapter||this.$route.query.chapter||""},displaySection(){return this.editForm.section||this.$route.query.section||""}},mounted(){this.initialize()},methods:{promptRemoveQuestion(e){this.questionIdToDelete=e,this.showDeleteConfirm=!0},async confirmRemoveQuestion(){try{await S.delete(`/testbanks/${this.testBankId}/questions/${this.questionIdToDelete}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.selectedQuestions=this.selectedQuestions.filter(e=>e.id!==this.questionIdToDelete),this.questionIdToDelete=null,this.showDeleteConfirm=!1,this.popupMessage="Question removed from test bank.",this.showInfoPopup=!0}catch(e){console.error("Error removing question:",e),this.popupMessage="Failed to remove question from test bank.",this.showInfoPopup=!0}},async fetchQuestions(){if(this.testBankId)try{const e=await S.get(`/testbanks/${this.testBankId}/questions`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Fetched questions:",e.data.questions),this.selectedQuestions=e.data.questions||[]}catch(e){console.error("Error fetching questions for test bank:",e),this.selectedQuestions=[]}},toggleQuestionSelection(e){this.selectedQuestionId=this.selectedQuestionId===e?null:e},async removeQuestionFromTestBank(e){if(confirm("Are you sure you want to remove this question from the test bank?"))try{await S.delete(`/testbanks/${this.testBankId}/questions/${e}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.selectedQuestions=this.selectedQuestions.filter(t=>t.id!==e)}catch(t){console.error("Error removing question:",t)}},async updateTestBank(){await S.put("/testbanks/teacher/"+this.testBankId,{name:this.editForm.name,chapter_number:this.editForm.chapter,section_number:this.editForm.section},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.testBankName=this.editForm.name,this.displayChapter=this.editForm.chapter,this.displaySection=this.editForm.section,this.showEditForm=!1},async initialize(){this.testBankId?await this.fetchQuestions():console.warn("No testBankId provided — cannot load questions.")},handleGraphicUpload(e){const t=e.target.files[0];if(!t)return;const o=new FileReader;o.onload=e=>{this.testOptions.graphicFile=t,this.testOptions.graphicFileName=t.name,this.testOptions.graphicPreview=e.target.result},o.readAsDataURL(t)},goToCreateTest(){const e={testName:this.testOptions.testName,selectedTemplate:this.testOptions.selectedTemplate,uploadedImage:this.testOptions.graphicFileName||"",coverPage:this.testOptions.coverPage||!1,graphicPreview:this.testOptions.graphicPreview||""};localStorage.setItem("testOptions",JSON.stringify(e)),this.$router.push({path:"/TeacherTemplate",query:{courseId:this.courseId,courseTitle:this.courseTitle,testBankId:this.testBankId,testBankName:this.testBankName,selectedTypes:JSON.stringify(this.testOptions.selectedTypes)}})}}};o("01e0");const ns=r()(os,[["render",ts],["__scopeId","data-v-472ecc14"]]);var cs=ns;const ls={class:"theme-webmaster"},as={class:"top-banner"},ss={class:"banner-actions"},rs={class:"center large-paragraph",style:{color:"#222"}},is={class:"page-wrapper",style:{"font-size":"24px","text-align":"center"}},ds={class:"button-row"};function bs(e,t,o,c,l,a){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ls,[Object(n["createElementVNode"])("div",as,[t[6]||(t[6]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Database Downloads",-1)),Object(n["createElementVNode"])("div",ss,[Object(n["createVNode"])(s,{to:"/",class:"banner-btn"},{default:Object(n["withCtx"])(()=>t[5]||(t[5]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",rs,[Object(n["createElementVNode"])("div",is,[t[7]||(t[7]=Object(n["createElementVNode"])("h1",null,"Select a dataset to download:",-1)),t[8]||(t[8]=Object(n["createElementVNode"])("br",null,null,-1)),t[9]||(t[9]=Object(n["createElementVNode"])("strong",null,"Note:",-1)),t[10]||(t[10]=Object(n["createTextVNode"])(" Download All will download each file separately for readability. ")),t[11]||(t[11]=Object(n["createElementVNode"])("hr",null,null,-1)),Object(n["createElementVNode"])("div",ds,[Object(n["createElementVNode"])("button",{class:"button",onClick:t[0]||(t[0]=e=>a.downloadData("users"))},"Download Users"),Object(n["createElementVNode"])("button",{class:"button",onClick:t[1]||(t[1]=e=>a.downloadData("textbook"))},"Download Textbooks"),Object(n["createElementVNode"])("button",{class:"button",onClick:t[2]||(t[2]=e=>a.downloadData("courses"))},"Download Courses"),Object(n["createElementVNode"])("button",{class:"button",onClick:t[3]||(t[3]=e=>a.downloadData("questions"))},"Download Questions"),Object(n["createElementVNode"])("button",{class:"button",onClick:t[4]||(t[4]=e=>a.downloadData("all"))},"Download All")])])])])}var us={name:"WebmasterHome",methods:{async downloadData(e){const t={users:"users",courses:"courses",textbook:"textbook",questions:"questions"};if("all"===e){for(const[e,o]of Object.entries(t))await this.fetchAndDownload(o,e+".csv");return}const o=t[e];o?await this.fetchAndDownload(o,e+".csv"):alert("Unsupported download type: "+e)},async fetchAndDownload(e,t){try{const o=await S.get("/download/"+e,{responseType:"blob"}),n=window.URL.createObjectURL(o.data),c=document.createElement("a");c.href=n,c.download=t,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(n)}catch(o){console.error(`Download error for ${e}:`,o)}}}};o("5df7");const ms=r()(us,[["render",bs],["__scopeId","data-v-57cf651a"]]);var ps=ms;const hs={class:"theme-webmaster"},Os={class:"center large-paragraph",style:{color:"#222"}},js=["disabled"],ks={key:0,class:"error-message"},gs={key:1,class:"loading-message"};function Ns(e,t,o,c,l,a){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",hs,[t[14]||(t[14]=Object(n["createElementVNode"])("div",{class:"top-banner"},[Object(n["createElementVNode"])("div",{class:"banner-title"},"Webmaster Login")],-1)),Object(n["createElementVNode"])("div",Os,[t[11]||(t[11]=Object(n["createTextVNode"])(" Please enter your webmaster username and password: ")),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("form",{onSubmit:t[2]||(t[2]=Object(n["withModifiers"])((...e)=>a.submitForm&&a.submitForm(...e),["prevent"]))},[t[3]||(t[3]=Object(n["createElementVNode"])("label",{for:"uname"},"Username:",-1)),t[4]||(t[4]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"uname","onUpdate:modelValue":t[0]||(t[0]=e=>l.username=e)},null,512),[[n["vModelText"],l.username]]),t[5]||(t[5]=Object(n["createElementVNode"])("br",null,null,-1)),t[6]||(t[6]=Object(n["createElementVNode"])("br",null,null,-1)),t[7]||(t[7]=Object(n["createElementVNode"])("label",{for:"pass"},"Password:",-1)),t[8]||(t[8]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"password",id:"pass","onUpdate:modelValue":t[1]||(t[1]=e=>l.password=e)},null,512),[[n["vModelText"],l.password]]),t[9]||(t[9]=Object(n["createElementVNode"])("br",null,null,-1)),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("input",{type:"submit",value:"Submit",disabled:l.loading},null,8,js)],32),l.errorMessage?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ks,Object(n["toDisplayString"])(l.errorMessage),1)):Object(n["createCommentVNode"])("",!0),l.loading?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",gs,"Logging in...")):Object(n["createCommentVNode"])("",!0)])])}var Es={data(){return{username:"",password:"",errorMessage:"",loading:!1}},mounted(){const e=localStorage.getItem("token");if(e)try{const t=Object(I["default"])(e),o=Date.now()/1e3;t.exp>o&&"webmaster"===t.role&&this.$router.push("/WebmasterHome")}catch(t){console.error("Invalid token",t)}},methods:{async submitForm(){if(this.username&&this.password)if(this.username.trim().length<3||this.password.trim().length<6)this.errorMessage="Username must be at least 3 characters and password at least 6 characters.";else{this.loading=!0,this.errorMessage="";try{const e=await S.post("/auth/login",{username:this.username.toLowerCase(),password:this.password}),{token:t,user_id:o,role:n}=e.data;localStorage.setItem("token",t),localStorage.setItem("user_id",o),localStorage.setItem("role",n),"webmaster"===n?this.$router.push("/WebmasterHome"):(this.errorMessage="Only webmasters can log in here.",localStorage.clear())}catch(e){e.response?401===e.response.status?this.errorMessage="Invalid username or password.":this.errorMessage=e.response&&e.response.data&&e.response.data.message||"An error occurred during login.":this.errorMessage="Network error. Please check your connection."}finally{this.loading=!1}}else this.errorMessage="Please enter both username and password."}}};o("d941");const Vs=r()(Es,[["render",Ns],["__scopeId","data-v-2950ba08"]]);var ys=Vs;const fs=[{path:"/",name:"Welcome",component:g},{path:"/PubHome",name:"PubHome",component:A},{path:"/PubLog",name:"PubLog",component:H},{path:"/PubNewBook",name:"PubNewBook",component:ee},{path:"/PubNewTB",name:"PubNewTB",component:ie},{path:"/PubQuestions",name:"PubQuestions",component:at},{path:"/PubViewFeedback",name:"PubViewFeedback",component:vt},{path:"/PubViewTB",name:"PubViewTB",component:Yt},{path:"/TeacherHome",name:"TeacherHome",component:wo},{path:"/TeacherLog",name:"TeacherLog",component:Io},{path:"/TeacherNewClass",name:"TeacherNewClass",component:zo},{path:"/TeacherNewTB",name:"TeacherNewTB",component:Xo},{path:"/TeacherPubQ",name:"TeacherPubQ",component:cc},{path:"/TeacherQuestions",name:"TeacherQuestions",component:il},{path:"/TeacherTemplate",name:"TeacherTemplate",component:ka},{path:"/TeacherViewTB",name:"TeacherViewTB",component:cs},{path:"/WebmasterHome",name:"WebmasterHome",component:ps},{path:"/WebmasterLog",name:"WebmasterLog",component:ys}],ws=Object(b["a"])({history:Object(b["b"])(),routes:fs});var vs=ws;const _s=Object(n["createApp"])(d);_s.use(vs),_s.mount("#app")},"5df7":function(e,t,o){"use strict";o("008a")},"67c8":function(e,t,o){},6863:function(e,t,o){},"6a83":function(e,t,o){"use strict";o("0c21")},"6bc6":function(e,t,o){"use strict";o("af73")},"716a":function(e,t,o){"use strict";o("fda2")},"7ce1":function(e,t,o){},"871c":function(e,t,o){},"8d2b":function(e,t,o){"use strict";o("5542")},a9f9:function(e,t,o){"use strict";o("6863")},af73:function(e,t,o){},b1c0:function(e,t,o){"use strict";o("4a7c")},b2d6:function(e,t,o){},b458:function(e,t,o){},bc37:function(e,t,o){"use strict";o("4c75")},c4f7:function(e,t,o){"use strict";o("b458")},c8e0:function(e,t,o){"use strict";o("b2d6")},d941:function(e,t,o){"use strict";o("e54d")},da98:function(e,t,o){"use strict";o("43c3")},e54c:function(e,t,o){},e54d:function(e,t,o){},e5d9:function(e,t,o){"use strict";o("2cca")},ef75:function(e,t,o){"use strict";o("871c")},fda2:function(e,t,o){}});
//# sourceMappingURL=app.dfff84e6.js.map