(function(e){function t(t){for(var n,l,s=t[0],r=t[1],i=t[2],d=0,u=[];d<s.length;d++)l=s[d],Object.prototype.hasOwnProperty.call(c,l)&&c[l]&&u.push(c[l][0]),c[l]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);b&&b(t);while(u.length)u.shift()();return a.push.apply(a,i||[]),o()}function o(){for(var e,t=0;t<a.length;t++){for(var o=a[t],n=!0,l=1;l<o.length;l++){var r=o[l];0!==c[r]&&(n=!1)}n&&(a.splice(t--,1),e=s(s.s=o[0]))}return e}var n={},c={app:0},a=[];function l(e){return s.p+"js/"+({}[e]||e)+"."+{"chunk-2d0d6e77":"e4320951"}[e]+".js"}function s(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.e=function(e){var t=[],o=c[e];if(0!==o)if(o)t.push(o[2]);else{var n=new Promise((function(t,n){o=c[e]=[t,n]}));t.push(o[2]=n);var a,r=document.createElement("script");r.charset="utf-8",r.timeout=120,s.nc&&r.setAttribute("nonce",s.nc),r.src=l(e);var i=new Error;a=function(t){r.onerror=r.onload=null,clearTimeout(d);var o=c[e];if(0!==o){if(o){var n=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;i.message="Loading chunk "+e+" failed.\n("+n+": "+a+")",i.name="ChunkLoadError",i.type=n,i.request=a,o[1](i)}c[e]=void 0}};var d=setTimeout((function(){a({type:"timeout",target:r})}),12e4);r.onerror=r.onload=a,document.head.appendChild(r)}return Promise.all(t)},s.m=e,s.c=n,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(o,n,function(t){return e[t]}.bind(null,n));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/API_Testing/",s.oe=function(e){throw console.error(e),e};var r=window["webpackJsonp"]=window["webpackJsonp"]||[],i=r.push.bind(r);r.push=t,r=r.slice();for(var d=0;d<r.length;d++)t(r[d]);var b=i;a.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("56d7")},"0c21":function(e,t,o){},"167d":function(e,t,o){},"17af":function(e,t,o){"use strict";o("1eaa")},1884:function(e,t,o){},"1ca3":function(e,t,o){"use strict";o("1884")},"1eaa":function(e,t,o){},3785:function(e,t,o){"use strict";o("79aa")},"3ba0":function(e,t,o){"use strict";o("7ce1")},4379:function(e,t,o){},"4abc":function(e,t,o){"use strict";o("a438")},"4ff5":function(e,t,o){},5542:function(e,t,o){},"56d7":function(e,t,o){"use strict";o.r(t);var n=o("7a23");const c={id:"app"};function a(e,t,o,a,l,s){const r=Object(n["resolveComponent"])("router-view");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",c,[Object(n["createVNode"])(r)])}var l={name:"App",name:"App",mounted(){document.title="Print-A-Test"}},s=(o("c4f7"),o("6b0d")),r=o.n(s);const i=r()(l,[["render",a]]);var d=i,b=o("6605");const u={class:"theme-welcome"},m={class:"button-container"},p={class:"button-container"},h={class:"button-container"};function O(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",u,[t[3]||(t[3]=Object(n["createElementVNode"])("div",{class:"top-banner"},[Object(n["createElementVNode"])("div",{class:"banner-title"},"Welcome to Print-A-Test")],-1)),t[4]||(t[4]=Object(n["createElementVNode"])("div",{class:"center large-paragraph",style:{color:"#222"}}," Select the role you are logging in as:",-1)),Object(n["createElementVNode"])("div",m,[Object(n["createVNode"])(s,{to:"/TeacherLog"},{default:Object(n["withCtx"])(()=>t[0]||(t[0]=[Object(n["createElementVNode"])("button",{class:"button"},"Teacher",-1)])),_:1})]),t[5]||(t[5]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("div",p,[Object(n["createVNode"])(s,{to:"/PubLog"},{default:Object(n["withCtx"])(()=>t[1]||(t[1]=[Object(n["createElementVNode"])("button",{class:"button"},"Publisher",-1)])),_:1})]),t[6]||(t[6]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("div",h,[Object(n["createVNode"])(s,{to:"/WebmasterLog"},{default:Object(n["withCtx"])(()=>t[2]||(t[2]=[Object(n["createElementVNode"])("button",{class:"button"},"Webmaster",-1)])),_:1})])])}var j={name:"Welcome"};o("3ba0");const k=r()(j,[["render",O],["__scopeId","data-v-e7dbd576"]]);var g=k;const N={class:"theme-publisher"},E={class:"top-banner"},y={class:"banner-actions"},V={class:"center large-paragraph",style:{color:"#222"}},f={class:"page-wrapper"},w={class:"button-row"},B={key:0,class:"p_dropdown"},v={class:"p_dropdown-content"},T={key:1};function _(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",N,[Object(n["createElementVNode"])("div",E,[t[1]||(t[1]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Textbook Selection",-1)),Object(n["createElementVNode"])("div",y,[Object(n["createVNode"])(s,{to:"/",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[0]||(t[0]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",V,[Object(n["createElementVNode"])("div",f,[t[5]||(t[5]=Object(n["createTextVNode"])(" Please select or add a textbook: ")),Object(n["createElementVNode"])("div",w,[a.textbooks.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",B,[t[2]||(t[2]=Object(n["createElementVNode"])("button",{class:"p_dropbtn"},"Select Textbook",-1)),Object(n["createElementVNode"])("div",v,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.textbooks,e=>(Object(n["openBlock"])(),Object(n["createBlock"])(s,{key:e.id,to:{path:"PubQuestions",query:{title:e.title,textbook_id:e.id}}},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.title),1)]),_:2},1032,["to"]))),128))])])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",T," No courses available. ")),Object(n["createVNode"])(s,{to:"PubNewBook"},{default:Object(n["withCtx"])(()=>t[3]||(t[3]=[Object(n["createElementVNode"])("button",{class:"p_button"},"Add New Textbook",-1)])),_:1}),t[4]||(t[4]=Object(n["createElementVNode"])("br",null,null,-1))])])])])}var x=o("cee4");const C=x["a"].create({baseURL:"https://api-testing-goob.onrender.com",responseType:"json"});async function S(){const e=localStorage.getItem("token");if(!e)return null;try{const t=await x["a"].post("https://api-testing-goob.onrender.com/auth/refresh",{token:e}),o=t.data.token;return localStorage.setItem("token",o),o}catch(t){return console.error("Token refresh failed:",t),localStorage.removeItem("token"),localStorage.removeItem("user_id"),localStorage.removeItem("role"),null}}C.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer "+t),e},e=>Promise.reject(e)),C.interceptors.response.use(e=>e,async e=>{const t=e.config;if(e.response&&401===e.response.status&&!t._retry){t._retry=!0;const e=await S();if(e)return t.headers.Authorization="Bearer "+e,C(t);console.warn("Token refresh failed or user logged out.")}return Promise.reject(e)});var F=C,I=o("f761"),D={name:"PublisherHome",data(){return{textbooks:[],error:null}},created(){this.fetchTextbooks()},methods:{async fetchTextbooks(){try{console.log("Fetching textbooks...");const e=await F.get("/textbooks",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Textbooks fetched:",e.data),e.data&&e.data.textbooks?this.textbooks=e.data.textbooks:this.error="Failed to fetch textbooks data."}catch(e){console.error("Error fetching textbooks:",e),e.response?this.error=`Error: ${e.response.status} - ${e.response.data.message||e.response.statusText}`:this.error="Network error or server is not responding."}}}};o("6a83");const q=r()(D,[["render",_],["__scopeId","data-v-46fbfbd4"]]);var A=q;const P={class:"theme-publisher"},Q={class:"center large-paragraph",style:{color:"#222"}},M=["disabled"],L={key:0,class:"error-message"},$={key:1,class:"loading-message"};function z(e,t,o,c,a,l){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",P,[t[14]||(t[14]=Object(n["createElementVNode"])("div",{class:"top-banner"},[Object(n["createElementVNode"])("div",{class:"banner-title"},"Publisher Login")],-1)),Object(n["createElementVNode"])("div",Q,[t[11]||(t[11]=Object(n["createTextVNode"])(" Please enter your publisher username and password: ")),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("form",{onSubmit:t[2]||(t[2]=Object(n["withModifiers"])((...e)=>l.submitForm&&l.submitForm(...e),["prevent"]))},[t[3]||(t[3]=Object(n["createElementVNode"])("label",{for:"uname"},"Username:",-1)),t[4]||(t[4]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"uname","onUpdate:modelValue":t[0]||(t[0]=e=>a.username=e)},null,512),[[n["vModelText"],a.username]]),t[5]||(t[5]=Object(n["createElementVNode"])("br",null,null,-1)),t[6]||(t[6]=Object(n["createElementVNode"])("br",null,null,-1)),t[7]||(t[7]=Object(n["createElementVNode"])("label",{for:"pass"},"Password:",-1)),t[8]||(t[8]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"password",id:"pass","onUpdate:modelValue":t[1]||(t[1]=e=>a.password=e)},null,512),[[n["vModelText"],a.password]]),t[9]||(t[9]=Object(n["createElementVNode"])("br",null,null,-1)),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("input",{type:"submit",value:"Submit",disabled:a.loading},null,8,M)],32),a.errorMessage?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",L,Object(n["toDisplayString"])(a.errorMessage),1)):Object(n["createCommentVNode"])("",!0),a.loading?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",$,"Logging in...")):Object(n["createCommentVNode"])("",!0)])])}var U={data(){return{username:"",password:"",errorMessage:"",loading:!1}},mounted(){const e=localStorage.getItem("token");if(e)try{const t=Object(I["default"])(e),o=Date.now()/1e3;t.exp>o&&"publisher"===t.role&&this.$router.push("/PubHome")}catch(t){console.error("Invalid token",t)}},methods:{async submitForm(){if(this.username&&this.password)if(this.username.trim().length<3||this.password.trim().length<6)this.errorMessage="Username must be at least 3 characters and password at least 6 characters.";else{this.loading=!0,this.errorMessage="";try{const e=await F.post("/auth/login",{username:this.username.toLowerCase(),password:this.password}),{token:t,user_id:o,role:n}=e.data;localStorage.setItem("token",t),localStorage.setItem("user_id",o),localStorage.setItem("role",n),"publisher"===n?this.$router.push("/PubHome"):(this.errorMessage="Only publishers can log in here.",localStorage.clear())}catch(e){e.response?401===e.response.status?this.errorMessage="Invalid username or password.":this.errorMessage=e.response&&e.response.data&&e.response.data.message||"An error occurred during login.":this.errorMessage="Network error. Please check your connection."}finally{this.loading=!1}}else this.errorMessage="Please enter both username and password."}}};o("17af");const R=r()(U,[["render",z],["__scopeId","data-v-800dd872"]]);var H=R;const W={class:"theme-publisher"},G={class:"top-banner"},J={class:"banner-actions"},K={class:"center large-paragraph",style:{color:"#222"}};function Y(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",W,[Object(n["createElementVNode"])("div",G,[t[8]||(t[8]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Add New Textbook",-1)),Object(n["createElementVNode"])("div",J,[Object(n["createVNode"])(s,{to:"/PubHome",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[6]||(t[6]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[7]||(t[7]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",K,[Object(n["createElementVNode"])("form",{onSubmit:t[5]||(t[5]=Object(n["withModifiers"])((...e)=>l.saveBook&&l.saveBook(...e),["prevent"]))},[t[9]||(t[9]=Object(n["createElementVNode"])("label",{for:"textbookTitle"},"Textbook Title:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"textbookTitle","onUpdate:modelValue":t[0]||(t[0]=e=>a.textbookTitle=e),style:{height:"20px"}},null,512),[[n["vModelText"],a.textbookTitle]]),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),t[11]||(t[11]=Object(n["createElementVNode"])("label",{for:"author"},"Author:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"author","onUpdate:modelValue":t[1]||(t[1]=e=>a.author=e),style:{height:"20px"}},null,512),[[n["vModelText"],a.author]]),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("label",{for:"ISBN"},"ISBN:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"ISBN","onUpdate:modelValue":t[2]||(t[2]=e=>a.ISBN=e),style:{height:"20px"}},null,512),[[n["vModelText"],a.ISBN]]),t[14]||(t[14]=Object(n["createElementVNode"])("br",null,null,-1)),t[15]||(t[15]=Object(n["createElementVNode"])("label",{for:"version"},"Version:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"version","onUpdate:modelValue":t[3]||(t[3]=e=>a.version=e),style:{height:"20px"}},null,512),[[n["vModelText"],a.version]]),t[16]||(t[16]=Object(n["createElementVNode"])("br",null,null,-1)),t[17]||(t[17]=Object(n["createElementVNode"])("label",{for:"websiteLink"},"Website Link:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"websiteLink","onUpdate:modelValue":t[4]||(t[4]=e=>a.websiteLink=e),style:{height:"20px"}},null,512),[[n["vModelText"],a.websiteLink]]),t[18]||(t[18]=Object(n["createElementVNode"])("br",null,null,-1)),t[19]||(t[19]=Object(n["createElementVNode"])("div",{class:"center large-heading"},[Object(n["createElementVNode"])("input",{type:"submit",value:"Save"})],-1))],32)])])}var X={name:"PublisherNewBook",data(){return{textbookTitle:"",author:"",ISBN:"",version:"",websiteLink:""}},methods:{async saveBook(){if(this.textbookTitle&&this.author&&this.ISBN&&this.version){const t={textbook_title:this.textbookTitle,textbook_author:this.author,textbook_isbn:this.ISBN,textbook_version:this.version,websiteLink:this.websiteLink};try{const e=await F.post("/textbooks",t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Book saved successfully:",e.data),this.$router.push({path:"/PubHome"})}catch(e){console.error("Error saving book:",e),alert("Failed to save the book. Please try again.")}}else alert("Please fill out all fields.")}}};o("8d2b");const Z=r()(X,[["render",Y],["__scopeId","data-v-4c95a948"]]);var ee=Z;const te={class:"theme-publisher"},oe={class:"top-banner"},ne={class:"banner-actions"},ce={class:"center large-paragraph",style:{color:"#222"}},ae={key:0,style:{color:"red","margin-top":"10px"}};function le(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",te,[Object(n["createElementVNode"])("div",oe,[t[6]||(t[6]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Create New Test Bank",-1)),Object(n["createElementVNode"])("div",ne,[Object(n["createVNode"])(s,{to:"/PubHome",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[4]||(t[4]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[5]||(t[5]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",ce,[Object(n["createElementVNode"])("form",{onSubmit:t[3]||(t[3]=Object(n["withModifiers"])((...e)=>l.saveTestBank&&l.saveTestBank(...e),["prevent"]))},[t[7]||(t[7]=Object(n["createElementVNode"])("label",{for:"bankName"},"Name of Test Bank:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"bankName","onUpdate:modelValue":t[0]||(t[0]=e=>a.bankName=e),style:{height:"20px"},required:""},null,512),[[n["vModelText"],a.bankName]]),t[8]||(t[8]=Object(n["createElementVNode"])("br",null,null,-1)),t[9]||(t[9]=Object(n["createElementVNode"])("label",{for:"bankCh"},"Textbook Chapter:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"bankCh","onUpdate:modelValue":t[1]||(t[1]=e=>a.bankChapter=e)},null,512),[[n["vModelText"],a.bankChapter]]),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),t[11]||(t[11]=Object(n["createElementVNode"])("label",{for:"bankSec"},"Textbook Section:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"bankSec","onUpdate:modelValue":t[2]||(t[2]=e=>a.bankSection=e)},null,512),[[n["vModelText"],a.bankSection]]),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("input",{type:"submit",value:"Submit"},null,-1))],32),a.error?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ae,Object(n["toDisplayString"])(a.error),1)):Object(n["createCommentVNode"])("",!0)])])}var se={name:"PublisherNewTB",data(){return{bankName:"",bankChapter:"",bankSection:"",textbookId:this.$route.query.textbook_id||"",textbookTitle:this.$route.query.title||"",error:null}},methods:{async saveTestBank(){if(this.bankName&&this.bankChapter&&this.bankSection&&this.textbookId){const t={testbank_name:this.bankName,chapter_number:this.bankChapter,section_number:this.bankSection,textbook_id:this.textbookId};try{const e=await F.post("/testbanks/publisher",t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Test bank saved successfully:",e.data),this.$router.push({path:"/PubQuestions",query:{title:this.textbookTitle,textbook_id:this.textbookId}})}catch(e){console.error("Error saving test bank:",e)}}}}};o("3785");const re=r()(se,[["render",le],["__scopeId","data-v-e22328b8"]]);var ie=re;const de={class:"theme-publisher"},be={class:"top-banner"},ue={class:"banner-title"},me={class:"banner-actions"},pe={class:"form-popup-modal"},he={class:"page-wrapper"},Oe={class:"button-row"},je={class:"p_dropdown"},ke={class:"p_dropbtn"},ge={class:"p_dropdown-content"},Ne=["onClick"],Ee={class:"p_dropdown"},ye={class:"p_dropdown-content"},Ve={id:"selectedQuestionType",style:{color:"#222"},class:"center large-paragraph"},fe=["onClick"],we={key:0,style:{"margin-top":"10px"}},Be=["src"],ve={key:1},Te={key:2},_e={key:3},xe={key:4},Ce={key:5,class:"p_button-group"},Se=["onClick"],Fe=["onClick"],Ie=["onClick"],De={class:"form-popup-modal"},qe={class:"form-container",style:{display:"flex","flex-direction":"column","align-items":"center",gap:"10px","margin-top":"1rem"}},Ae=["onClick"],Pe={class:"form-popup-modal"},Qe={key:0},Me=["value"],Le={key:1},$e={key:2},ze={key:3},Ue={key:4},Re=["onUpdate:modelValue"],He=["onUpdate:modelValue"],We=["onClick"],Ge={key:5},Je={key:6},Ke={key:7},Ye=["src"],Xe={key:8},Ze=["src"];function et(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",de,[Object(n["createElementVNode"])("div",be,[Object(n["createElementVNode"])("div",ue,Object(n["toDisplayString"])(a.textbookTitle),1),Object(n["createElementVNode"])("div",me,[Object(n["createVNode"])(s,{to:"/PubHome",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[28]||(t[28]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[29]||(t[29]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),a.editBlockedPopup?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:0,class:"popup-overlay",onClick:t[2]||(t[2]=Object(n["withModifiers"])(e=>a.editBlockedPopup=!1,["self"]))},[Object(n["createElementVNode"])("div",pe,[t[30]||(t[30]=Object(n["createElementVNode"])("h2",null,"Cannot Edit Question",-1)),Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(a.editBlockedReason),1),t[31]||(t[31]=Object(n["createElementVNode"])("p",null,"A new copy will be made instead.",-1)),Object(n["createElementVNode"])("button",{class:"btn",onClick:t[0]||(t[0]=(...e)=>l.createCopyInstead&&l.createCopyInstead(...e))},"Create a Copy"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[1]||(t[1]=e=>a.editBlockedPopup=!1)},"Cancel")])])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",he,[Object(n["createElementVNode"])("div",Oe,[Object(n["createElementVNode"])("div",je,[Object(n["createElementVNode"])("button",ke,Object(n["toDisplayString"])(a.selectedTestBank?a.selectedTestBank.name:"Select Draft Pool"),1),Object(n["createElementVNode"])("div",ge,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.testBanks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("a",{key:e.testbank_id,href:"#",onClick:Object(n["withModifiers"])(t=>l.selectTestBank(e),["prevent"])},Object(n["toDisplayString"])(e.name),9,Ne))),128))])]),Object(n["createVNode"])(s,{to:{path:"PubNewTB",query:{title:a.textbookTitle,textbook_id:a.textbookId}}},{default:Object(n["withCtx"])(()=>t[32]||(t[32]=[Object(n["createElementVNode"])("button",{class:"p_button"},"New Draft Pool",-1)])),_:1},8,["to"]),Object(n["createElementVNode"])("div",Ee,[t[33]||(t[33]=Object(n["createElementVNode"])("button",{class:"p_dropbtn"},"Question Type",-1)),Object(n["createElementVNode"])("div",ye,[Object(n["createElementVNode"])("a",{onClick:t[3]||(t[3]=e=>l.fetchQuestions("True/False"))},"True/False"),Object(n["createElementVNode"])("a",{onClick:t[4]||(t[4]=e=>l.fetchQuestions("Multiple Choice"))},"Multiple Choice"),Object(n["createElementVNode"])("a",{onClick:t[5]||(t[5]=e=>l.fetchQuestions("Matching"))},"Matching"),Object(n["createElementVNode"])("a",{onClick:t[6]||(t[6]=e=>l.fetchQuestions("Fill in the Blank"))},"Fill in the Blank"),Object(n["createElementVNode"])("a",{onClick:t[7]||(t[7]=e=>l.fetchQuestions("Short Answer"))},"Short Answer"),Object(n["createElementVNode"])("a",{onClick:t[8]||(t[8]=e=>l.fetchQuestions("Essay"))},"Essay")])]),Object(n["createElementVNode"])("button",{class:"p_button",onClick:t[9]||(t[9]=(...e)=>l.edit&&l.edit(...e))},"New Question")]),Object(n["createElementVNode"])("div",Ve,Object(n["toDisplayString"])(a.selectedQuestionType),1),t[76]||(t[76]=Object(n["createElementVNode"])("hr",null,null,-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.questions,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:o,class:Object(n["normalizeClass"])(["p_question-box",{selected:a.selectedQuestionId===e.id}]),onClick:t=>l.toggleQuestionSelection(e.id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.text),1),t[48]||(t[48]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[34]||(t[34]=Object(n["createElementVNode"])("strong",null,"Type:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.type),1)]),t[49]||(t[49]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[35]||(t[35]=Object(n["createElementVNode"])("strong",null,"Chapter:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.chapter||"N/A"),1)]),t[50]||(t[50]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[36]||(t[36]=Object(n["createElementVNode"])("strong",null,"Section:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.section||"N/A"),1)]),t[51]||(t[51]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[37]||(t[37]=Object(n["createElementVNode"])("strong",null,"Points:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.points),1)]),t[52]||(t[52]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[38]||(t[38]=Object(n["createElementVNode"])("strong",null,"Estimated Time:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.time)+" minutes",1)]),t[53]||(t[53]=Object(n["createElementVNode"])("br",null,null,-1)),e.image_url?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",we,[t[39]||(t[39]=Object(n["createElementVNode"])("strong",null,"Attached Image:",-1)),t[40]||(t[40]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("img",{src:e.image_url,alt:"Attached Image",style:{"max-width":"100%","margin-top":"5px"}},null,8,Be)])):Object(n["createCommentVNode"])("",!0),"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ve,[t[41]||(t[41]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.answer?"True":"False"),1)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Te,[t[42]||(t[42]=Object(n["createElementVNode"])("strong",null,"Correct Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.correctOption&&e.correctOption.option_text||"Not specified"),1),t[43]||(t[43]=Object(n["createElementVNode"])("br",null,null,-1)),t[44]||(t[44]=Object(n["createElementVNode"])("strong",null,"Other Options:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.incorrectOptions,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.option_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",_e,[t[45]||(t[45]=Object(n["createElementVNode"])("strong",null,"Pairs:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.pairs,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.term)+" - "+Object(n["toDisplayString"])(e.definition),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",xe,[t[46]||(t[46]=Object(n["createElementVNode"])("strong",null,"Correct Answer(s):",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.blanks,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.correct_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("span",null,[t[47]||(t[47]=Object(n["createElementVNode"])("strong",null,"Grading Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.instructions||"None"),1)]),a.selectedQuestionId===e.id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ce,[e.is_published?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:0,onClick:Object(n["withModifiers"])(t=>l.editQuestion(e),["stop"])},"Edit",8,Se)),e.is_published?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:1,onClick:Object(n["withModifiers"])(t=>l.deleteQuestion(e.id),["stop"])},"Delete",8,Fe)),Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>l.openAddToTestBank(e.id),["stop"])},"Add to Test Bank",8,Ie)])):Object(n["createCommentVNode"])("",!0)],10,fe))),128))]),a.showAddToTBModal?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:0,class:"popup-overlay",onClick:t[11]||(t[11]=Object(n["withModifiers"])((...e)=>l.closeAddToTBModal&&l.closeAddToTBModal(...e),["self"]))},[Object(n["createElementVNode"])("div",De,[t[54]||(t[54]=Object(n["createElementVNode"])("h2",{style:{"text-align":"center"}},"Select Draft Pool",-1)),Object(n["createElementVNode"])("div",qe,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.testBanks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:e.testbank_id,class:"t_button",style:{width:"100%"},onClick:t=>l.assignQuestionToTestBank(e.testbank_id)},Object(n["toDisplayString"])(e.name),9,Ae))),128)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",style:{width:"100%"},onClick:t[10]||(t[10]=(...e)=>l.closeAddToTBModal&&l.closeAddToTBModal(...e))}," Close ")])])])):Object(n["createCommentVNode"])("",!0),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",{class:"popup-overlay",onClick:t[27]||(t[27]=Object(n["withModifiers"])((...e)=>l.closeForm&&l.closeForm(...e),["self"]))},[Object(n["createElementVNode"])("div",Pe,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[26]||(t[26]=Object(n["withModifiers"])((...e)=>l.handleQuestionSave&&l.handleQuestionSave(...e),["prevent"]))},[Object(n["createElementVNode"])("h1",null,Object(n["toDisplayString"])(a.editingQuestionId?"Edit Question":"New Question"),1),t[62]||(t[62]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Chapter Number")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>a.questionData.chapter=e),required:""},null,512),[[n["vModelText"],a.questionData.chapter]]),t[63]||(t[63]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Section Number")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>a.questionData.section=e),required:""},null,512),[[n["vModelText"],a.questionData.section]]),t[64]||(t[64]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Question Type"),Object(n["createElementVNode"])("br")],-1)),a.editingQuestionId?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Qe,[Object(n["createElementVNode"])("input",{type:"text",value:a.selectedQuestionType,disabled:"",class:"readonly-input"},null,8,Me)])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Le,[Object(n["withDirectives"])(Object(n["createElementVNode"])("select",{"onUpdate:modelValue":t[14]||(t[14]=e=>a.selectedQuestionType=e),required:""},t[55]||(t[55]=[Object(n["createElementVNode"])("option",{disabled:"",value:""},"Select a type",-1),Object(n["createElementVNode"])("option",null,"True/False",-1),Object(n["createElementVNode"])("option",null,"Multiple Choice",-1),Object(n["createElementVNode"])("option",null,"Matching",-1),Object(n["createElementVNode"])("option",null,"Fill in the Blank",-1),Object(n["createElementVNode"])("option",null,"Short Answer",-1),Object(n["createElementVNode"])("option",null,"Essay",-1)]),512),[[n["vModelSelect"],a.selectedQuestionType]])])),t[65]||(t[65]=Object(n["createElementVNode"])("br",null,null,-1)),t[66]||(t[66]=Object(n["createElementVNode"])("br",null,null,-1)),t[67]||(t[67]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Question Text")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=e=>a.questionData.question=e),required:""},null,512),[[n["vModelText"],a.questionData.question]]),"True/False"===a.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",$e,[t[57]||(t[57]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("select",{"onUpdate:modelValue":t[16]||(t[16]=e=>a.questionData.answer=e)},t[56]||(t[56]=[Object(n["createElementVNode"])("option",{value:"True"},"True",-1),Object(n["createElementVNode"])("option",{value:"False"},"False",-1)]),512),[[n["vModelSelect"],a.questionData.answer]])])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===a.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ze,[t[58]||(t[58]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Correct Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[17]||(t[17]=e=>a.questionData.answer=e)},null,512),[[n["vModelText"],a.questionData.answer]]),t[59]||(t[59]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Incorrect Answer Choices (comma-separated)")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[18]||(t[18]=e=>a.questionData.answerChoices=e)},null,512),[[n["vModelText"],a.questionData.answerChoices]])])):Object(n["createCommentVNode"])("",!0),"Matching"===a.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ue,[t[60]||(t[60]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Matching Pairs")],-1)),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.matchingPairs,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:t},[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t=>e.term=t,placeholder:"Term"},null,8,Re),[[n["vModelText"],e.term]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t=>e.definition=t,placeholder:"Definition"},null,8,He),[[n["vModelText"],e.definition]]),Object(n["createElementVNode"])("button",{type:"button",onClick:e=>l.removePair(t)},"Remove",8,We)]))),128)),Object(n["createElementVNode"])("button",{type:"button",onClick:t[19]||(t[19]=(...e)=>l.addPair&&l.addPair(...e))},"Add Pair")])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===a.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ge,[t[61]||(t[61]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Correct Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[20]||(t[20]=e=>a.questionData.answer=e)},null,512),[[n["vModelText"],a.questionData.answer]])])):Object(n["createCommentVNode"])("",!0),"Essay"===a.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Je)):Object(n["createCommentVNode"])("",!0),t[68]||(t[68]=Object(n["createElementVNode"])("br",null,null,-1)),t[69]||(t[69]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Points Worth")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[21]||(t[21]=e=>a.questionData.points=e),required:""},null,512),[[n["vModelText"],a.questionData.points]]),t[70]||(t[70]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Estimated Time (in minutes)")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[22]||(t[22]=e=>a.questionData.time=e),required:""},null,512),[[n["vModelText"],a.questionData.time]]),t[71]||(t[71]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Grading Instructions")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[23]||(t[23]=e=>a.questionData.instructions=e),required:""},null,512),[[n["vModelText"],a.questionData.instructions]]),t[72]||(t[72]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Attached Image")],-1)),a.editingQuestionId&&a.imagePreview?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ke,[Object(n["createElementVNode"])("img",{src:a.imagePreview,alt:"Attached",style:{"max-width":"100%"}},null,8,Ye)])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Xe,[Object(n["createElementVNode"])("input",{type:"file",onChange:t[24]||(t[24]=(...e)=>l.handleImageUpload&&l.handleImageUpload(...e)),accept:"image/*"},null,32),a.imagePreview?(Object(n["openBlock"])(),Object(n["createElementBlock"])("img",{key:0,src:a.imagePreview,alt:"Preview",style:{"max-width":"100%"}},null,8,Ze)):Object(n["createCommentVNode"])("",!0)])),t[73]||(t[73]=Object(n["createElementVNode"])("br",null,null,-1)),t[74]||(t[74]=Object(n["createElementVNode"])("br",null,null,-1)),t[75]||(t[75]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Save",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[25]||(t[25]=(...e)=>l.closeForm&&l.closeForm(...e))},"Close")],32)])],512),[[n["vShow"],a.showForm]])])])}var tt={name:"PubQuestions",data(){return{textbookTitle:"",textbookId:"",testBanks:[],selectedTestBank:null,selectedQuestionType:"",questions:[],selectedQuestionId:null,showForm:!1,showAddToTBModal:!1,questionToAddToTB:null,matchingPairs:[],imagePreview:"",editingQuestionId:null,oldMCOptionIds:[],editBlockedPopup:!1,editBlockedReason:"",questionData:{chapter:"",section:"",question:"",reference:"",answer:"",answerChoices:"",points:"",time:"",instructions:"",imageFile:null}}},methods:{async handleQuestionSave(){try{let e,t;const o=!!this.editingQuestionId,n=this.questions.find(e=>e.id===this.editingQuestionId);if(this.questionData.imageFile){if(e=new FormData,e.append("file",this.questionData.imageFile),e.append("question_text",this.questionData.question),e.append("default_points",this.questionData.points),e.append("est_time",this.questionData.time),e.append("chapter_number",this.questionData.chapter),e.append("section_number",this.questionData.section),e.append("grading_instructions",this.questionData.instructions),e.append("type",this.selectedQuestionType),e.append("source","manual"),e.append("textbook_id",this.textbookId),"True/False"===this.selectedQuestionType)e.append("true_false_answer","True"===this.questionData.answer);else if("Multiple Choice"===this.selectedQuestionType){const t=this.questionData.answerChoices.split(",").map(e=>e.trim()).filter(Boolean),o=[{option_text:this.questionData.answer.trim(),is_correct:!0},...t.map(e=>({option_text:e,is_correct:!1}))];e.append("options",JSON.stringify(o))}else"Matching"===this.selectedQuestionType?e.append("matches",JSON.stringify(this.matchingPairs.map(e=>({prompt_text:e.term,match_text:e.definition})))):"Fill in the Blank"===this.selectedQuestionType?e.append("blanks",JSON.stringify([{correct_text:this.questionData.answer}])):"Short Answer"===this.selectedQuestionType?e.append("answer",this.questionData.answer):"Essay"===this.selectedQuestionType&&e.append("grading_instructions",this.questionData.instructions);for(let[t,o]of e.entries())console.log(t+":",o);t={headers:{Authorization:"Bearer "+localStorage.getItem("token"),"Content-Type":"multipart/form-data"}}}else{if(e={question_text:this.questionData.question,default_points:parseInt(this.questionData.points),est_time:parseInt(this.questionData.time),chapter_number:this.questionData.chapter,section_number:this.questionData.section,grading_instructions:this.questionData.instructions,type:this.selectedQuestionType,source:"manual",textbook_id:this.textbookId},"True/False"===this.selectedQuestionType)e.true_false_answer="True"===this.questionData.answer;else if("Multiple Choice"===this.selectedQuestionType){const t=this.questionData.answerChoices.split(",").map(e=>e.trim()).filter(Boolean);e.options=[{option_text:this.questionData.answer.trim(),is_correct:!0},...t.map(e=>({option_text:e,is_correct:!1}))],o&&this.oldMCOptionIds.length>0&&(e.to_delete=this.oldMCOptionIds)}else if("Matching"===this.selectedQuestionType){if(e.matches=this.matchingPairs.map(e=>({prompt_text:e.term,match_text:e.definition})),o&&n){const t=(n.pairs||[]).map(e=>e.match_id);e.to_delete=t}}else"Fill in the Blank"===this.selectedQuestionType?e.blanks=[{correct_text:this.questionData.answer}]:"Short Answer"===this.selectedQuestionType?e.answer=this.questionData.answer:"Essay"===this.selectedQuestionType&&(e.grading_instructions=this.questionData.instructions);t={headers:{Authorization:"Bearer "+localStorage.getItem("token")}}}o?await F.patch("/questions/"+this.editingQuestionId,e,t):await F.post("/questions",e,t),this.closeForm(),this.resetForm(),this.fetchQuestions(this.selectedQuestionType)}catch(e){let t="Something went wrong.";e&&e.response&&e.response.data&&(t=e.response.data.error||e.response.data.message||t),alert("Save failed: "+t),console.error("Error saving question:",e)}},async fetchTestBanks(){try{const e=await F.get("/testbanks/publisher",{params:{textbook_id:this.textbookId},headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.testBanks=e.data.testbanks}catch(e){console.error("Error loading test banks:",e)}},async fetchQuestions(e){this.selectedQuestionType=e;try{const t=await F.get("/questions",{headers:{Authorization:"Bearer "+localStorage.getItem("token")},params:{textbook_id:this.textbookId,type:e}});Array.isArray(t.data.questions)?this.questions=t.data.questions.map(e=>{const t={text:e.question_text,type:e.type,points:e.default_points,id:e.id,instructions:e.grading_instructions||"",time:e.est_time,chapter:e.chapter_number,section:e.section_number,image_url:e.attachment&&e.attachment.url?e.attachment.url:"",is_published:e.is_published||!1};switch(e.type){case"True/False":return{...t,answer:e.true_false_answer};case"Multiple Choice":return{...t,correctOption:e.correct_option||null,incorrectOptions:e.incorrect_options||[]};case"Matching":return{...t,pairs:(e.matches||[]).map(e=>({term:e.prompt_text,definition:e.match_text}))};case"Fill in the Blank":return{...t,blanks:e.blanks||[]};case"Short Answer":return t;case"Essay":return t;default:return t}}):this.questions=[]}catch(t){console.error("Error fetching questions:",t),this.questions=[]}},openAddToTestBank(e){this.questionToAddToTB=e,this.showAddToTBModal=!0},closeAddToTBModal(){this.questionToAddToTB=null,this.showAddToTBModal=!1},async assignQuestionToTestBank(e){if(this.questionToAddToTB)try{await F.post(`/testbanks/publisher/${e}/questions`,{question_ids:[this.questionToAddToTB]},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),alert("Question successfully added to testbank!"),this.closeAddToTBModal()}catch(t){console.error("Failed to add question to testbank:",t);let e="Failed to add question.";t.response&&t.response.data&&t.response.data.error&&(e=t.response.data.error)}},selectTestBank(e){this.$router.push({name:"PubViewTB",query:{testbank_id:e.testbank_id,name:e.name,textbook_id:this.textbookId,title:this.textbookTitle,chapter:e.chapter_number,section:e.section_number}})},toggleQuestionSelection(e){this.selectedQuestionId=this.selectedQuestionId===e?null:e},selectQuestionType(e){this.selectedQuestionType=e,this.edit()},edit(){this.showForm=!0},closeForm(){this.showForm=!1,this.resetForm()},addPair(){this.matchingPairs.push({term:"",definition:""})},removePair(e){this.matchingPairs.splice(e,1)},handleImageUpload(e){const t=e.target.files[0];if(t){this.questionData.imageFile=t;const e=new FileReader;e.onload=e=>{this.imagePreview=e.target.result},e.readAsDataURL(t)}},resetForm(){this.questionData={chapter:"",section:"",question:"",reference:"",answer:"",answerChoices:"",points:"",time:"",instructions:"",imageFile:null},this.selectedQuestionType="",this.matchingPairs=[],this.imagePreview="",this.editingQuestionId=null,this.oldMCOptionIds=[];const e=document.querySelector('input[type="file"]');e&&(e.value="")},async editQuestion(e){try{const t=await F.get(`/questions/${e.id}/used_in`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(t.data.is_used)return this.editBlockedReason=`This question is used in a "${t.data.tests[0].status}" test: "${t.data.tests[0].name}".`,this.editingQuestionId=e.id,void(this.editBlockedPopup=!0)}catch(t){return console.error("Error checking question status:",t),void alert("Could not verify question status.")}this.editingQuestionId=e.id,this.questionData.question=e.text,this.questionData.chapter=e.chapter,this.questionData.section=e.section,this.questionData.points=e.points,this.questionData.time=e.time,this.questionData.instructions=e.instructions,this.questionData.answer=e.answer||"",this.selectedQuestionType=e.type,this.imagePreview=e.image_url||"","Multiple Choice"===e.type?(this.questionData.answer=e.correctOption&&e.correctOption.option_text||"",this.questionData.answerChoices=e.incorrectOptions.map(e=>e.option_text).join(", "),this.oldMCOptionIds=[],e.correctOption&&e.correctOption.option_id&&this.oldMCOptionIds.push(e.correctOption.option_id),Array.isArray(e.incorrectOptions)&&e.incorrectOptions.forEach(e=>{e.option_id&&this.oldMCOptionIds.push(e.option_id)})):"Matching"===e.type&&(this.matchingPairs=e.pairs.map(e=>({term:e.term,definition:e.definition}))),this.showForm=!0},async deleteQuestion(e){if(confirm("Are you sure you want to delete this question?"))try{await F.delete("/questions/"+e,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.questions=this.questions.filter(t=>t.id!==e)}catch(t){console.error(t),alert("Failed to delete question.")}},async createCopyInstead(){try{await F.post(`/questions/${this.editingQuestionId}/copy_to_textbook`,{textbook_id:this.textbookId},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});alert("A copy of the question was created. You can now edit it."),this.editBlockedPopup=!1,this.fetchQuestions(this.selectedQuestionType)}catch(e){console.error("Failed to create copy:",e),alert("Failed to create a copy of this question.")}}},mounted(){this.textbookTitle=this.$route.query.title||"Book Title",this.textbookId=this.$route.query.textbook_id||"",this.textbookId&&this.fetchTestBanks()}};o("ae62");const ot=r()(tt,[["render",et],["__scopeId","data-v-77706f3a"]]);var nt=ot;const ct={class:"theme-publisher"},at={class:"top-banner"},lt={class:"banner-title"},st={class:"banner-actions"},rt={class:"page-wrapper"},it={id:"feedbackContainer"},dt={key:0},bt={key:1},ut={key:2},mt=["onClick"],pt={key:0,class:"feedback-section"},ht={key:1},Ot={key:2,class:"p_button-group"},jt=["onClick"],kt={class:"form-popup-modal"};function gt(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ct,[Object(n["createElementVNode"])("div",at,[Object(n["createElementVNode"])("div",lt,"Draft Pool: "+Object(n["toDisplayString"])(a.selectedTestBank),1),Object(n["createElementVNode"])("div",st,[Object(n["createVNode"])(s,{to:"/PubHome",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[4]||(t[4]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[5]||(t[5]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",rt,[Object(n["createVNode"])(s,{to:{path:"/PubViewTB",query:{name:a.selectedTestBank,textbook_id:e.$route.query.textbook_id,testbank_id:e.$route.query.testbank_id}}},{default:Object(n["withCtx"])(()=>t[6]||(t[6]=[Object(n["createElementVNode"])("button",{class:"p_button"},"Return to Test Banks",-1)])),_:1},8,["to"]),t[12]||(t[12]=Object(n["createElementVNode"])("hr",null,null,-1)),Object(n["createElementVNode"])("div",it,[a.loading?(Object(n["openBlock"])(),Object(n["createElementBlock"])("p",dt,"Loading feedback...")):0===a.feedbackList.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("p",bt,"No questions in this test bank have feedback yet.")):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ut,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.feedbackList,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:o,class:Object(n["normalizeClass"])(["p_question-box",{selected:a.selectedQuestionId===e.question_id}]),onClick:t=>l.toggleQuestionSelection(e.question_id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.question_text)+" ",1),e.feedback&&e.feedback.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",pt,[t[7]||(t[7]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Feedback:")],-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.feedback,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},[Object(n["createTextVNode"])(' "'+Object(n["toDisplayString"])(e.comment)+'" — ',1),Object(n["createElementVNode"])("em",null,Object(n["toDisplayString"])(e.username)+" ("+Object(n["toDisplayString"])(e.role)+")",1)]))),128))])])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ht,t[8]||(t[8]=[Object(n["createElementVNode"])("p",null,"No feedback yet.",-1)]))),a.selectedQuestionId===e.question_id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ot,[Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>l.openFeedbackForm(e.question_id),["stop"])},"Leave Feedback",8,jt)])):Object(n["createCommentVNode"])("",!0)],10,mt))),128)),a.showFeedbackForm?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:0,class:"popup-overlay",onClick:t[3]||(t[3]=Object(n["withModifiers"])((...e)=>l.closeFeedbackForm&&l.closeFeedbackForm(...e),["self"]))},[Object(n["createElementVNode"])("div",kt,[t[9]||(t[9]=Object(n["createElementVNode"])("h2",null,"Leave Feedback",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.feedbackText=e),rows:"5",placeholder:"Enter your comment here..."},null,512),[[n["vModelText"],a.feedbackText]]),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),t[11]||(t[11]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("button",{class:"btn",onClick:t[1]||(t[1]=(...e)=>l.submitFeedback&&l.submitFeedback(...e))},"Submit"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[2]||(t[2]=(...e)=>l.closeFeedbackForm&&l.closeFeedbackForm(...e))},"Cancel")])])):Object(n["createCommentVNode"])("",!0)]))])])])}var Nt={name:"PubViewFeedback",data(){return{testbankId:null,selectedTestBank:"",feedbackList:[],loading:!0,userRole:"",selectedQuestionId:null,showFeedbackForm:!1,selectedQuestionIdForFeedback:null,feedbackText:""}},async mounted(){const e=this.$route.query;this.testbankId=parseInt(e.testbank_id),this.selectedTestBank=e.title||"No Test Bank Selected";const t=localStorage.getItem("token");if(t){const e=JSON.parse(atob(t.split(".")[1]));this.userRole=e.role}this.fetchFeedbackByTestbank()},methods:{async fetchFeedbackByTestbank(){try{const e=await F.get(`/feedback/${this.testbankId}/questions-with-feedback`);this.feedbackList=e.data,console.log("Feedback loaded:",this.feedbackList)}catch(e){console.error("Error loading feedback:",e)}finally{this.loading=!1}},toggleQuestionSelection(e){this.selectedQuestionId=this.selectedQuestionId===e?null:e},openFeedbackForm(e){this.selectedQuestionIdForFeedback=e,this.feedbackText="",this.showFeedbackForm=!0},closeFeedbackForm(){this.selectedQuestionIdForFeedback=null,this.feedbackText="",this.showFeedbackForm=!1},async submitFeedback(){try{await F.post("/feedback/create",{question_id:this.selectedQuestionIdForFeedback,comment_field:this.feedbackText},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.closeFeedbackForm();const e=this.feedbackList.find(e=>e.question_id===this.selectedQuestionIdForFeedback);e&&(e.feedback||(e.feedback=[]),e.feedback.push({comment:this.feedbackText,username:"You",role:this.userRole}))}catch(e){console.error("Error submitting feedback:",e)}}}};o("c88a");const Et=r()(Nt,[["render",gt],["__scopeId","data-v-fbcba3f2"]]);var yt=Et;const Vt={class:"theme-publisher"},ft={class:"top-banner"},wt={class:"banner-title"},Bt={class:"banner-actions"},vt={class:"page-wrapper"},Tt={class:"button-row"},_t=["disabled"],xt={key:0,class:"popup-overlay"},Ct={class:"form-popup-modal"},St={key:1,class:"publish-warning"},Ft={id:"questionsContainer"},It=["onClick"],Dt={key:0},qt={key:1},At={key:2},Pt={key:3},Qt={key:4},Mt={key:5},Lt={key:6},$t=["src"],zt={key:7},Ut=["href"],Rt={key:0},Ht=["src"],Wt={key:8,class:"p_button-group"},Gt=["onClick","disabled","title"];function Jt(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Vt,[Object(n["createElementVNode"])("div",ft,[Object(n["createElementVNode"])("div",wt,"Draft Pool: "+Object(n["toDisplayString"])(a.selectedTestBank),1),Object(n["createElementVNode"])("div",Bt,[Object(n["createVNode"])(s,{to:"/PubHome",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[9]||(t[9]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"p_banner-btn"},{default:Object(n["withCtx"])(()=>t[10]||(t[10]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",vt,[Object(n["createElementVNode"])("div",Tt,[Object(n["createElementVNode"])("button",{class:"p_button",onClick:t[0]||(t[0]=e=>a.showEditForm=!0)},"Edit Draft Pool Info"),Object(n["createVNode"])(s,{to:{path:"/PubQuestions",query:{title:this.textbookTitle,textbook_id:this.textbookId}}},{default:Object(n["withCtx"])(()=>t[11]||(t[11]=[Object(n["createElementVNode"])("button",{class:"p_button"},"Return to Question Page",-1)])),_:1},8,["to"]),Object(n["createVNode"])(s,{to:{name:"PubViewFeedback",query:{testbank_id:a.selectedTestBankId,title:a.selectedTestBank}}},{default:Object(n["withCtx"])(()=>t[12]||(t[12]=[Object(n["createElementVNode"])("button",{class:"p_button"},"View Feedback",-1)])),_:1},8,["to"]),Object(n["createElementVNode"])("button",{class:"p_button",onClick:t[1]||(t[1]=(...e)=>l.publishTestbank&&l.publishTestbank(...e)),disabled:a.published},Object(n["toDisplayString"])(a.published?"Draft Pool Published":"Publish Draft Pool"),9,_t),a.published?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:0,class:"p_button delete",onClick:t[2]||(t[2]=(...e)=>l.deleteTestBank&&l.deleteTestBank(...e))}," Delete Draft Pool "))]),a.showEditForm?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",xt,[Object(n["createElementVNode"])("div",Ct,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[7]||(t[7]=Object(n["withModifiers"])((...e)=>l.updateTestBank&&l.updateTestBank(...e),["prevent"]))},[t[13]||(t[13]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Draft Pool Name:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>a.editForm.name=e),required:""},null,512),[[n["vModelText"],a.editForm.name]]),t[14]||(t[14]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Chapter Number:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>a.editForm.chapter=e),required:""},null,512),[[n["vModelText"],a.editForm.chapter]]),t[15]||(t[15]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Section Number:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>a.editForm.section=e),required:""},null,512),[[n["vModelText"],a.editForm.section]]),t[16]||(t[16]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Save Changes",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[6]||(t[6]=e=>a.showEditForm=!1)},"Cancel")],32)])])):Object(n["createCommentVNode"])("",!0),a.published?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",St,t[17]||(t[17]=[Object(n["createElementVNode"])("strong",null,"Note:",-1),Object(n["createTextVNode"])(" This draft pool has been published. Question details can no longer be edited or removed. The draft pool cannot be deleted or modified. ")]))):Object(n["createCommentVNode"])("",!0),t[41]||(t[41]=Object(n["createElementVNode"])("hr",null,null,-1)),t[42]||(t[42]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("div",Ft,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.selectedQuestions,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("p",{key:e},Object(n["toDisplayString"])(e),1))),128))]),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.questions,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:o,class:Object(n["normalizeClass"])(["p_question-box",{selected:a.selectedQuestionId===e.id}]),onClick:t=>l.toggleQuestionSelection(e.id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.text),1),t[34]||(t[34]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[18]||(t[18]=Object(n["createElementVNode"])("strong",null,"Type:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.type),1)]),t[35]||(t[35]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[19]||(t[19]=Object(n["createElementVNode"])("strong",null,"Chapter:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.chapter||"N/A"),1)]),t[36]||(t[36]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[20]||(t[20]=Object(n["createElementVNode"])("strong",null,"Section:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.section||"N/A"),1)]),t[37]||(t[37]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[21]||(t[21]=Object(n["createElementVNode"])("strong",null,"Points:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.points),1)]),t[38]||(t[38]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[22]||(t[22]=Object(n["createElementVNode"])("strong",null,"Estimated Time:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.time)+" minutes",1)]),t[39]||(t[39]=Object(n["createElementVNode"])("br",null,null,-1)),"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Dt,[t[23]||(t[23]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.answer?"True":"False"),1)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",qt,[t[24]||(t[24]=Object(n["createElementVNode"])("strong",null,"Correct Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.correctOption&&e.correctOption.option_text||"Not specified"),1),t[25]||(t[25]=Object(n["createElementVNode"])("br",null,null,-1)),t[26]||(t[26]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Other Options:")],-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.incorrectOptions,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t,class:"incorrect-answer"},Object(n["toDisplayString"])(e.option_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Short Answer"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",At,[t[27]||(t[27]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.answer||"Not provided"),1)])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Pt,[t[28]||(t[28]=Object(n["createElementVNode"])("strong",null,"Correct Answer(s):",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.blanks,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.correct_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Qt,[t[29]||(t[29]=Object(n["createElementVNode"])("strong",null,"Pairs:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.pairs,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.term)+" - "+Object(n["toDisplayString"])(e.definition),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Essay"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Mt,[t[30]||(t[30]=Object(n["createElementVNode"])("strong",null,"Essay Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.instructions||"None"),1)])):Object(n["createCommentVNode"])("",!0),e.attachment?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Lt,[t[31]||(t[31]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Attached Image:")],-1)),Object(n["createElementVNode"])("img",{src:e.attachment,alt:"Question Attachment:",style:{"max-width":"100%","max-height":"400px","margin-bottom":"10px"}},null,8,$t)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("span",null,[t[32]||(t[32]=Object(n["createElementVNode"])("strong",null,"Grading Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.instructions||"None"),1)]),t[40]||(t[40]=Object(n["createElementVNode"])("br",null,null,-1)),e.attachments&&e.attachments.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",zt,[t[33]||(t[33]=Object(n["createElementVNode"])("strong",null,"Attachments:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.attachments,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},[Object(n["createElementVNode"])("a",{href:e.url,target:"_blank",rel:"noopener"},Object(n["toDisplayString"])(e.filename),9,Ut),e.filename&&e.filename.match(/\.(jpg|jpeg|png|gif)$/i)?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Rt,[Object(n["createElementVNode"])("img",{src:e.url,alt:"Attachment Image",style:{"max-width":"200px","margin-top":"10px"}},null,8,Ht)])):Object(n["createCommentVNode"])("",!0)]))),128))])])):Object(n["createCommentVNode"])("",!0),a.selectedQuestionId!==e.id||a.published?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Wt,[Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>l.removeQuestionFromTestBank(e.id),["stop"]),disabled:a.published,title:a.published?"Published — cannot remove question":"Remove from Draft Pool"},Object(n["toDisplayString"])(a.published?"Published - Cannot Remove":"Remove from Draft Pool"),9,Gt)]))],10,It))),128))]),Object(n["createElementVNode"])("input",{type:"file",id:"fileInput",style:{display:"none"},onChange:t[8]||(t[8]=(...t)=>e.handleFileUpload&&e.handleFileUpload(...t))},null,32)])])}var Kt={name:"PublisherViewTB",data(){return{showPopup:!1,showEditForm:!1,selectedTestBank:this.$route.query.name||"No Test Bank Selected",selectedTestBankId:this.$route.query.testbank_id||this.$route.params.testbank_id||null,textbookId:this.$route.query.textbook_id||null,textbookTitle:this.$route.query.title||null,selectedQuestionId:null,published:!1,questions:[],editForm:{name:this.$route.query.name||"",chapter:this.$route.query.chapter||"",section:this.$route.query.section||""}}},computed:{selectedQuestions(){return this.questions[this.selectedTestBank]||[]}},async mounted(){await this.checkPublishedStatus(),await this.loadQuestions()},methods:{selectTestBank(e){this.selectedTestBank=e},edit(){this.showPopup=!0},closeForm(){this.showPopup=!1,this.showEditForm=!1},async updateTestBank(){try{await F.put("/testbanks/publisher/"+this.selectedTestBankId,{name:this.editForm.name,chapter_number:this.editForm.chapter,section_number:this.editForm.section},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.selectedTestBank=this.editForm.name,this.showEditForm=!1}catch(e){console.error("Error updating test bank:",e)}},async loadQuestions(){if(this.selectedTestBankId)try{const e=await F.get(`/testbanks/publisher/${this.selectedTestBankId}/questions`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),t=e.data.questions||[];this.questions=t.map(e=>{const t={id:e.id,text:e.question_text,type:e.type,chapter:e.chapter_number||"N/A",section:e.section_number||"N/A",points:e.default_points||"N/A",time:e.est_time||"N/A",instructions:e.grading_instructions||"None",attachment:e.attachment&&e.attachment.url?e.attachment.url:""};switch(e.type){case"True/False":return{...t,answer:e.true_false_answer};case"Multiple Choice":return{...t,correctOption:e.correct_option||null,incorrectOptions:e.incorrect_options||[]};case"Matching":return{...t,pairs:(e.matches||[]).map(e=>({term:e.prompt_text,definition:e.match_text}))};case"Fill in the Blank":return{...t,blanks:e.blanks||[]};case"Short Answer":return{...t,answer:e.answer||""};case"Essay":return t;default:return t}})}catch(e){console.error("Error loading test bank questions:",e)}},toggleQuestionSelection(e){this.selectedQuestionId===e?this.selectedQuestionId=null:this.selectedQuestionId=e},async removeQuestionFromTestBank(e){if(confirm("Are you sure you want to remove this question from the test bank?"))try{await F.delete(`/testbanks/${this.selectedTestBankId}/questions/${e}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.questions=this.questions.filter(t=>t.id!==e),this.selectedQuestionId=null}catch(t){console.error("Error removing question:",t)}},async publishTestbank(){if(this.selectedTestBankId)try{await F.post(`/testbanks/${this.selectedTestBankId}/publish`,{},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.published=!0}catch(e){console.error("Error publishing test bank:",e)}},async deleteTestBank(){if(!this.published&&confirm("Are you sure you want to delete this entire draft pool? This action cannot be undone."))try{await F.delete("/testbanks/"+this.selectedTestBankId,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.$router.push({path:"/PubQuestions",query:{title:this.textbookTitle,textbook_id:this.textbookId}})}catch(e){console.error("Error deleting draft pool:",e)}},async checkPublishedStatus(){try{const e=await F.get("/testbanks/publisher",{headers:{Authorization:"Bearer "+localStorage.getItem("token")},params:{textbook_id:this.textbookId}}),t=e.data.testbanks||[],o=t.find(e=>e.testbank_id==this.selectedTestBankId);o?this.published=!0===o.is_published:console.warn("Testbank not found in returned list")}catch(e){console.error("Failed to fetch testbank status:",e)}}}};o("7855");const Yt=r()(Kt,[["render",Jt],["__scopeId","data-v-7100e5cd"]]);var Xt=Yt;const Zt={class:"theme-teacher"},eo={class:"top-banner"},to={class:"t_banner-actions"},oo={class:"center large-paragraph",style:{color:"#222"}},no={class:"page-wrapper"},co={class:"button-row"},ao={key:0,class:"t_dropdown"},lo={class:"t_dropdown-content"},so=["onClick"],ro={key:1},io={class:"page-wrapper",style:{"margin-top":"40px"}},bo={class:"button-row"},uo={class:"form-popup-modal"},mo={class:"form-container"},po={style:{"list-style-type":"none","padding-left":"0"}},ho=["onClick"],Oo={class:"form-popup-modal"},jo={style:{"list-style-type":"none","padding-left":"0"}},ko={style:{display:"flex","align-items":"center"}},go=["value"],No={style:{display:"flex","justify-content":"center",gap:"10px","margin-top":"20px"}};function Eo(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Zt,[Object(n["createElementVNode"])("div",eo,[t[9]||(t[9]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Course Selection",-1)),Object(n["createElementVNode"])("div",to,[Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[8]||(t[8]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",oo,[Object(n["createElementVNode"])("div",no,[t[17]||(t[17]=Object(n["createTextVNode"])(" Please select or create a course: ")),Object(n["createElementVNode"])("div",co,[a.courses.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ao,[t[10]||(t[10]=Object(n["createElementVNode"])("button",{class:"t_dropbtn"},"Select Course",-1)),Object(n["createElementVNode"])("div",lo,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.courses,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("a",{key:e.id,onClick:t=>l.selectCourse(e)},Object(n["toDisplayString"])(e.title),9,so))),128))])])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ro," No courses available. ")),Object(n["createVNode"])(s,{to:"TeacherNewClass"},{default:Object(n["withCtx"])(()=>t[11]||(t[11]=[Object(n["createElementVNode"])("button",{class:"t_button"},"Create New Course",-1)])),_:1})]),Object(n["createElementVNode"])("div",io,[t[12]||(t[12]=Object(n["createTextVNode"])(" Test Options: ")),Object(n["createElementVNode"])("div",bo,[Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[0]||(t[0]=(...e)=>l.viewPreviousTests&&l.viewPreviousTests(...e))},"View Previous Tests"),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[1]||(t[1]=(...e)=>l.chooseTestToPublish&&l.chooseTestToPublish(...e))},"Choose Test to Publish")])]),a.showPopup?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:0,class:"popup-overlay",onClick:t[3]||(t[3]=Object(n["withModifiers"])(e=>a.showPopup=!1,["self"]))},[Object(n["createElementVNode"])("div",uo,[Object(n["createElementVNode"])("form",mo,[t[13]||(t[13]=Object(n["createTextVNode"])(" Your Finalized Tests ")),Object(n["createElementVNode"])("ul",po,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.testFiles,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:e.test_id},[e.download_url&&e.hasAnswerKey?(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:0,class:"t_button",onClick:Object(n["withModifiers"])(t=>l.downloadTestAndKey(e),["prevent"])},Object(n["toDisplayString"])(e.name),9,ho)):Object(n["createCommentVNode"])("",!0)]))),128))]),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[2]||(t[2]=e=>a.showPopup=!1)},"Close")])])])):Object(n["createCommentVNode"])("",!0),a.showPublishSelector?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:1,class:"popup-overlay",onClick:t[7]||(t[7]=Object(n["withModifiers"])(e=>a.showPublishSelector=!1,["self"]))},[Object(n["createElementVNode"])("div",Oo,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[6]||(t[6]=Object(n["withModifiers"])((...e)=>l.publishSelectedTest&&l.publishSelectedTest(...e),["prevent"]))},[t[15]||(t[15]=Object(n["createElementVNode"])("h3",null,"Select a Finalized Test to Publish",-1)),t[16]||(t[16]=Object(n["createElementVNode"])("p",null,"Note: Any questions on a published tests ",-1)),Object(n["createElementVNode"])("ul",jo,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.testFiles,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:e.test_id,style:{"margin-bottom":"8px"}},[Object(n["createElementVNode"])("label",ko,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=e=>a.selectedTestIdToPublish=e),value:e.test_id,style:{"margin-right":"10px"}},null,8,go),[[n["vModelRadio"],a.selectedTestIdToPublish]]),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.name),1)])]))),128))]),Object(n["createElementVNode"])("div",No,[t[14]||(t[14]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Confirm Publish",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[5]||(t[5]=e=>a.showPublishSelector=!1)},"Cancel")])],32)])])):Object(n["createCommentVNode"])("",!0)])]),t[18]||(t[18]=Object(n["createElementVNode"])("br",null,null,-1))])}var yo={name:"TeacherHome",data(){return{courses:[],error:null,testFiles:[],showPopup:!1,showPublishSelector:!1,selectedTestIdToPublish:null}},created(){this.fetchCourses()},methods:{async fetchCourses(){try{console.log("Fetching courses...");const e=await F.get("/courses",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Courses fetched:",e.data),Array.isArray(e.data)?this.courses=e.data.map(e=>({id:e.course_id,title:e.course_name,textbook_id:e.textbook_id})):this.error="Failed to fetch course data."}catch(e){console.error("Error fetching course:",e),e.response?this.error=e.response.data.error||e.response.statusText:this.error="Network error or server is not responding."}},selectCourse(e){this.$router.push({name:"TeacherQuestions",query:{courseId:e.id,courseTitle:e.title,textbook_id:e.textbook_id}})},async viewPreviousTests(){try{const e=await F.get("/tests/final",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),t=e.data.final_tests||[],o=await Promise.all(t.map(async e=>{try{const t=await F.get(`/tests/${e.test_id}/answer_key`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.hasAnswerKey=!(!t.data||!t.data.file_url)}catch{e.hasAnswerKey=!1}return e}));this.testFiles=o,this.showPopup=!0}catch(e){console.error("Failed to fetch final tests:",e),alert("Could not load previous tests.")}},async downloadTestAndKey(e){if(!e.download_url)return void alert("Test file not available for download.");const t=document.createElement("a");t.href=e.download_url,t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t);try{const t=await F.get(`/tests/${e.test_id}/answer_key`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(t.data.file_url){const e=document.createElement("a");e.href=t.data.file_url,e.download="",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}catch(o){console.warn(`Failed to download answer key for test ${e.test_id}:`,o)}},async chooseTestToPublish(){try{const e=await F.get("/tests/final",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.testFiles=e.data.final_tests||[],this.selectedTestIdToPublish=null,this.showPublishSelector=!0}catch(e){console.error("Failed to load final tests for publishing:",e),alert("Could not load test list.")}},async publishSelectedTest(){if(this.selectedTestIdToPublish)try{await F.post(`/tests/${this.selectedTestIdToPublish}/publish`,{},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.showPublishSelector=!1}catch(e){console.error("❌ Publish failed:",e.response&&e.response.data||e.message),alert("Failed to publish the selected test.")}else alert("Please select a test to publish.")}}};o("fa7e");const Vo=r()(yo,[["render",Eo],["__scopeId","data-v-ce89d74a"]]);var fo=Vo;const wo={class:"theme-teacher"},Bo={class:"center large-paragraph",style:{color:"#222"}},vo=["disabled"],To={key:0,class:"error-message"},_o={key:1,class:"loading-message"};function xo(e,t,o,c,a,l){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",wo,[t[14]||(t[14]=Object(n["createElementVNode"])("div",{class:"top-banner"},[Object(n["createElementVNode"])("div",{class:"banner-title"},"Teacher Login")],-1)),Object(n["createElementVNode"])("div",Bo,[t[11]||(t[11]=Object(n["createTextVNode"])(" Please enter your teacher username and password: ")),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("form",{onSubmit:t[2]||(t[2]=Object(n["withModifiers"])((...e)=>l.submitForm&&l.submitForm(...e),["prevent"]))},[t[3]||(t[3]=Object(n["createElementVNode"])("label",{for:"uname"},"Username:",-1)),t[4]||(t[4]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"uname","onUpdate:modelValue":t[0]||(t[0]=e=>a.username=e)},null,512),[[n["vModelText"],a.username]]),t[5]||(t[5]=Object(n["createElementVNode"])("br",null,null,-1)),t[6]||(t[6]=Object(n["createElementVNode"])("br",null,null,-1)),t[7]||(t[7]=Object(n["createElementVNode"])("label",{for:"pass"},"Password:",-1)),t[8]||(t[8]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"password",id:"pass","onUpdate:modelValue":t[1]||(t[1]=e=>a.password=e)},null,512),[[n["vModelText"],a.password]]),t[9]||(t[9]=Object(n["createElementVNode"])("br",null,null,-1)),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("input",{type:"submit",value:"Submit",disabled:a.loading},null,8,vo)],32),a.errorMessage?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",To,Object(n["toDisplayString"])(a.errorMessage),1)):Object(n["createCommentVNode"])("",!0),a.loading?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",_o,"Logging in...")):Object(n["createCommentVNode"])("",!0)])])}var Co={data(){return{username:"",password:"",errorMessage:"",loading:!1}},mounted(){const e=localStorage.getItem("token");if(e)try{const t=Object(I["default"])(e),o=Date.now()/1e3;t.exp>o&&"teacher"===t.role&&this.$router.push("/TeacherHome")}catch(t){console.error("Invalid token",t)}},methods:{async submitForm(){if(this.username&&this.password)if(this.username.trim().length<3||this.password.trim().length<6)this.errorMessage="Username must be at least 3 characters and password at least 6 characters.";else{this.loading=!0,this.errorMessage="";try{const e=await F.post("/auth/login",{username:this.username.toLowerCase(),password:this.password}),{token:t,user_id:o,role:n}=e.data;localStorage.setItem("token",t),localStorage.setItem("user_id",o),localStorage.setItem("role",n),"teacher"===n?this.$router.push("/TeacherHome"):(this.errorMessage="Only teachers can log in here.",localStorage.clear())}catch(e){e.response?401===e.response.status?this.errorMessage="Invalid username or password.":this.errorMessage=e.response&&e.response.data&&e.response.data.message||"An error occurred during login.":this.errorMessage="Network error. Please check your connection."}finally{this.loading=!1}}else this.errorMessage="Please enter both username and password."}}};o("b7ca");const So=r()(Co,[["render",xo],["__scopeId","data-v-b879ec9e"]]);var Fo=So;const Io={class:"theme-teacher"},Do={class:"top-banner"},qo={class:"t_banner-actions"},Ao={class:"center large-paragraph",style:{color:"#222"}},Po=["value"],Qo={key:0,style:{color:"red","margin-top":"10px"}};function Mo(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Io,[Object(n["createElementVNode"])("div",Do,[t[6]||(t[6]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Create New Class",-1)),Object(n["createElementVNode"])("div",qo,[Object(n["createVNode"])(s,{to:"/TeacherHome",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[4]||(t[4]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[5]||(t[5]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",Ao,[Object(n["createElementVNode"])("form",{onSubmit:t[3]||(t[3]=Object(n["withModifiers"])((...e)=>l.saveCourse&&l.saveCourse(...e),["prevent"]))},[t[7]||(t[7]=Object(n["createElementVNode"])("label",{for:"courseTitle"},"Course Title:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"courseTitle","onUpdate:modelValue":t[0]||(t[0]=e=>a.courseTitle=e),style:{height:"20px"}},null,512),[[n["vModelText"],a.courseTitle]]),t[8]||(t[8]=Object(n["createElementVNode"])("br",null,null,-1)),t[9]||(t[9]=Object(n["createElementVNode"])("label",{for:"courseNumber"},"Course Number:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"courseNumber","onUpdate:modelValue":t[1]||(t[1]=e=>a.courseNumber=e),style:{height:"20px"}},null,512),[[n["vModelText"],a.courseNumber]]),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),t[11]||(t[11]=Object(n["createElementVNode"])("label",{for:"textbookTitle"},"Textbook Title:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("select",{id:"textbookTitle","onUpdate:modelValue":t[2]||(t[2]=e=>a.selectedTextbookId=e),style:{height:"50px",width:"200px"},required:""},[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.textbooks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("option",{key:e.id,value:e.id},Object(n["toDisplayString"])(e.title),9,Po))),128))],512),[[n["vModelSelect"],a.selectedTextbookId]]),a.textbooks.length?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Qo," No textbooks available. ")),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("div",{class:"center large-heading"},[Object(n["createElementVNode"])("input",{type:"submit",value:"Save"})],-1))],32)])])}var Lo={name:"TeacherNewClass",data(){return{courseTitle:"",courseNumber:"",selectedTextbookId:null,textbooks:[],error:null}},created(){this.fetchTextbooks()},methods:{async fetchTextbooks(){try{console.log("Fetching textbooks...");const e=await F.get("/textbooks/all",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Textbooks fetched:",e.data),e.data&&e.data.textbooks?this.textbooks=e.data.textbooks:this.error="Failed to fetch textbooks data."}catch(e){console.error("Error fetching textbooks:",e),e.response?this.error=`Error: ${e.response.status} - ${e.response.data.message||e.response.statusText}`:this.error="Network error or server is not responding."}},selectTextbook(e){this.selectedTextbookId=e.id,this.selectedTextbookTitle=e.title},async saveCourse(){if(this.courseTitle&&this.courseNumber&&this.selectedTextbookId){const t={course_name:this.courseTitle,course_number:this.courseNumber,textbook_id:this.selectedTextbookId};try{const e=await F.post("/courses",t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Course saved successfully:",e.data),this.$router.push({path:"/TeacherHome"})}catch(e){console.error("Error saving course:",e)}}}}};o("1ca3");const $o=r()(Lo,[["render",Mo],["__scopeId","data-v-37be9029"]]);var zo=$o;const Uo={class:"theme-teacher"},Ro={class:"top-banner"},Ho={class:"t_banner-actions"},Wo={class:"center large-paragraph",style:{color:"#222"}};function Go(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Uo,[Object(n["createElementVNode"])("div",Ro,[t[6]||(t[6]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Create New Draft Pool",-1)),Object(n["createElementVNode"])("div",Ho,[Object(n["createVNode"])(s,{to:"/TeacherHome",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[4]||(t[4]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[5]||(t[5]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",Wo,[Object(n["createElementVNode"])("form",{onSubmit:t[3]||(t[3]=Object(n["withModifiers"])((...e)=>l.saveTestBank&&l.saveTestBank(...e),["prevent"]))},[t[7]||(t[7]=Object(n["createElementVNode"])("label",{for:"bankName"},"Name of Draft Pool:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"bankName","onUpdate:modelValue":t[0]||(t[0]=e=>a.bankName=e),style:{height:"20px"}},null,512),[[n["vModelText"],a.bankName]]),t[8]||(t[8]=Object(n["createElementVNode"])("br",null,null,-1)),t[9]||(t[9]=Object(n["createElementVNode"])("br",null,null,-1)),t[10]||(t[10]=Object(n["createElementVNode"])("label",{for:"bankCh"},"Textbook Chapter:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"bankCh","onUpdate:modelValue":t[1]||(t[1]=e=>a.bankChapter=e),style:{height:"20px"}},null,512),[[n["vModelText"],a.bankChapter]]),t[11]||(t[11]=Object(n["createElementVNode"])("br",null,null,-1)),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("label",{for:"bankSec"},"Textbook Section:",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"bankSec","onUpdate:modelValue":t[2]||(t[2]=e=>a.bankSection=e),style:{height:"20px"}},null,512),[[n["vModelText"],a.bankSection]]),t[14]||(t[14]=Object(n["createElementVNode"])("br",null,null,-1)),t[15]||(t[15]=Object(n["createElementVNode"])("br",null,null,-1)),t[16]||(t[16]=Object(n["createElementVNode"])("input",{type:"submit",value:"Submit"},null,-1))],32)])])}var Jo={name:"TeacherNewTB",data(){return{courseId:this.$route.query.courseId||"",courseTitle:this.$route.query.courseTitle||"",bankName:"",bankChapter:"",bankSection:""}},methods:{async saveTestBank(){if(this.bankName&&this.bankChapter&&this.bankSection&&this.courseId){const t={testbank_name:this.bankName,chapter_number:this.bankChapter,section_number:this.bankSection,course_id:this.courseId};try{const e=await F.post("/testbanks/teacher",t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Test bank saved successfully:",e.data),alert("Test bank saved successfully!"),this.$router.push({path:"/TeacherQuestions",query:{courseTitle:this.courseTitle,courseId:this.courseId}})}catch(e){console.error("Error saving test bank:",e),alert("Failed to save the test bank. Please try again.")}}else alert("Please fill out all fields.")}}};o("8bca");const Ko=r()(Jo,[["render",Go],["__scopeId","data-v-e206ccd2"]]);var Yo=Ko;const Xo={class:"theme-teacher"},Zo={class:"top-banner"},en={class:"t_banner-actions"},tn={class:"center large-paragraph",style:{color:"#222"}},on={class:"button-row"},nn={key:0},cn=["onClick"],an={key:0},ln={key:1},sn={key:2},rn={key:3},dn={key:4},bn={key:5},un={key:6,class:"feedback-section"},mn={key:7},pn={key:0},hn=["src","alt"],On={key:8,class:"button-group"},jn=["onClick"],kn=["onClick"],gn={key:1},Nn={key:0,class:"center large-paragraph",style:{color:"#222"}},En={key:1},yn=["onClick"],Vn={key:0},fn={key:1},wn={key:2},Bn={key:3},vn={key:4},Tn={key:5},_n={key:6,class:"feedback-section"},xn={key:7},Cn={key:0},Sn=["src","alt"],Fn={key:8,class:"button-group"},In=["onClick"],Dn=["onClick"],qn={class:"form-popup-modal"},An={class:"form-popup-modal"},Pn={key:0},Qn=["onClick"];function Mn(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Xo,[Object(n["createElementVNode"])("div",Zo,[t[10]||(t[10]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Community Resources",-1)),Object(n["createElementVNode"])("div",en,[Object(n["createVNode"])(s,{to:"/TeacherHome",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[8]||(t[8]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[9]||(t[9]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",tn,[t[51]||(t[51]=Object(n["createTextVNode"])(" Please select an option to view: ")),Object(n["createElementVNode"])("div",on,[Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[0]||(t[0]=(...e)=>l.viewPublishedTests&&l.viewPublishedTests(...e))},"Published Tests"),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[1]||(t[1]=(...e)=>l.fetchFeedback&&l.fetchFeedback(...e))},"View Community Draft Pools")]),"published"===a.viewing?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",nn,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.fullTestbanks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.testbank_id,class:"published-bank"},[Object(n["createElementVNode"])("h3",null,Object(n["toDisplayString"])(e.name)+" (Chapter "+Object(n["toDisplayString"])(e.chapter_number)+", Section "+Object(n["toDisplayString"])(e.section_number)+")",1),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.questions,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.id,class:Object(n["normalizeClass"])(["question-box",{selected:a.selectedQuestionId===e.id}]),onClick:t=>l.toggleQuestionSelection(e.id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.question_text),1),t[25]||(t[25]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[11]||(t[11]=Object(n["createElementVNode"])("strong",null,"Type:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.type),1)]),t[26]||(t[26]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[12]||(t[12]=Object(n["createElementVNode"])("strong",null,"Chapter:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.chapter_number||"N/A"),1)]),t[27]||(t[27]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[13]||(t[13]=Object(n["createElementVNode"])("strong",null,"Section:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.section_number||"N/A"),1)]),t[28]||(t[28]=Object(n["createElementVNode"])("br",null,null,-1)),"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",an,[t[14]||(t[14]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.true_false_answer?"True":"False"),1)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ln,[t[15]||(t[15]=Object(n["createElementVNode"])("span",{class:"correct-answer"},"Correct Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.correct_option&&e.correct_option.option_text||"Not specified")+" ",1),t[16]||(t[16]=Object(n["createElementVNode"])("br",null,null,-1)),t[17]||(t[17]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Other Options:")],-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.incorrect_options,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t,class:"incorrect-answer"},Object(n["toDisplayString"])(e.option_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",sn,[t[18]||(t[18]=Object(n["createElementVNode"])("strong",null,"Pairs:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.matches,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.prompt_text)+" - "+Object(n["toDisplayString"])(e.match_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",rn,[t[19]||(t[19]=Object(n["createElementVNode"])("strong",null,"Correct Answers:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.blanks,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.correct_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Short Answer"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",dn,[t[20]||(t[20]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.answer||"Not provided"),1)])):Object(n["createCommentVNode"])("",!0),"Essay"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",bn,[t[21]||(t[21]=Object(n["createElementVNode"])("strong",null,"Essay Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.grading_instructions||"None"),1)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",null,[t[22]||(t[22]=Object(n["createElementVNode"])("strong",null,"Grading Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.grading_instructions||"None"),1)]),e.feedback&&e.feedback.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",un,[t[23]||(t[23]=Object(n["createElementVNode"])("strong",null,"Feedback:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.feedback,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},[Object(n["createElementVNode"])("em",null,Object(n["toDisplayString"])(e.username)+" ("+Object(n["toDisplayString"])(e.role)+")",1),Object(n["createTextVNode"])(': "'+Object(n["toDisplayString"])(e.comment)+'" ',1)]))),128))])])):Object(n["createCommentVNode"])("",!0),e.attachment||e.attachments&&e.attachments.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",mn,[t[24]||(t[24]=Object(n["createElementVNode"])("strong",null,"Attachments:",-1)),Object(n["createElementVNode"])("ul",null,[e.attachment?(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",pn,[Object(n["createElementVNode"])("img",{src:e.attachment.url,alt:e.attachment.name,style:{"max-width":"100%","margin-top":"10px"}},null,8,hn)])):Object(n["createCommentVNode"])("",!0)])])):Object(n["createCommentVNode"])("",!0),a.selectedQuestionId===e.id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",On,[Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>l.openFeedbackForm(e.id),["stop"])},"Leave Feedback",8,jn),Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>l.openTestBankModal(e.id),["stop"])},"Add to Draft Pool",8,kn)])):Object(n["createCommentVNode"])("",!0)],10,cn))),128))]))),128))])):Object(n["createCommentVNode"])("",!0),"published-tests"===a.viewing?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",gn,[0===a.fullTestbanks.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Nn," No published tests available for this course. ")):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",En,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.fullTestbanks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.testbank_id,class:"published-bank"},[Object(n["createElementVNode"])("h3",null,Object(n["toDisplayString"])(e.name)+" (Chapter "+Object(n["toDisplayString"])(e.chapter_number)+", Section "+Object(n["toDisplayString"])(e.section_number)+")",1),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.questions,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.id,class:Object(n["normalizeClass"])(["question-box",{selected:a.selectedQuestionId===e.id}]),onClick:t=>l.toggleQuestionSelection(e.id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.question_text),1),t[43]||(t[43]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[29]||(t[29]=Object(n["createElementVNode"])("strong",null,"Type:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.type),1)]),t[44]||(t[44]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[30]||(t[30]=Object(n["createElementVNode"])("strong",null,"Chapter:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.chapter_number||"N/A"),1)]),t[45]||(t[45]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[31]||(t[31]=Object(n["createElementVNode"])("strong",null,"Section:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.section_number||"N/A"),1)]),t[46]||(t[46]=Object(n["createElementVNode"])("br",null,null,-1)),"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Vn,[t[32]||(t[32]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.true_false_answer?"True":"False"),1)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",fn,[t[33]||(t[33]=Object(n["createElementVNode"])("span",{class:"correct-answer"},"Correct Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.correct_option&&e.correct_option.option_text||"Not specified")+" ",1),t[34]||(t[34]=Object(n["createElementVNode"])("br",null,null,-1)),t[35]||(t[35]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Other Options:")],-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.incorrect_options,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t,class:"incorrect-answer"},Object(n["toDisplayString"])(e.option_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",wn,[t[36]||(t[36]=Object(n["createElementVNode"])("strong",null,"Pairs:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.matches,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.prompt_text)+" - "+Object(n["toDisplayString"])(e.match_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Bn,[t[37]||(t[37]=Object(n["createElementVNode"])("strong",null,"Correct Answers:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.blanks,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.correct_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Short Answer"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",vn,[t[38]||(t[38]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.answer||"Not provided"),1)])):Object(n["createCommentVNode"])("",!0),"Essay"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Tn,[t[39]||(t[39]=Object(n["createElementVNode"])("strong",null,"Essay Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.grading_instructions||"None"),1)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",null,[t[40]||(t[40]=Object(n["createElementVNode"])("strong",null,"Grading Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.grading_instructions||"None"),1)]),e.feedback&&e.feedback.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",_n,[t[41]||(t[41]=Object(n["createElementVNode"])("strong",null,"Feedback:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.feedback,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},[Object(n["createElementVNode"])("em",null,Object(n["toDisplayString"])(e.username)+" ("+Object(n["toDisplayString"])(e.role)+")",1),Object(n["createTextVNode"])(': "'+Object(n["toDisplayString"])(e.comment)+'" ',1)]))),128))])])):Object(n["createCommentVNode"])("",!0),e.attachment||e.attachments&&e.attachments.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",xn,[t[42]||(t[42]=Object(n["createElementVNode"])("strong",null,"Attachments:",-1)),Object(n["createElementVNode"])("ul",null,[e.attachment?(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",Cn,[Object(n["createElementVNode"])("img",{src:e.attachment.url,alt:e.attachment.name,style:{"max-width":"100%","margin-top":"10px"}},null,8,Sn)])):Object(n["createCommentVNode"])("",!0)])])):Object(n["createCommentVNode"])("",!0),a.selectedQuestionId===e.id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Fn,[Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>l.openFeedbackForm(e.id),["stop"])},"Leave Feedback",8,In),Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>l.openTestBankModal(e.id),["stop"])},"Add to Draft Pool",8,Dn)])):Object(n["createCommentVNode"])("",!0)],10,yn))),128))]))),128))]))])):Object(n["createCommentVNode"])("",!0),a.showFeedbackForm?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:2,class:"popup-overlay",onClick:t[5]||(t[5]=Object(n["withModifiers"])((...e)=>l.closeFeedbackForm&&l.closeFeedbackForm(...e),["self"]))},[Object(n["createElementVNode"])("div",qn,[t[47]||(t[47]=Object(n["createElementVNode"])("h2",null,"Leave Feedback",-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>a.feedbackText=e),rows:"5",style:{width:"100%"},placeholder:"Enter your comment here..."},null,512),[[n["vModelText"],a.feedbackText]]),t[48]||(t[48]=Object(n["createElementVNode"])("br",null,null,-1)),t[49]||(t[49]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("button",{class:"btn",onClick:t[3]||(t[3]=(...e)=>l.submitFeedback&&l.submitFeedback(...e))},"Submit"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[4]||(t[4]=(...e)=>l.closeFeedbackForm&&l.closeFeedbackForm(...e))},"Cancel")])])):Object(n["createCommentVNode"])("",!0),a.showTestBankModal?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:3,class:"popup-overlay",onClick:t[7]||(t[7]=Object(n["withModifiers"])((...e)=>l.closeTestBankModal&&l.closeTestBankModal(...e),["self"]))},[Object(n["createElementVNode"])("div",An,[t[50]||(t[50]=Object(n["createElementVNode"])("h2",null,"Select a Draft Pool",-1)),a.testBanks.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Pn,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.testBanks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:e.testbank_id,class:"t_button",onClick:t=>l.assignToDraftPool(e.testbank_id),style:{"margin-bottom":"10px"}},Object(n["toDisplayString"])(e.name),9,Qn))),128))])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[6]||(t[6]=(...e)=>l.closeTestBankModal&&l.closeTestBankModal(...e))},"Cancel")])])):Object(n["createCommentVNode"])("",!0)])])}var Ln={name:"TeacherPubQ",data(){return{courseId:"",textbookId:"",fullTestbanks:[],viewing:"",showFeedbackForm:!1,selectedQuestionIdForFeedback:null,feedbackText:"",testBanks:[],selectedQuestionToAdd:null,showTestBankModal:!1,selectedQuestionId:null}},mounted(){this.courseId=this.$route.query.course_id,this.fetchCourseTextbook(),this.fetchTeacherTestbanks()},methods:{async fetchFeedback(){this.viewing="published";try{const e=await F.get("/resources/full-testbanks?course_id="+this.courseId,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.fullTestbanks=e.data.testbanks||[],console.log("Full published testbanks loaded:",this.fullTestbanks);for(const t of this.fullTestbanks)for(const e of t.questions)await this.loadFeedbackForQuestion(e),console.log("Fetched questions:",t.questions),e.attachment&&!e.attachments&&(e.attachments=[e.attachment])}catch(e){console.error("Failed to load testbanks:",e),alert("Could not load published testbanks.")}},openFeedbackForm(e){this.selectedQuestionIdForFeedback=e,this.feedbackText="",this.showFeedbackForm=!0},closeFeedbackForm(){this.selectedQuestionIdForFeedback=null,this.feedbackText="",this.showFeedbackForm=!1},async fetchCourseTextbook(){try{const e=await F.get("/courses/"+this.courseId,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.textbookId=e.data.textbook_id,console.log("Fetched textbook ID:",this.textbookId)}catch(e){console.error("Failed to fetch course textbook:",e)}},async viewPublishedTests(){this.viewing="published-tests",this.fullTestbanks=[];try{if(!this.textbookId){const e=await F.get("/courses/"+this.courseId,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.textbookId=e.data.textbook_id}const t=await F.get("/courses",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),o=(t.data||[]).filter(e=>e.textbook_id==this.textbookId).map(e=>e.course_id),n=await F.get("/tests/published",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),c=(n.data||[]).filter(e=>o.includes(e.course_id));for(const a of c)try{const e=await F.get(`/resources/tests/${a.test_id}/questions`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),t=e.data.questions||[];for(const o of t)await this.loadFeedbackForQuestion(o),o.attachment&&!o.attachments&&(o.attachments=[o.attachment]);this.fullTestbanks.push({testbank_id:a.test_id,name:a.name||"Test "+a.test_id,chapter_number:"N/A",section_number:"N/A",questions:t})}catch(e){console.error("❌ Failed to fetch questions for test ID "+a.test_id,e)}console.log("✅ Published test questions loaded:",this.fullTestbanks)}catch(e){console.error("🚨 Failed to load published tests:",e)}},async fetchTeacherTestbanks(){try{const e=await F.get("/testbanks/teacher?course_id="+this.courseId,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.testBanks=e.data.testbanks||[]}catch(e){console.error("Failed to load teacher testbanks:",e)}},toggleQuestionSelection(e){this.selectedQuestionId=this.selectedQuestionId===e?null:e},openFeedbackForm(e){this.selectedQuestionIdForFeedback=e,this.feedbackText="",this.showFeedbackForm=!0},closeFeedbackForm(){this.selectedQuestionIdForFeedback=null,this.feedbackText="",this.showFeedbackForm=!1},async submitFeedback(){try{await F.post("/feedback/create",{question_id:this.selectedQuestionIdForFeedback,comment_field:this.feedbackText},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.closeFeedbackForm()}catch(e){console.error("Error submitting feedback:",e)}},openTestBankModal(e){this.selectedQuestionToAdd=e,this.showTestBankModal=!0},closeTestBankModal(){this.selectedQuestionToAdd=null,this.showTestBankModal=!1},async assignToDraftPool(e){try{await F.post(`/testbanks/${e}/questions`,{question_ids:[this.selectedQuestionToAdd]},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.closeTestBankModal()}catch(t){console.error("Failed to assign to draft pool:",t)}},async loadFeedbackForQuestion(e){try{const t=await F.get("/feedback/question/"+e.id,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});e.feedback=t.data||[]}catch(t){console.error("Failed to load feedback for question "+e.id,t)}}}};o("5f50");const $n=r()(Ln,[["render",Mn],["__scopeId","data-v-38a756e6"]]);var zn=$n;const Un={class:"theme-teacher"},Rn={class:"top-banner"},Hn={class:"banner-title"},Wn={class:"t_banner-actions"},Gn={class:"form-popup-modal"},Jn={class:"page-wrapper"},Kn={class:"button-row"},Yn={class:"t_dropdown"},Xn={class:"t_dropbtn"},Zn={class:"t_dropdown-content"},ec=["onClick"],tc={class:"t_dropdown"},oc={class:"t_dropdown-content"},nc={id:"selectedQuestionType",style:{color:"#222"},class:"center large-paragraph"},cc=["onClick"],ac={key:0},lc={key:1},sc={key:2},rc={key:3},ic={key:4},dc=["src"],bc={key:5,class:"button-group"},uc=["onClick"],mc=["onClick"],pc=["onClick"],hc={class:"form-popup-modal"},Oc={style:{display:"flex","flex-direction":"column","align-items":"flex-start"}},jc=["onClick"],kc={class:"form-container",style:{width:"100%"}},gc={class:"form-popup-modal"},Nc={style:{"list-style-type":"none","padding-left":"0"}},Ec=["onClick"],yc={class:"form-popup-modal"},Vc={key:0},fc={key:1},wc=["value"],Bc={key:2},vc={key:3},Tc={key:4},_c=["onUpdate:modelValue"],xc=["onUpdate:modelValue"],Cc=["onClick"],Sc={key:5},Fc={key:6},Ic={key:7},Dc=["src"],qc={key:8},Ac=["src"],Pc={class:"form-popup-modal"};function Qc(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Un,[Object(n["createElementVNode"])("div",Rn,[Object(n["createElementVNode"])("div",Hn,Object(n["toDisplayString"])(a.courseTitle),1),Object(n["createElementVNode"])("div",Wn,[Object(n["createVNode"])(s,{to:"/TeacherHome",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[39]||(t[39]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[40]||(t[40]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),a.editBlockedPopup?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:0,class:"popup-overlay",onClick:t[2]||(t[2]=Object(n["withModifiers"])(e=>a.editBlockedPopup=!1,["self"]))},[Object(n["createElementVNode"])("div",Gn,[t[41]||(t[41]=Object(n["createElementVNode"])("h2",null,"Cannot Edit Question",-1)),Object(n["createElementVNode"])("p",null,Object(n["toDisplayString"])(a.editBlockedReason),1),t[42]||(t[42]=Object(n["createElementVNode"])("p",null,"A new copy will be made instead.",-1)),Object(n["createElementVNode"])("button",{class:"btn",onClick:t[0]||(t[0]=(...e)=>l.createCopyInstead&&l.createCopyInstead(...e))},"Create a Copy"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[1]||(t[1]=e=>a.editBlockedPopup=!1)},"Cancel")])])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",Jn,[Object(n["createElementVNode"])("div",Kn,[Object(n["createElementVNode"])("div",Yn,[Object(n["createElementVNode"])("button",Xn,Object(n["toDisplayString"])(a.selectedTestBank?a.selectedTestBank.name:"Select Draft Pool"),1),Object(n["createElementVNode"])("div",Zn,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.testBanks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("a",{key:e.testbank_id,href:"#",onClick:Object(n["withModifiers"])(t=>l.selectTestBank(e),["prevent"])},Object(n["toDisplayString"])(e.name),9,ec))),128))])]),Object(n["createVNode"])(s,{to:{path:"/TeacherNewTB",query:{courseId:a.courseId}}},{default:Object(n["withCtx"])(()=>t[43]||(t[43]=[Object(n["createElementVNode"])("button",{class:"t_button"},"New Draft Pool",-1)])),_:1},8,["to"]),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[3]||(t[3]=(...e)=>l.importTest&&l.importTest(...e))},"Import Test"),Object(n["createElementVNode"])("div",tc,[t[44]||(t[44]=Object(n["createElementVNode"])("button",{class:"t_dropbtn"},"Question Type",-1)),Object(n["createElementVNode"])("div",oc,[Object(n["createElementVNode"])("a",{onClick:t[4]||(t[4]=e=>l.selectQuestionType("True/False"))},"True/False"),Object(n["createElementVNode"])("a",{onClick:t[5]||(t[5]=e=>l.selectQuestionType("Multiple Choice"))},"Multiple Choice"),Object(n["createElementVNode"])("a",{onClick:t[6]||(t[6]=e=>l.selectQuestionType("Matching"))},"Matching"),Object(n["createElementVNode"])("a",{onClick:t[7]||(t[7]=e=>l.selectQuestionType("Fill in the Blank"))},"Fill in the Blank"),Object(n["createElementVNode"])("a",{onClick:t[8]||(t[8]=e=>l.selectQuestionType("Short Answer"))},"Short Answer"),Object(n["createElementVNode"])("a",{onClick:t[9]||(t[9]=e=>l.selectQuestionType("Essay"))},"Essay")])]),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[10]||(t[10]=e=>a.showCourseEditPopup=!0)},"Edit Course Info"),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[11]||(t[11]=(...e)=>l.edit&&l.edit(...e))},"New Question"),Object(n["createVNode"])(s,{to:{name:"TeacherPubQ",query:{course_id:a.courseId,textbook_id:a.textbookId}}},{default:Object(n["withCtx"])(()=>t[45]||(t[45]=[Object(n["createElementVNode"])("button",{class:"t_button"},"Community Resources",-1)])),_:1},8,["to"]),Object(n["createElementVNode"])("div",nc,Object(n["toDisplayString"])(a.selectedQuestionType),1)]),t[46]||(t[46]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Note:"),Object(n["createTextVNode"])(" Import one Canvas quiz in the QTI at a time please.")],-1)),t[47]||(t[47]=Object(n["createElementVNode"])("hr",null,null,-1))]),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.questions,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:o,class:Object(n["normalizeClass"])(["question-box",{selected:a.selectedQuestionId===e.id}]),onClick:t=>l.toggleQuestionSelection(e.id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.text),1),t[61]||(t[61]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[48]||(t[48]=Object(n["createElementVNode"])("strong",null,"Type:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.type),1)]),t[62]||(t[62]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[49]||(t[49]=Object(n["createElementVNode"])("strong",null,"Chapter:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.chapter||"N/A"),1)]),t[63]||(t[63]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[50]||(t[50]=Object(n["createElementVNode"])("strong",null,"Section:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.section||"N/A"),1)]),t[64]||(t[64]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[51]||(t[51]=Object(n["createElementVNode"])("strong",null,"Points:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.points),1)]),t[65]||(t[65]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[52]||(t[52]=Object(n["createElementVNode"])("strong",null,"Estimated Time:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.time)+" minutes",1)]),t[66]||(t[66]=Object(n["createElementVNode"])("br",null,null,-1)),"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ac,[t[53]||(t[53]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.answer?"True":"False"),1)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",lc,[t[54]||(t[54]=Object(n["createElementVNode"])("strong",null,"Correct Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.correctOption&&e.correctOption.option_text||"Not specified"),1),t[55]||(t[55]=Object(n["createElementVNode"])("br",null,null,-1)),t[56]||(t[56]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Other Options:")],-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.incorrectOptions,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t,class:"incorrect-answer"},Object(n["toDisplayString"])(e.option_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",sc,[t[57]||(t[57]=Object(n["createElementVNode"])("strong",null,"Correct Answer(s):",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.blanks,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.correct_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",rc,[t[58]||(t[58]=Object(n["createElementVNode"])("strong",null,"Pairs:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.pairs,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.term)+" - "+Object(n["toDisplayString"])(e.definition),1))),128))])])):Object(n["createCommentVNode"])("",!0),e.image_url?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ic,[t[59]||(t[59]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Attached Image:")],-1)),Object(n["createElementVNode"])("img",{src:e.image_url,alt:"Question Attachment:",style:{"max-width":"100%","max-height":"400px","margin-bottom":"10px"}},null,8,dc)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("span",null,[t[60]||(t[60]=Object(n["createElementVNode"])("strong",null,"Grading Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.instructions||"None"),1)]),t[67]||(t[67]=Object(n["createElementVNode"])("br",null,null,-1)),a.selectedQuestionId===e.id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",bc,[Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>l.editQuestion(e),["stop"])},"Edit",8,uc),Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>l.deleteQuestion(e.id),["stop"])},"Delete",8,mc),Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>l.openAddToTestBank(e.id),["stop"])},"Add to Draft Pool",8,pc)])):Object(n["createCommentVNode"])("",!0)],10,cc))),128))]),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",{class:"popup-overlay",onClick:t[13]||(t[13]=Object(n["withModifiers"])((...e)=>l.closeAddToTBModal&&l.closeAddToTBModal(...e),["self"]))},[Object(n["createElementVNode"])("div",hc,[t[68]||(t[68]=Object(n["createElementVNode"])("h2",null,"Select draft pool to add question to:",-1)),Object(n["createElementVNode"])("div",Oc,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.testBanks,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.testbank_id,style:{"margin-bottom":"10px",width:"100%"}},[Object(n["createElementVNode"])("button",{class:"t_button",style:{width:"100%"},onClick:t=>l.assignQuestionToTestBank(e.testbank_id)},Object(n["toDisplayString"])(e.name),9,jc)]))),128)),Object(n["createElementVNode"])("div",kc,[Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",style:{width:"100%"},onClick:t[12]||(t[12]=(...e)=>l.closeAddToTBModal&&l.closeAddToTBModal(...e))}," Close ")])])])],512),[[n["vShow"],a.showAddToTBModal]]),Object(n["createElementVNode"])("input",{type:"file",id:"fileInput",style:{display:"none"},onChange:t[14]||(t[14]=(...e)=>l.handleFileUpload&&l.handleFileUpload(...e))},null,32),e.showPopup?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:1,class:"popup-overlay",onClick:t[17]||(t[17]=Object(n["withModifiers"])((...e)=>l.closeForm&&l.closeForm(...e),["self"]))},[Object(n["createElementVNode"])("div",gc,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[16]||(t[16]=Object(n["withModifiers"])(()=>{},["prevent"]))},[t[69]||(t[69]=Object(n["createElementVNode"])("h3",null,"Your Finalized Tests",-1)),Object(n["createElementVNode"])("ul",Nc,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.testFiles,t=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t.test_id},[t.download_url&&t.hasAnswerKey?(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:0,class:"t_button",onClick:o=>e.downloadTestAndKey(t)},Object(n["toDisplayString"])(t.name),9,Ec)):Object(n["createCommentVNode"])("",!0)]))),128))]),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[15]||(t[15]=(...e)=>l.closeForm&&l.closeForm(...e))},"Close")],32)])])):Object(n["createCommentVNode"])("",!0),Object(n["withDirectives"])(Object(n["createElementVNode"])("div",{class:"popup-overlay",onClick:t[33]||(t[33]=Object(n["withModifiers"])((...e)=>l.closeForm&&l.closeForm(...e),["self"]))},[Object(n["createElementVNode"])("div",yc,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[32]||(t[32]=Object(n["withModifiers"])((...e)=>l.handleQuestionSave&&l.handleQuestionSave(...e),["prevent"]))},[Object(n["createElementVNode"])("h1",null,Object(n["toDisplayString"])(a.editingQuestionId?"Edit Question":"New Question"),1),t[79]||(t[79]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Chapter Number")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[18]||(t[18]=e=>a.chapter=e),required:""},null,512),[[n["vModelText"],a.chapter]]),t[80]||(t[80]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Section Number")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[19]||(t[19]=e=>a.section=e),required:""},null,512),[[n["vModelText"],a.section]]),t[81]||(t[81]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Question Type"),Object(n["createElementVNode"])("br")],-1)),a.editingQuestionId?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",fc,[Object(n["createElementVNode"])("input",{type:"text",value:a.selectedQuestionType,disabled:""},null,8,wc)])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Vc,[Object(n["withDirectives"])(Object(n["createElementVNode"])("select",{"onUpdate:modelValue":t[20]||(t[20]=e=>a.selectedQuestionType=e),required:""},t[70]||(t[70]=[Object(n["createElementVNode"])("option",{disabled:"",value:""},"Select a type",-1),Object(n["createElementVNode"])("option",null,"True/False",-1),Object(n["createElementVNode"])("option",null,"Multiple Choice",-1),Object(n["createElementVNode"])("option",null,"Matching",-1),Object(n["createElementVNode"])("option",null,"Fill in the Blank",-1),Object(n["createElementVNode"])("option",null,"Short Answer",-1),Object(n["createElementVNode"])("option",null,"Essay",-1)]),512),[[n["vModelSelect"],a.selectedQuestionType]])])),t[82]||(t[82]=Object(n["createElementVNode"])("br",null,null,-1)),t[83]||(t[83]=Object(n["createElementVNode"])("br",null,null,-1)),t[84]||(t[84]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Question Text")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[21]||(t[21]=e=>a.question=e),required:""},null,512),[[n["vModelText"],a.question]]),"True/False"===a.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Bc,[t[72]||(t[72]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("select",{"onUpdate:modelValue":t[22]||(t[22]=e=>a.answer=e)},t[71]||(t[71]=[Object(n["createElementVNode"])("option",{value:"True"},"True",-1),Object(n["createElementVNode"])("option",{value:"False"},"False",-1)]),512),[[n["vModelSelect"],a.answer]])])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===a.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",vc,[t[73]||(t[73]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Correct Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[23]||(t[23]=e=>a.answer=e)},null,512),[[n["vModelText"],a.answer]]),t[74]||(t[74]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Incorrect Answer Choices (comma-separated)")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[24]||(t[24]=e=>a.answerChoices=e)},null,512),[[n["vModelText"],a.answerChoices]])])):Object(n["createCommentVNode"])("",!0),"Matching"===a.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Tc,[t[75]||(t[75]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Matching Pairs")],-1)),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.matchingPairs,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:t},[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t=>e.term=t,placeholder:"Term"},null,8,_c),[[n["vModelText"],e.term]]),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t=>e.definition=t,placeholder:"Definition"},null,8,xc),[[n["vModelText"],e.definition]]),Object(n["createElementVNode"])("button",{type:"button",onClick:e=>l.removePair(t)},"Remove",8,Cc)]))),128)),Object(n["createElementVNode"])("button",{type:"button",onClick:t[25]||(t[25]=(...e)=>l.addPair&&l.addPair(...e))},"Add Pair")])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===a.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Sc,[t[76]||(t[76]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Correct Answer")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[26]||(t[26]=e=>a.answer=e)},null,512),[[n["vModelText"],a.answer]])])):Object(n["createCommentVNode"])("",!0),"Essay"===a.selectedQuestionType?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Fc)):Object(n["createCommentVNode"])("",!0),t[85]||(t[85]=Object(n["createElementVNode"])("br",null,null,-1)),t[86]||(t[86]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Points Worth")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[27]||(t[27]=e=>a.points=e),required:""},null,512),[[n["vModelText"],a.points]]),t[87]||(t[87]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Estimated Time (in minutes)")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[28]||(t[28]=e=>a.time=e),required:""},null,512),[[n["vModelText"],a.time]]),t[88]||(t[88]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Grading Instructions")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[29]||(t[29]=e=>a.instructions=e),required:""},null,512),[[n["vModelText"],a.instructions]]),a.editingQuestionId?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ic,[t[77]||(t[77]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Upload Image")],-1)),Object(n["createElementVNode"])("input",{type:"file",onChange:t[30]||(t[30]=(...e)=>l.handleImageUpload&&l.handleImageUpload(...e)),accept:"image/*"},null,32),a.imagePreview?(Object(n["openBlock"])(),Object(n["createElementBlock"])("img",{key:0,src:a.imagePreview,alt:"Preview",style:{"max-width":"100%"}},null,8,Dc)):Object(n["createCommentVNode"])("",!0)])),a.editingQuestionId&&a.imagePreview?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",qc,[t[78]||(t[78]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Attached Image:")],-1)),Object(n["createElementVNode"])("img",{src:a.imagePreview,alt:"Attached Image",style:{"max-width":"100%","max-height":"300px","margin-bottom":"10px"}},null,8,Ac)])):Object(n["createCommentVNode"])("",!0),t[89]||(t[89]=Object(n["createElementVNode"])("br",null,null,-1)),t[90]||(t[90]=Object(n["createElementVNode"])("br",null,null,-1)),t[91]||(t[91]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Save",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[31]||(t[31]=(...e)=>l.closeForm&&l.closeForm(...e))},"Close")],32)])],512),[[n["vShow"],a.showForm]]),a.showCourseEditPopup?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:2,class:"popup-overlay",onClick:t[38]||(t[38]=Object(n["withModifiers"])(e=>a.showCourseEditPopup=!1,["self"]))},[Object(n["createElementVNode"])("div",Pc,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[37]||(t[37]=Object(n["withModifiers"])((...e)=>l.saveCourseInfo&&l.saveCourseInfo(...e),["prevent"]))},[t[92]||(t[92]=Object(n["createElementVNode"])("h1",null,"Edit Course Info",-1)),t[93]||(t[93]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Course Title")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[34]||(t[34]=e=>a.editCourseTitle=e),required:""},null,512),[[n["vModelText"],a.editCourseTitle]]),t[94]||(t[94]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("b",null,"Course Number")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[35]||(t[35]=e=>a.editCourseNumber=e),required:""},null,512),[[n["vModelText"],a.editCourseNumber]]),t[95]||(t[95]=Object(n["createElementVNode"])("br",null,null,-1)),t[96]||(t[96]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Save",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[36]||(t[36]=e=>a.showCourseEditPopup=!1)},"Cancel")],32)])])):Object(n["createCommentVNode"])("",!0)])}var Mc={name:"TeacherQuestions",data(){return{courseTitle:this.$route.query.courseTitle||"Untitled Course",courseId:this.$route.query.courseId||null,textbookId:this.$route.query.textbook_id,chapter:"",section:"",question:"",reference:"",answer:"",answerChoices:"",points:"",time:"",instructions:"",image:"",imagePreview:"",selectedQuestionType:"",matchingPairs:[],questions:[],selectedQuestionId:null,editingQuestionId:null,showForm:!1,selectedTestBank:null,testBanks:[],showCourseEditPopup:!1,editCourseTitle:this.$route.query.courseTitle||"",editCourseNumber:"",showAddToTBModal:!1,questionToAddToTB:null,oldMCOptionIds:[],editBlockedPopup:!1,editBlockedReason:""}},mounted(){const e=this.$route.params.id;console.log("Viewing testbank:",e),this.loadTestbanks(),this.$route.query.testBankName&&(this.selectedTestBank={name:this.$route.query.testBankName})},methods:{openAddToTestBank(e){this.questionToAddToTB=e,this.showAddToTBModal=!0},closeAddToTBModal(){this.questionToAddToTB=null,this.showAddToTBModal=!1},async assignQuestionToTestBank(e){if(this.questionToAddToTB)try{await F.post(`/testbanks/${e}/questions`,{question_ids:[this.questionToAddToTB]},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.closeAddToTBModal()}catch(t){console.error("Failed to add question to testbank:",t)}},openCourseEditPopup(){const e=this.courseTitle.trim().split(" ");this.editCourseNumber=e.length>1?e.pop():"",this.editCourseTitle=e.join(" "),this.showCourseEditPopup=!0},async saveCourseInfo(){try{await F.patch("/courses/"+this.courseId,{course_name:this.editCourseTitle,course_number:this.editCourseNumber},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});const e=`${this.editCourseTitle} ${this.editCourseNumber}`.trim();this.courseTitle=e,document.title=e,this.showCourseEditPopup=!1}catch(e){console.error("Failed to update course:",e)}},async loadTestbanks(){try{const e=await F.get("/testbanks/teacher?course_id="+this.courseId,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.testBanks=e.data.testbanks}catch(e){console.error("Failed to load teacher testbanks:",e)}},selectTestBank(e){this.selectedTestBank=e,this.selectedTestbankId=e.value,this.$router.push({name:"TeacherViewTB",params:{id:e.testbank_id},query:{courseId:this.courseId,courseTitle:this.courseTitle,testBankId:e.testbank_id,testBankName:e.name,chapter:e.chapter_number,section:e.section_number}})},async fetchQuestions(e){this.selectedQuestionType=e;try{const t=await F.get("/questions",{headers:{Authorization:"Bearer "+localStorage.getItem("token")},params:{course_id:this.$route.query.courseId,type:e}});console.log("Questions fetched:",t.data),Array.isArray(t.data.questions)?this.questions=t.data.questions.map(e=>{const t={text:e.question_text,type:e.type,points:e.default_points,id:e.id,instructions:e.grading_instructions||"",time:e.est_time,chapter:e.chapter_number,section:e.section_number,image_url:e.attachment&&e.attachment.url?e.attachment.url:""};switch(e.type){case"True/False":return{...t,answer:e.true_false_answer};case"Multiple Choice":return{...t,correctOption:e.correct_option||null,incorrectOptions:e.incorrect_options||[]};case"Matching":return{...t,pairs:(e.matches||[]).map(e=>({match_id:e.match_id,term:e.prompt_text,definition:e.match_text}))};case"Fill in the Blank":return{...t,blanks:e.blanks||[],instructions:e.grading_instructions||""};case"Short Answer":return{...t,answer:e.answer||""};case"Essay":return{...t,instructions:e.instructions||""};default:return t}}):this.questions=[]}catch(t){console.error("Error fetching questions:",t),this.questions=[]}},displayQuestionType(e){this.selectedQuestionType="Selected Question Type: "+e},created(){console.log("Query Parameters:",this.$route.query)},importTest(){document.getElementById("fileInput").click()},async handleFileUpload(e){const t=e.target.files[0];if(!t)return void alert("No file selected.");const o=new FormData;o.append("file",t);try{const e=await F.post("/qti/upload",o,{headers:{Authorization:"Bearer "+localStorage.getItem("token"),"Content-Type":"multipart/form-data"}}),t=e.data.file_path;console.log("File uploaded successfully:",t);const n=await F.post("/qti/import",{file_path:t},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),c=n.data.import_id;console.log("QTI import created. Import ID:",c);const a=await F.post("qti/save/"+c,{course_id:this.courseId},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Questions imported successfully:",a.data),this.fetchQuestions(this.selectedQuestionType)}catch(n){console.error("QTI import Failed:",n)}},async handleQuestionSave(){try{let e,t;const o=this.questions.find(e=>e.id===this.editingQuestionId),n=!!this.editingQuestionId,c={question_text:this.question,default_points:parseInt(this.points),est_time:parseInt(this.time),chapter_number:this.chapter,section_number:this.section,grading_instructions:this.instructions,type:this.selectedQuestionType,source:"manual",course_id:this.courseId};let a=[];if("Multiple Choice"===this.selectedQuestionType){const e=this.answerChoices.split(",").map(e=>e.trim()).filter(Boolean),t=this.answer.trim();if(!t)return void alert("Correct answer cannot be empty.");if(a.push({option_text:t,is_correct:!0}),e.forEach(e=>{a.push({option_text:e,is_correct:!1})}),!a.some(e=>e.is_correct))return void alert("Multiple Choice questions must have at least one correct answer.")}if(this.image){e=new FormData,e.append("file",this.image);for(const[t,o]of Object.entries(c))e.append(t,o);switch(this.selectedQuestionType){case"True/False":e.append("true_false_answer","True"===this.answer);break;case"Multiple Choice":e.append("options",JSON.stringify(a)),n&&this.oldMCOptionIds.length>0&&e.append("to_delete",JSON.stringify(this.oldMCOptionIds));break;case"Matching":if(e.append("matches",JSON.stringify(this.matchingPairs.map(e=>({prompt_text:e.term,match_text:e.definition})))),n&&o){const t=(o.pairs||[]).map(e=>e.match_id);e.append("to_delete",JSON.stringify(t))}break;case"Fill in the Blank":if(e.append("blanks",JSON.stringify([{correct_text:this.answer}])),n&&o){const t=(o.blanks||[]).map(e=>e.blank_id);e.append("to_delete",JSON.stringify(t))}break;case"Short Answer":e.append("answer",this.answer);break;case"Essay":e.append("grading_instructions",this.instructions);break}t={headers:{Authorization:"Bearer "+localStorage.getItem("token"),"Content-Type":"multipart/form-data"}}}else{switch(e={...c},this.selectedQuestionType){case"True/False":e.true_false_answer="True"===this.answer;break;case"Multiple Choice":e.options=a,n&&this.oldMCOptionIds.length>0&&(e.to_delete=this.oldMCOptionIds);break;case"Matching":if(e.matches=this.matchingPairs.map(e=>({prompt_text:e.term,match_text:e.definition})),n&&o){const t=(o.pairs||[]).map(e=>e.match_id);e.to_delete=t}break;case"Fill in the Blank":if(e.blanks=[{correct_text:this.answer}],n&&o){const t=(o.blanks||[]).map(e=>e.blank_id);e.to_delete=t}break;case"Short Answer":e.answer=this.answer;break;case"Essay":e.grading_instructions=this.instructions;break}t={headers:{Authorization:"Bearer "+localStorage.getItem("token")}}}n?await F.patch("/questions/"+this.editingQuestionId,e,t):await F.post("/questions",e,t),this.closeForm(),this.resetForm(),this.fetchQuestions(this.selectedQuestionType)}catch(e){let t="Something went wrong.";e&&e.response&&e.response.data&&(t=e.response.data.error||e.response.data.message||t),console.error("Error saving question:",e)}},selectQuestionType(e){this.selectedQuestionType="Selected Question Type: "+e,this.fetchQuestions(e)},edit(){this.resetForm(),this.showForm=!0},closeForm(){this.showForm=!1},addPair(){this.matchingPairs.push({term:"",definition:""})},removePair(e){this.matchingPairs.splice(e,1)},handleImageUpload(e){const t=e.target.files[0];if(t){this.image=t;const e=new FileReader;e.onload=e=>{this.imagePreview=e.target.result},e.readAsDataURL(t)}},resetForm(){this.chapter="",this.section="",this.question="",this.reference="",this.answer="",this.answerChoices="",this.points="",this.time="",this.instructions="",this.image="",this.imagePreview="",this.matchingPairs=[],this.selectedQuestionType="",this.editingQuestionId=null,this.image="",this.imagePreview=""},async editQuestion(e){try{const t=await F.get(`/questions/${e.id}/used_in`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(t.data.is_used)return this.editBlockedReason=`This question is used in a "${t.data.tests[0].status}" test: "${t.data.tests[0].name}".`,this.editingQuestionId=e.id,void(this.editBlockedPopup=!0)}catch(o){return console.error("Error checking question status:",o),void alert("Could not verify question status.")}this.editingQuestionId=e.id,this.question=e.text,this.chapter=e.chapter,this.section=e.section,this.points=e.points,this.time=e.time,this.instructions=e.instructions,this.answer=e.answer||"",this.selectedQuestionType=e.type,"Multiple Choice"===e.type?(this.answer=e.correctOption&&e.correctOption.option_text||"",this.answerChoices=(e.incorrectOptions||[]).map(e=>e.option_text).join(", "),this.oldMCOptionIds=[],e.correctOption&&e.correctOption.option_id&&this.oldMCOptionIds.push(e.correctOption.option_id),Array.isArray(e.incorrectOptions)&&e.incorrectOptions.forEach(e=>{e.option_id&&this.oldMCOptionIds.push(e.option_id)})):"Matching"===e.type&&(this.matchingPairs=(e.pairs||[]).map(e=>({term:e.term,definition:e.definition}))),this.imagePreview=e.image_url||"",this.image=null,this.showForm=!0;const t=document.getElementById("q_edit");t&&t.style&&(t.style.display="block")},toggleQuestionSelection(e){this.selectedQuestionId=this.selectedQuestionId===e?null:e},async deleteQuestion(e){if(confirm("Are you sure you want to delete this question?"))try{await F.delete("/questions/"+e,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.questions=this.questions.filter(t=>t.id!==e)}catch(t){console.error(t)}},async createCopyInstead(){try{await F.post(`/questions/${this.editingQuestionId}/copy_to_course`,{course_id:this.courseId},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});alert("A copy of the question was created. You can now edit it."),this.editBlockedPopup=!1,this.fetchQuestions(this.selectedQuestionType)}catch(e){console.error("Failed to create copy:",e),alert("Failed to create a copy of this question.")}}}};o("72a1");const Lc=r()(Mc,[["render",Qc],["__scopeId","data-v-49af96ac"]]);var $c=Lc;const zc={class:"theme-teacher"},Uc={class:"top-banner"},Rc={class:"banner-title"},Hc={class:"t_banner-actions"},Wc={class:"button-row"},Gc={class:"export-note"},Jc={class:"export-note"},Kc={class:"form-popup-modal"},Yc={class:"form-container"},Xc={class:"popup-button-group"},Zc={class:"form-popup-modal"},ea={class:"form-container"},ta={style:{display:"flex","justify-content":"center",gap:"10px","margin-top":"20px"}},oa={class:"form-popup-modal"},na={class:"form-container"},ca={style:{display:"flex","justify-content":"center",gap:"10px","margin-top":"20px"}},aa={class:"question-list-container"},la={class:"question-box"},sa={class:"drag-header"},ra={key:0,class:"question-image-preview"},ia=["src"],da={key:1},ba={type:"A"},ua={class:"question-type-label"},ma={key:2},pa={class:"correct-answer-display"},ha={class:"question-type-label"},Oa={key:3},ja={class:"matching-container"},ka={class:"matching-prompts"},ga={class:"matching-answers"},Na={class:"matching-footer"},Ea={class:"correct-answer-display"},ya={class:"question-type-label"},Va={key:4},fa={class:"correct-answer-display"},wa={class:"question-type-label"},Ba={key:5},va={class:"correct-answer-display"},Ta={class:"question-type-label"},_a={key:6};function xa(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link"),r=Object(n["resolveComponent"])("draggable");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",zc,[Object(n["createElementVNode"])("div",Uc,[Object(n["createElementVNode"])("div",Rc,Object(n["toDisplayString"])(a.testOptions.testName||"Test Template"),1),Object(n["createElementVNode"])("div",Hc,[Object(n["createVNode"])(s,{to:"/TeacherHome",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[13]||(t[13]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[14]||(t[14]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",Wc,[Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[0]||(t[0]=e=>a.publishWarning=!0)},"Publish Final Test"),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[1]||(t[1]=e=>a.showBackWarning=!0)},"Back to Draft Pool"),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[2]||(t[2]=e=>a.exportWarning=!0)},"Export Test to Document")]),t[30]||(t[30]=Object(n["createStaticVNode"])('<p class="export-note" data-v-7c885d9a><strong data-v-7c885d9a>Note:</strong> Only the most recently <strong data-v-7c885d9a>Exported</strong> test document will be published. You <strong data-v-7c885d9a>must</strong> export a test once to publish.<br data-v-7c885d9a></p><p class="export-note" data-v-7c885d9a><strong data-v-7c885d9a>Note:</strong> Anything displayed in <span class="green-text" data-v-7c885d9a>green</span> will not appear on the student test but will be included in the test key. <br data-v-7c885d9a> If selected, a cover page and any uploaded graphic will be added automatically to the exported document. </p>',2)),Object(n["createElementVNode"])("p",Gc,[t[15]||(t[15]=Object(n["createElementVNode"])("strong",null,"Total Test Time:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(l.totalEstimatedTime)+" minutes ",1)]),Object(n["createElementVNode"])("p",Jc,[t[16]||(t[16]=Object(n["createElementVNode"])("strong",null,"Total Points:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(l.totalPoints)+" points ",1)]),t[31]||(t[31]=Object(n["createElementVNode"])("hr",null,null,-1)),a.showBackWarning?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:0,class:"popup-overlay",onClick:t[5]||(t[5]=Object(n["withModifiers"])(e=>a.showBackWarning=!1,["self"]))},[Object(n["createElementVNode"])("div",Kc,[Object(n["createElementVNode"])("div",Yc,[t[17]||(t[17]=Object(n["createElementVNode"])("h2",{style:{"text-align":"center"}},"Warning",-1)),t[18]||(t[18]=Object(n["createElementVNode"])("p",{style:{"text-align":"center","font-size":"18px"}}," If you go back to the Draft Pool, any unsaved changes on this page may be lost. ",-1)),Object(n["createElementVNode"])("div",Xc,[Object(n["createElementVNode"])("button",{class:"btn",onClick:t[3]||(t[3]=(...e)=>l.confirmBack&&l.confirmBack(...e))},"Continue"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[4]||(t[4]=e=>a.showBackWarning=!1)},"Cancel")])])])])):Object(n["createCommentVNode"])("",!0),a.publishWarning?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:1,class:"popup-overlay",onClick:t[8]||(t[8]=Object(n["withModifiers"])(e=>a.publishWarning=!1,["self"]))},[Object(n["createElementVNode"])("div",Zc,[Object(n["createElementVNode"])("div",ea,[t[19]||(t[19]=Object(n["createElementVNode"])("h2",{style:{"text-align":"center"}},"Confirm Publish",-1)),t[20]||(t[20]=Object(n["createElementVNode"])("p",{style:{"text-align":"center","font-size":"18px"}}," Once you publish this test, the questions on this page will no longer be editable. Are you sure you want to continue? ",-1)),Object(n["createElementVNode"])("div",ta,[Object(n["createElementVNode"])("button",{class:"btn",onClick:t[6]||(t[6]=(...e)=>l.confirmPublish&&l.confirmPublish(...e))},"Yes, Publish"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[7]||(t[7]=e=>a.publishWarning=!1)},"Cancel")])])])])):Object(n["createCommentVNode"])("",!0),a.exportWarning?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:2,class:"popup-overlay",onClick:t[11]||(t[11]=Object(n["withModifiers"])(e=>a.exportWarning=!1,["self"]))},[Object(n["createElementVNode"])("div",oa,[Object(n["createElementVNode"])("div",na,[t[21]||(t[21]=Object(n["createElementVNode"])("h2",{style:{"text-align":"center"}},"Confirm Export",-1)),t[22]||(t[22]=Object(n["createElementVNode"])("p",{style:{"text-align":"center","font-size":"18px"}}," Exporting will generate a Word document based on the current test setup. Any unsaved changes will not be included. Continue? ",-1)),Object(n["createElementVNode"])("div",ca,[Object(n["createElementVNode"])("button",{class:"btn",onClick:t[9]||(t[9]=(...e)=>l.confirmExport&&l.confirmExport(...e))},"Yes, Export"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[10]||(t[10]=e=>a.exportWarning=!1)},"Cancel")])])])])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",aa,[Object(n["createVNode"])(r,{modelValue:a.questions,"onUpdate:modelValue":t[12]||(t[12]=e=>a.questions=e),"item-key":"id",class:"drag-list",handle:".drag-handle",onUpdate:l.saveOrder},{header:Object(n["withCtx"])(()=>t[23]||(t[23]=[])),item:Object(n["withCtx"])(({element:e,index:o})=>[Object(n["createElementVNode"])("div",la,[Object(n["createElementVNode"])("div",sa,[t[24]||(t[24]=Object(n["createElementVNode"])("span",{class:"drag-handle",title:"Drag to reorder"},"✥",-1)),Object(n["createElementVNode"])("h3",null,Object(n["toDisplayString"])(o+1)+". "+Object(n["toDisplayString"])(e.question_text),1)]),e.attachment&&e.attachment.url?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ra,[Object(n["createElementVNode"])("img",{src:e.attachment.url,alt:"Question Image",style:{"max-width":"100%","max-height":"300px","margin-top":"10px","margin-bottom":"10px"}},null,8,ia)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",da,[Object(n["createElementVNode"])("ol",ba,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.shuffleOptions(e),(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:e.option_id||t,class:Object(n["normalizeClass"])({"correct-answer":e.is_correct})},Object(n["toDisplayString"])(e.option_text),3))),128))]),Object(n["createElementVNode"])("div",ua,Object(n["toDisplayString"])(e.type),1)])):"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ma,[t[25]||(t[25]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Answer:"),Object(n["createTextVNode"])(" __________________________")],-1)),Object(n["createElementVNode"])("p",pa," Correct Answer: "+Object(n["toDisplayString"])(e.blanks.map(e=>e.correct_text).join(", ")),1),Object(n["createElementVNode"])("div",ha,Object(n["toDisplayString"])(e.type),1)])):"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Oa,[Object(n["createElementVNode"])("div",ja,[Object(n["createElementVNode"])("div",ka,[t[26]||(t[26]=Object(n["createElementVNode"])("h4",null,"Match the following:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.getShuffledMatches(e),(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(t+1)+". "+Object(n["toDisplayString"])(e.prompt_text),1))),128))])]),Object(n["createElementVNode"])("div",ga,[t[27]||(t[27]=Object(n["createElementVNode"])("h4",null,"Answer Bank:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(l.getShuffledAnswerBank(e),(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(String.fromCharCode(65+t))+". "+Object(n["toDisplayString"])(e),1))),128))])])]),Object(n["createElementVNode"])("div",Na,[Object(n["createElementVNode"])("p",Ea," Correct Matches: "+Object(n["toDisplayString"])(l.getMatchingKeyString(e)),1),Object(n["createElementVNode"])("div",ya,Object(n["toDisplayString"])(e.type),1)])])):"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Va,[t[28]||(t[28]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Answer:"),Object(n["createTextVNode"])(" __________________________")],-1)),Object(n["createElementVNode"])("p",fa," Correct Answer: "+Object(n["toDisplayString"])(e.true_false_answer?"True":"False"),1),Object(n["createElementVNode"])("div",wa,Object(n["toDisplayString"])(e.type),1)])):"Short Answer"===e.type||"Essay"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ba,[Object(n["createElementVNode"])("p",va," Grading Instructions: "+Object(n["toDisplayString"])(e.grading_instructions||"None provided"),1),Object(n["createElementVNode"])("div",Ta,Object(n["toDisplayString"])(e.type),1)])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",_a,[Object(n["createElementVNode"])("em",null,"Type: "+Object(n["toDisplayString"])(e.type),1)]))])]),footer:Object(n["withCtx"])(()=>t[29]||(t[29]=[])),_:1},8,["modelValue","onUpdate"])])])}var Ca=o("b76a"),Sa=o.n(Ca),Fa=o("21a6"),Ia={components:{draggable:Sa.a},data(){const e=JSON.parse(localStorage.getItem("testOptions")||"{}");return{questions:[],testOptions:{testName:e.testName||this.$route.query.testBankName||"Test Template",coverPage:e.coverPage||!1,selectedTemplate:e.selectedTemplate||"All Questions",uploadedImage:e.uploadedImage||"",graphicPreview:e.graphicPreview||""},testBankId:this.$route.query.testBankId,showBackWarning:!1,hasUnsavedChanges:!0,publishWarning:!1,exportWarning:!1}},mounted(){this.fetchQuestions(),window.addEventListener("beforeunload",this.confirmExit)},beforeDestroy(){window.removeEventListener("beforeunload",this.confirmExit)},watch:{questions:{deep:!0,handler(e){const t=e.map(e=>e.id);localStorage.setItem("questionOrder_"+this.testBankId,JSON.stringify(t))}}},computed:{totalEstimatedTime(){return this.questions.reduce((e,t)=>{const o=parseInt(t.est_time,10);return e+(isNaN(o)?0:o)},0)},totalPoints(){return this.questions.reduce((e,t)=>{const o=parseFloat(t.default_points);return e+(isNaN(o)?0:o)},0)}},methods:{blobToFile(e,t){return new File([e],t,{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"})},async uploadAnswerKey(e,t){const o=new FormData;o.append("file",t);try{const t=await F.post(`/tests/${e}/upload_answer_key`,o,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+localStorage.getItem("token")}});console.log("✅ Answer key uploaded:",t.data)}catch(n){console.error("❌ Failed to upload answer key:",n),alert("The answer key could not be saved to the backend.")}},async publishTest(){try{const e=localStorage.getItem("finalizedTestId");if(!e)return void alert("❌ No finalized test found. Please export the test first.");await F.post(`/tests/${e}/publish`,{},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),alert("✅ Test successfully published!"),localStorage.removeItem("finalizedTestId")}catch(e){console.error("❌ Failed to publish test:",e.response&&e.response.data||e.message),alert("An error occurred while publishing. Check the console.")}},async finalizeTestBeforeExport(){try{const e=this.testOptions.selectedTemplate||"All Questions",t={test_bank_id:parseInt(this.testBankId),name:this.testOptions.testName,estimated_time:this.totalEstimatedTime>0?this.totalEstimatedTime:1,test_instructions:"",course_id:parseInt(this.$route.query.courseId),type:e};"All Questions"!==e&&(t.question_ids=this.questions.map(e=>e.id)),console.log("🟡 Finalizing test with payload:",t);const o=await F.post("/tests/finalize",t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});if(201===o.status){const e=o.data.test_id;return{testId:e,questionCount:o.data.question_count}}throw new Error("Finalize test failed with non-201 response")}catch(e){throw console.error("❌ Finalize error:",e.response&&e.response.data||e.message),alert("Failed to finalize test. See console for details."),e}},dataUrlToFile(e,t){const o=e.split(","),n=o[0].match(/:(.*?);/)[1],c=atob(o[1]);let a=c.length;const l=new Uint8Array(a);while(a--)l[a]=c.charCodeAt(a);return new File([l],t,{type:n})},async confirmExport(){this.exportWarning=!1;try{const e=await this.finalizeTestBeforeExport(),t=e.testId;localStorage.setItem("finalizedTestId",t),await this.exportToWord(e)}catch(e){console.error("Export canceled due to finalize error")}},confirmPublish(){this.publishWarning=!1,this.publishTest()},confirmExit(e){this.hasUnsavedChanges&&(e.preventDefault(),e.returnValue="")},confirmBack(){this.showBackWarning=!1,this.goBackTB()},goBackTB(){this.$router.push({path:"/TeacherViewTB",query:{courseId:this.$route.query.courseId,courseTitle:this.$route.query.courseTitle,testBankId:this.testBankId,testBankName:this.$route.query.testBankName}})},async fetchQuestions(){try{const e=await F.get("/tests/draft-questions",{params:{test_bank_id:this.testBankId,type:this.testOptions.selectedTemplate||"All Questions"},headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),t=e.data.questions||[],o=localStorage.getItem("questionOrder_"+this.testBankId);if(o){const e=JSON.parse(o),n=new Map(t.map(e=>[e.id,e])),c=e.map(e=>n.get(e)).filter(Boolean);t.forEach(t=>{e.includes(t.id)||c.push(t)}),this.questions=c}else this.questions=t}catch(e){console.error("Failed to fetch questions:",e)}},saveOrder(){const e=this.questions.map(e=>e.id);localStorage.setItem("questionOrder_"+this.testBankId,JSON.stringify(e))},shuffleOptions(e){const t=[...e.incorrect_options,e.correct_option].map(e=>({...e,is_correct:!!e.is_correct}));for(let o=t.length-1;o>0;o--){const e=Math.floor(Math.random()*(o+1));[t[o],t[e]]=[t[e],t[o]]}return t},shuffleArray(e){const t=[...e];for(let o=t.length-1;o>0;o--){const e=Math.floor(Math.random()*(o+1));[t[o],t[e]]=[t[e],t[o]]}return t},getShuffledBlanks(e){return this.shuffleArray(e.blanks||[])},getShuffledMatches(e){const t=e.matches||[],o=t.map(e=>e.prompt_text),n=this.getShuffledAnswerBank(e);return o.map((e,t)=>({prompt_text:e,match_text:n[t]}))},getShuffledAnswerBank(e){if(!e._shuffledAnswers){const t=e.matches||[],o=this.shuffleArray(t.map(e=>e.match_text));e._shuffledAnswers=o}return e._shuffledAnswers},getMatchingKeyString(e){const t=this.getShuffledAnswerBank(e);return(e.matches||[]).map((e,o)=>{const n=t.findIndex(t=>t===e.match_text);return`${o+1} → ${String.fromCharCode(65+n)}`}).join(", ")},async exportToWord(e){const t=this.questions.reduce((e,t)=>{const o=parseFloat(t.default_points);return e+(isNaN(o)?0:o)},0),n=this.questions.reduce((e,t)=>{const o=parseInt(t.est_time,10);return e+(isNaN(o)?0:o)},0),c=e&&e.questionCount?e.questionCount:t,a=this.totalEstimatedTime||n,{Document:l,Packer:s,Paragraph:r,TextRun:i,ImageRun:d,Table:b,TableRow:u,TableCell:m,HeadingLevel:p,AlignmentType:h,BorderStyle:O,ThematicBreak:j,WidthType:k}=await o.e("chunk-2d0d6e77").then(o.bind(null,"7514")),g=()=>new r(new j),N=new r({children:[],pageBreakBefore:!0}),E=()=>{const e=[new r({text:this.testOptions.testName,heading:p.TITLE,alignment:h.CENTER,spacing:{after:200}}),new r({text:"Version: XXXX",heading:p.HEADING_1,alignment:h.CENTER,spacing:{after:200}}),new r({text:"Name: __________________________",spacing:{after:400}}),new r({text:"Date: __________________________",spacing:{after:400}}),new r({text:"Course: "+(this.$route.query.courseTitle||"N/A")}),new r({text:"Time Allowed: "+(this.totalEstimatedTime||"N/A")+" minutes",spacing:{after:400}}),g(),new r({text:"Instructions:",heading:p.HEADING_2,spacing:{after:100}}),...[`This exam is worth ${c} points.`,`You have ${a||"N/A"} minutes to complete the exam.`,"Read each question carefully.","Be sure to answer all questions, do not leave anything blank.","Turn in all work and scratch paper with your exam.","You may not use any external materials unless permitted by the instructor.","This exam is closed-book, closed-notes, and no external devices or help.","Check your work before submitting."].map(e=>new r({text:e,bullet:{level:0},spacing:{after:100}})),N];return e},y=async()=>{const e=[new r({text:this.testOptions.testName+" - Version: XXXX",heading:p.HEADING_1,spacing:{after:300}}),new r({text:"Name: __________________________",spacing:{after:400}}),g()];for(let o=0;o<this.questions.length;o++){const n=this.questions[o];if(n.attachment&&n.attachment.url)try{const t=await fetch(n.attachment.url),o=await t.arrayBuffer(),c=new Uint8Array(o);e.push(new r({children:[new d({data:c,transformation:{width:500,height:300}})],spacing:{after:100}}))}catch(t){console.warn(`⚠ Failed to fetch image for question ${o+1}:`,t)}if(e.push(new r({text:`${o+1}. ${n.question_text}`,spacing:{after:200}})),"Multiple Choice"===n.type){const t=this.shuffleOptions(n);t.forEach((t,o)=>{e.push(new r({text:`${String.fromCharCode(65+o)}. ${t.option_text}`,indent:{left:720},spacing:{after:100}}))})}else if("True/False"===n.type)e.push(new r("True/False: __________________________"));else if("Fill in the Blank"===n.type)e.push(new r("Blank: _____________________"));else if("Short Answer"===n.type)for(let t=0;t<15;t++)e.push(new r(" "));else if("Essay"===n.type)for(let t=0;t<30;t++)e.push(new r(" "));else if("Matching"===n.type){e.push(new r({spacing:{after:200}}));const t=this.getShuffledMatches(n),o=(this.getShuffledAnswerBank(n),t.map((e,t)=>{const o=`${t+1}. ${e.prompt_text}`,n=`${String.fromCharCode(65+t)}. ${e.match_text}`;return new u({children:[new m({width:{size:50,type:k.PERCENTAGE},children:[new r({text:o,spacing:{after:150}})],margins:{top:100,bottom:100}}),new m({width:{size:50,type:k.PERCENTAGE},children:[new r({text:n,spacing:{after:150}})],margins:{top:100,bottom:100}})]})}));e.push(new b({rows:o,width:{size:100,type:k.PERCENTAGE},borders:{top:{style:O.NONE,size:0,color:"FFFFFF"},bottom:{style:O.NONE,size:0,color:"FFFFFF"},left:{style:O.NONE,size:0,color:"FFFFFF"},right:{style:O.NONE,size:0,color:"FFFFFF"},insideHorizontal:{style:O.NONE,size:0,color:"FFFFFF"},insideVertical:{style:O.NONE,size:0,color:"FFFFFF"}}})),e.push(new r({text:" ",spacing:{after:300}}))}e.push(new r({text:" ",spacing:{after:300}}))}return e},V=()=>{const e=[new r({children:[new i({text:this.testOptions.testName+" - Test Key",bold:!0,size:32,color:"FF0000"})],spacing:{after:300}})];return this.questions.forEach((t,o)=>{let n="";if("Multiple Choice"===t.type){const e=this.shuffleOptions(t),o=e.findIndex(e=>e.is_correct);n=`Correct Answer: ${String.fromCharCode(65+o)}. ${e[o].option_text}`}else"True/False"===t.type?n="Correct Answer: "+(t.true_false_answer?"True":"False"):"Fill in the Blank"===t.type?n="Correct Answer: "+t.blanks.map(e=>e.correct_text).join(", "):"Short Answer"===t.type||"Essay"===t.type?n="Grading Instructions: "+(t.grading_instructions||"None"):"Matching"===t.type&&(n="Correct Matches: "+this.getMatchingKeyString(t));e.push(new r({text:`${o+1}. ${t.question_text}`,spacing:{after:100}}),new r({children:[new i({text:n,color:"FF0000"})],spacing:{after:300}}))}),e},f=async()=>{const e=[];if(this.testOptions.graphicPreview)try{const t=this.testOptions.graphicPreview.split(",")[1],o=window.atob(t),n=new Uint8Array(o.length);for(let e=0;e<o.length;e++)n[e]=o.charCodeAt(e);e.push(new r({children:[],pageBreakBefore:!0}),new r({text:"Resource Page",heading:p.HEADING_1,spacing:{after:300}}),new r({children:[new d({data:n,transformation:{width:500,height:300}})],spacing:{after:300}}))}catch(t){console.error("⚠ Failed to load image for resource page:",t),e.push(new r("⚠ Could not load the uploaded image."))}return e},w=await f(),B=new l({sections:[{properties:{},children:[...E(),...await y(),...w]}],styles:{default:{document:{run:{font:"Arial",size:24}}}}}),v=new l({sections:[{properties:{},children:V()}],styles:{default:{document:{run:{font:"Arial",size:24}}}}}),[T,_]=await Promise.all([s.toBlob(B),s.toBlob(v)]),x=this.blobToFile(T,(this.testOptions.testName||"GeneratedTest")+".docx"),C=this.blobToFile(_,(this.testOptions.testName||"TestKey")+".key.docx"),S=e.testId;try{const e=new FormData;e.append("file",x),await F.post(`/tests/${S}/upload_pdf`,e,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+localStorage.getItem("token")}}),await this.uploadAnswerKey(S,C)}catch(I){console.error("❌ Upload failed:",I),alert("Failed to upload test or answer key.")}Object(Fa["saveAs"])(T,(this.testOptions.testName||"GeneratedTest")+".docx"),Object(Fa["saveAs"])(_,(this.testOptions.testName||"TestKey")+".key.docx")}}};o("4abc");const Da=r()(Ia,[["render",xa],["__scopeId","data-v-7c885d9a"]]);var qa=Da;const Aa={class:"theme-teacher"},Pa={class:"top-banner"},Qa={class:"banner-title"},Ma={style:{"font-size":"16px",color:"#222"}},La={class:"t_banner-actions"},$a={class:"center large-paragraph",style:{color:"#222"}},za={class:"button-row"},Ua={class:"form-popup-modal"},Ra={class:"form-container"},Ha={class:"popup-button-group"},Wa={class:"form-popup-modal"},Ga={class:"form-container"},Ja={style:{"text-align":"center"}},Ka={class:"popup-button-group",style:{"text-align":"center","margin-top":"1rem"}},Ya={key:2,class:"popup-overlay"},Xa={class:"form-popup-modal"},Za={class:"form-popup-modal"},el={class:"checkbox-label"},tl={class:"button-group"},ol={key:0,style:{"margin-top":"10px"}},nl=["src"],cl=["onClick"],al={key:0},ll={key:1},sl={key:2},rl={key:3},il={key:4},dl={key:5},bl={key:6},ul=["src"],ml={key:7,class:"button-group"},pl=["onClick"];function hl(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Aa,[Object(n["createElementVNode"])("div",Pa,[Object(n["createElementVNode"])("div",Qa,[Object(n["createTextVNode"])("Test Draft: "+Object(n["toDisplayString"])(a.testBankName),1),t[21]||(t[21]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",Ma," Chapter "+Object(n["toDisplayString"])(l.displayChapter||"N/A")+", Section "+Object(n["toDisplayString"])(l.displaySection||"N/A"),1)]),Object(n["createElementVNode"])("div",La,[Object(n["createVNode"])(s,{to:"/TeacherHome",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[22]||(t[22]=[Object(n["createTextVNode"])("Home")])),_:1}),Object(n["createVNode"])(s,{to:"/",class:"t_banner-btn"},{default:Object(n["withCtx"])(()=>t[23]||(t[23]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",$a,[Object(n["createVNode"])(s,{to:{path:"/TeacherQuestions",query:{courseTitle:a.courseTitle,courseId:a.courseId}}},{default:Object(n["withCtx"])(()=>t[24]||(t[24]=[Object(n["createElementVNode"])("button",{class:"t_button"},"Return to Question Page",-1)])),_:1},8,["to"]),t[60]||(t[60]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("div",za,[Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[0]||(t[0]=e=>a.showEditForm=!0)},"Edit Draft Pool Info"),Object(n["createElementVNode"])("button",{class:"t_button",onClick:t[1]||(t[1]=e=>a.showCreateTestWarning=!0)},"Create New Test"),t[25]||(t[25]=Object(n["createElementVNode"])("br",null,null,-1))]),t[61]||(t[61]=Object(n["createElementVNode"])("hr",null,null,-1)),a.showDeleteConfirm?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:0,class:"popup-overlay",onClick:t[4]||(t[4]=Object(n["withModifiers"])(e=>a.showDeleteConfirm=!1,["self"]))},[Object(n["createElementVNode"])("div",Ua,[Object(n["createElementVNode"])("div",Ra,[t[26]||(t[26]=Object(n["createElementVNode"])("h2",{style:{"text-align":"center"}},"Confirm Removal",-1)),t[27]||(t[27]=Object(n["createElementVNode"])("p",{style:{"text-align":"center"}},"Are you sure you want to remove this question from the test bank?",-1)),Object(n["createElementVNode"])("div",Ha,[Object(n["createElementVNode"])("button",{class:"btn",onClick:t[2]||(t[2]=(...e)=>l.confirmRemoveQuestion&&l.confirmRemoveQuestion(...e))},"Yes, Remove"),Object(n["createElementVNode"])("button",{class:"btn cancel",onClick:t[3]||(t[3]=e=>a.showDeleteConfirm=!1)},"Cancel")])])])])):Object(n["createCommentVNode"])("",!0),a.showInfoPopup?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:1,class:"popup-overlay",onClick:t[6]||(t[6]=Object(n["withModifiers"])(e=>a.showInfoPopup=!1,["self"]))},[Object(n["createElementVNode"])("div",Wa,[Object(n["createElementVNode"])("div",Ga,[Object(n["createElementVNode"])("p",Ja,Object(n["toDisplayString"])(a.popupMessage),1),Object(n["createElementVNode"])("div",Ka,[Object(n["createElementVNode"])("button",{class:"btn",onClick:t[5]||(t[5]=e=>a.showInfoPopup=!1)},"OK")])])])])):Object(n["createCommentVNode"])("",!0),a.showEditForm?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ya,[Object(n["createElementVNode"])("div",Xa,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[11]||(t[11]=Object(n["withModifiers"])((...e)=>l.updateTestBank&&l.updateTestBank(...e),["prevent"]))},[t[28]||(t[28]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Draft Pool Name:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=e=>a.editForm.name=e),required:""},null,512),[[n["vModelText"],a.editForm.name]]),t[29]||(t[29]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Chapter Number:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=e=>a.editForm.chapter=e),required:""},null,512),[[n["vModelText"],a.editForm.chapter]]),t[30]||(t[30]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Section Number:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>a.editForm.section=e),required:""},null,512),[[n["vModelText"],a.editForm.section]]),t[31]||(t[31]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Save Changes",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[10]||(t[10]=e=>a.showEditForm=!1)},"Cancel")],32)])])):Object(n["createCommentVNode"])("",!0),a.showCreateTestWarning?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:3,class:"popup-overlay",onClick:t[20]||(t[20]=Object(n["withModifiers"])(e=>a.showCreateTestWarning=!1,["self"]))},[Object(n["createElementVNode"])("div",Za,[Object(n["createElementVNode"])("form",{class:"form-container",onSubmit:t[19]||(t[19]=Object(n["withModifiers"])((...e)=>l.goToCreateTest&&l.goToCreateTest(...e),["prevent"]))},[t[34]||(t[34]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Test Name:")],-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>a.testOptions.testName=e),placeholder:"Enter a name for this test",required:""},null,512),[[n["vModelText"],a.testOptions.testName]]),Object(n["createElementVNode"])("label",el,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"checkbox","onUpdate:modelValue":t[13]||(t[13]=e=>a.testOptions.coverPage=e)},null,512),[[n["vModelCheckbox"],a.testOptions.coverPage]]),t[32]||(t[32]=Object(n["createTextVNode"])(" Add a cover page "))]),t[35]||(t[35]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Select Template:")],-1)),Object(n["createElementVNode"])("div",tl,[Object(n["createElementVNode"])("button",{type:"button",class:Object(n["normalizeClass"])({active:"All Questions"===a.testOptions.selectedTemplate}),onClick:t[14]||(t[14]=e=>a.testOptions.selectedTemplate="All Questions")}," All Questions ",2),Object(n["createElementVNode"])("button",{type:"button",class:Object(n["normalizeClass"])({active:"Multiple Choice"===a.testOptions.selectedTemplate}),onClick:t[15]||(t[15]=e=>a.testOptions.selectedTemplate="Multiple Choice")}," Multiple Choice ",2),Object(n["createElementVNode"])("button",{type:"button",class:Object(n["normalizeClass"])({active:"Short Answer/Essay"===a.testOptions.selectedTemplate}),onClick:t[16]||(t[16]=e=>a.testOptions.selectedTemplate="Short Answer/Essay")}," Short Answer/Essay ",2)]),t[36]||(t[36]=Object(n["createElementVNode"])("label",null,[Object(n["createElementVNode"])("strong",null,"Embedded Graphic:")],-1)),Object(n["createElementVNode"])("input",{type:"file",accept:"image/*",onChange:t[17]||(t[17]=(...e)=>l.handleGraphicUpload&&l.handleGraphicUpload(...e))},null,32),a.testOptions.graphicPreview?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ol,[t[33]||(t[33]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Preview:")],-1)),Object(n["createElementVNode"])("img",{src:a.testOptions.graphicPreview,alt:"Uploaded Graphic Preview",style:{"max-width":"100%","max-height":"200px",border:"1px solid #ccc"}},null,8,nl)])):Object(n["createCommentVNode"])("",!0),t[37]||(t[37]=Object(n["createElementVNode"])("button",{type:"submit",class:"btn"},"Yes, Continue",-1)),Object(n["createElementVNode"])("button",{type:"button",class:"btn cancel",onClick:t[18]||(t[18]=e=>a.showCreateTestWarning=!1)},"Cancel")],32)])])):Object(n["createCommentVNode"])("",!0),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(a.selectedQuestions,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.id,class:Object(n["normalizeClass"])(["question-box",{selected:a.selectedQuestionId===e.id}]),onClick:t=>l.toggleQuestionSelection(e.id)},[Object(n["createElementVNode"])("strong",null,"Question "+Object(n["toDisplayString"])(o+1)+":",1),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.question_text),1),t[53]||(t[53]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[38]||(t[38]=Object(n["createElementVNode"])("strong",null,"Type:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.type),1)]),t[54]||(t[54]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[39]||(t[39]=Object(n["createElementVNode"])("strong",null,"Chapter:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.chapter_number||"N/A"),1)]),t[55]||(t[55]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[40]||(t[40]=Object(n["createElementVNode"])("strong",null,"Section:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.section_number||"N/A"),1)]),t[56]||(t[56]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[41]||(t[41]=Object(n["createElementVNode"])("strong",null,"Points:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.default_points),1)]),t[57]||(t[57]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("span",null,[t[42]||(t[42]=Object(n["createElementVNode"])("strong",null,"Estimated Time:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.est_time)+" minutes",1)]),t[58]||(t[58]=Object(n["createElementVNode"])("br",null,null,-1)),"True/False"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",al,[t[43]||(t[43]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.true_false_answer?"True":"False"),1)])):Object(n["createCommentVNode"])("",!0),"Multiple Choice"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ll,[t[44]||(t[44]=Object(n["createElementVNode"])("strong",null,"Correct Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.correct_option&&e.correct_option.option_text||"Not specified"),1),t[45]||(t[45]=Object(n["createElementVNode"])("br",null,null,-1)),t[46]||(t[46]=Object(n["createElementVNode"])("strong",null,"Other Options:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.incorrect_options||[],(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.option_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Matching"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",sl,[t[47]||(t[47]=Object(n["createElementVNode"])("strong",null,"Pairs:",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.matches||[],(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.prompt_text)+" - "+Object(n["toDisplayString"])(e.match_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Fill in the Blank"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",rl,[t[48]||(t[48]=Object(n["createElementVNode"])("strong",null,"Correct Answer(s):",-1)),Object(n["createElementVNode"])("ul",null,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.blanks||[],(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("li",{key:t},Object(n["toDisplayString"])(e.correct_text),1))),128))])])):Object(n["createCommentVNode"])("",!0),"Short Answer"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",il,[t[49]||(t[49]=Object(n["createElementVNode"])("strong",null,"Answer:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.answer||"Not provided"),1)])):Object(n["createCommentVNode"])("",!0),"Essay"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",dl,[t[50]||(t[50]=Object(n["createElementVNode"])("strong",null,"Essay Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.grading_instructions||"None"),1)])):Object(n["createCommentVNode"])("",!0),e.attachment&&e.attachment.url?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",bl,[t[51]||(t[51]=Object(n["createElementVNode"])("p",null,[Object(n["createElementVNode"])("strong",null,"Attached Image:")],-1)),Object(n["createElementVNode"])("img",{src:e.attachment.url,alt:"Question Attachment:",style:{"max-width":"100%","max-height":"400px","margin-bottom":"10px"}},null,8,ul)])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("span",null,[t[52]||(t[52]=Object(n["createElementVNode"])("strong",null,"Grading Instructions:",-1)),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.grading_instructions||"None"),1)]),a.selectedQuestionId===e.id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ml,[Object(n["createElementVNode"])("button",{onClick:Object(n["withModifiers"])(t=>l.promptRemoveQuestion(e.id),["stop"])},"Remove",8,pl)])):Object(n["createCommentVNode"])("",!0),t[59]||(t[59]=Object(n["createElementVNode"])("hr",null,null,-1))],10,cl))),128))])])}var Ol={name:"TeacherViewTB",data(){return{showPopup:!1,showEditForm:!1,showEditQuestionForm:!1,showCreateTestWarning:!1,testFiles:[],selectedQuestions:[],selectedQuestionId:null,editingQuestionData:{},editingQuestionId:null,courseId:this.$route.query.courseId||"",courseTitle:this.$route.query.courseTitle||"",testBankId:this.$route.query.testBankId||"",testBankName:this.$route.query.testBankName||"",editForm:{name:this.$route.query.testBankName||"",chapter:"",section:""},testOptions:{testName:"",coverPage:!1,selectedTemplate:"",graphicFile:null,graphicFileName:"",graphicPreview:""},showDeleteConfirm:!1,questionIdToDelete:null,popupMessage:"",showInfoPopup:!1}},computed:{displayChapter(){return this.editForm.chapter||this.$route.query.chapter||""},displaySection(){return this.editForm.section||this.$route.query.section||""}},mounted(){this.initialize()},methods:{promptRemoveQuestion(e){this.questionIdToDelete=e,this.showDeleteConfirm=!0},async confirmRemoveQuestion(){try{await F.delete(`/testbanks/${this.testBankId}/questions/${this.questionIdToDelete}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.selectedQuestions=this.selectedQuestions.filter(e=>e.id!==this.questionIdToDelete),this.questionIdToDelete=null,this.showDeleteConfirm=!1,this.popupMessage="Question removed from test bank.",this.showInfoPopup=!0}catch(e){console.error("Error removing question:",e),this.popupMessage="Failed to remove question from test bank.",this.showInfoPopup=!0}},async fetchQuestions(){if(this.testBankId)try{const e=await F.get(`/testbanks/${this.testBankId}/questions`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("Fetched questions:",e.data.questions),this.selectedQuestions=e.data.questions||[]}catch(e){console.error("Error fetching questions for test bank:",e),this.selectedQuestions=[]}},toggleQuestionSelection(e){this.selectedQuestionId=this.selectedQuestionId===e?null:e},async removeQuestionFromTestBank(e){if(confirm("Are you sure you want to remove this question from the test bank?"))try{await F.delete(`/testbanks/${this.testBankId}/questions/${e}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.selectedQuestions=this.selectedQuestions.filter(t=>t.id!==e)}catch(t){console.error("Error removing question:",t)}},async updateTestBank(){await F.put("/testbanks/teacher/"+this.testBankId,{name:this.editForm.name,chapter_number:this.editForm.chapter,section_number:this.editForm.section},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),this.testBankName=this.editForm.name,this.displayChapter=this.editForm.chapter,this.displaySection=this.editForm.section,this.showEditForm=!1},async initialize(){this.testBankId?await this.fetchQuestions():console.warn("No testBankId provided — cannot load questions.")},handleGraphicUpload(e){const t=e.target.files[0];if(!t)return;const o=new FileReader;o.onload=e=>{this.testOptions.graphicFile=t,this.testOptions.graphicFileName=t.name,this.testOptions.graphicPreview=e.target.result},o.readAsDataURL(t)},goToCreateTest(){const e={testName:this.testOptions.testName,selectedTemplate:this.testOptions.selectedTemplate,uploadedImage:this.testOptions.graphicFileName||"",coverPage:this.testOptions.coverPage||!1,graphicPreview:this.testOptions.graphicPreview||""};localStorage.setItem("testOptions",JSON.stringify(e)),this.$router.push({path:"/TeacherTemplate",query:{courseId:this.courseId,courseTitle:this.courseTitle,testBankId:this.testBankId,testBankName:this.testBankName}})}}};o("cfa6");const jl=r()(Ol,[["render",hl],["__scopeId","data-v-04519f3f"]]);var kl=jl;const gl={class:"theme-webmaster"},Nl={class:"top-banner"},El={class:"banner-actions"},yl={class:"center large-paragraph",style:{color:"#222"}},Vl={class:"button-row"};function fl(e,t,o,c,a,l){const s=Object(n["resolveComponent"])("router-link");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",gl,[Object(n["createElementVNode"])("div",Nl,[t[6]||(t[6]=Object(n["createElementVNode"])("div",{class:"banner-title"},"Database Downloads",-1)),Object(n["createElementVNode"])("div",El,[Object(n["createVNode"])(s,{to:"/",class:"banner-btn"},{default:Object(n["withCtx"])(()=>t[5]||(t[5]=[Object(n["createTextVNode"])("Log Out")])),_:1})])]),Object(n["createElementVNode"])("div",yl,[t[7]||(t[7]=Object(n["createElementVNode"])("p",null,"Select a dataset to download:",-1)),t[8]||(t[8]=Object(n["createElementVNode"])("p",null,"Note: Download All will download each file separately for readability.",-1)),Object(n["createElementVNode"])("div",Vl,[Object(n["createElementVNode"])("button",{class:"button",onClick:t[0]||(t[0]=e=>l.downloadData("users"))},"Download Users"),Object(n["createElementVNode"])("button",{class:"button",onClick:t[1]||(t[1]=e=>l.downloadData("textbook"))},"Download Textbooks"),Object(n["createElementVNode"])("button",{class:"button",onClick:t[2]||(t[2]=e=>l.downloadData("courses"))},"Download Courses"),Object(n["createElementVNode"])("button",{class:"button",onClick:t[3]||(t[3]=e=>l.downloadData("questions"))},"Download Questions"),Object(n["createElementVNode"])("button",{class:"button",onClick:t[4]||(t[4]=e=>l.downloadData("all"))},"Download All")])])])}var wl={name:"WebmasterHome",methods:{async downloadData(e){const t={users:"users",courses:"courses",textbook:"textbook",questions:"questions"};if("all"===e){for(const[e,o]of Object.entries(t))await this.fetchAndDownload(o,e+".csv");return}const o=t[e];o?await this.fetchAndDownload(o,e+".csv"):alert("Unsupported download type: "+e)},async fetchAndDownload(e,t){try{const o=await F.get("/download/"+e,{responseType:"blob"}),n=window.URL.createObjectURL(o.data),c=document.createElement("a");c.href=n,c.download=t,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(n)}catch(o){console.error(`Download error for ${e}:`,o)}}}};o("f16b");const Bl=r()(wl,[["render",fl],["__scopeId","data-v-498cf20f"]]);var vl=Bl;const Tl={class:"theme-webmaster"},_l={class:"center large-paragraph",style:{color:"#222"}},xl=["disabled"],Cl={key:0,class:"error-message"},Sl={key:1,class:"loading-message"};function Fl(e,t,o,c,a,l){return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Tl,[t[14]||(t[14]=Object(n["createElementVNode"])("div",{class:"top-banner"},[Object(n["createElementVNode"])("div",{class:"banner-title"},"Webmaster Login")],-1)),Object(n["createElementVNode"])("div",_l,[t[11]||(t[11]=Object(n["createTextVNode"])(" Please enter your webmaster username and password: ")),t[12]||(t[12]=Object(n["createElementVNode"])("br",null,null,-1)),t[13]||(t[13]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("form",{onSubmit:t[2]||(t[2]=Object(n["withModifiers"])((...e)=>l.submitForm&&l.submitForm(...e),["prevent"]))},[t[3]||(t[3]=Object(n["createElementVNode"])("label",{for:"uname"},"Username:",-1)),t[4]||(t[4]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",id:"uname","onUpdate:modelValue":t[0]||(t[0]=e=>a.username=e)},null,512),[[n["vModelText"],a.username]]),t[5]||(t[5]=Object(n["createElementVNode"])("br",null,null,-1)),t[6]||(t[6]=Object(n["createElementVNode"])("br",null,null,-1)),t[7]||(t[7]=Object(n["createElementVNode"])("label",{for:"pass"},"Password:",-1)),t[8]||(t[8]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"password",id:"pass","onUpdate:modelValue":t[1]||(t[1]=e=>a.password=e)},null,512),[[n["vModelText"],a.password]]),t[9]||(t[9]=Object(n["createElementVNode"])("br",null,null,-1)),t[10]||(t[10]=Object(n["createElementVNode"])("br",null,null,-1)),Object(n["createElementVNode"])("input",{type:"submit",value:"Submit",disabled:a.loading},null,8,xl)],32),a.errorMessage?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Cl,Object(n["toDisplayString"])(a.errorMessage),1)):Object(n["createCommentVNode"])("",!0),a.loading?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Sl,"Logging in...")):Object(n["createCommentVNode"])("",!0)])])}var Il={data(){return{username:"",password:"",errorMessage:"",loading:!1}},mounted(){const e=localStorage.getItem("token");if(e)try{const t=Object(I["default"])(e),o=Date.now()/1e3;t.exp>o&&"webmaster"===t.role&&this.$router.push("/WebmasterHome")}catch(t){console.error("Invalid token",t)}},methods:{async submitForm(){if(this.username&&this.password)if(this.username.trim().length<3||this.password.trim().length<6)this.errorMessage="Username must be at least 3 characters and password at least 6 characters.";else{this.loading=!0,this.errorMessage="";try{const e=await F.post("/auth/login",{username:this.username.toLowerCase(),password:this.password}),{token:t,user_id:o,role:n}=e.data;localStorage.setItem("token",t),localStorage.setItem("user_id",o),localStorage.setItem("role",n),"webmaster"===n?this.$router.push("/WebmasterHome"):(this.errorMessage="Only webmasters can log in here.",localStorage.clear())}catch(e){e.response?401===e.response.status?this.errorMessage="Invalid username or password.":this.errorMessage=e.response&&e.response.data&&e.response.data.message||"An error occurred during login.":this.errorMessage="Network error. Please check your connection."}finally{this.loading=!1}}else this.errorMessage="Please enter both username and password."}}};o("d941");const Dl=r()(Il,[["render",Fl],["__scopeId","data-v-2950ba08"]]);var ql=Dl;const Al=[{path:"/",name:"Welcome",component:g},{path:"/PubHome",name:"PubHome",component:A},{path:"/PubLog",name:"PubLog",component:H},{path:"/PubNewBook",name:"PubNewBook",component:ee},{path:"/PubNewTB",name:"PubNewTB",component:ie},{path:"/PubQuestions",name:"PubQuestions",component:nt},{path:"/PubViewFeedback",name:"PubViewFeedback",component:yt},{path:"/PubViewTB",name:"PubViewTB",component:Xt},{path:"/TeacherHome",name:"TeacherHome",component:fo},{path:"/TeacherLog",name:"TeacherLog",component:Fo},{path:"/TeacherNewClass",name:"TeacherNewClass",component:zo},{path:"/TeacherNewTB",name:"TeacherNewTB",component:Yo},{path:"/TeacherPubQ",name:"TeacherPubQ",component:zn},{path:"/TeacherQuestions",name:"TeacherQuestions",component:$c},{path:"/TeacherTemplate",name:"TeacherTemplate",component:qa},{path:"/TeacherViewTB/:id",name:"TeacherViewTB",component:kl},{path:"/WebmasterHome",name:"WebmasterHome",component:vl},{path:"/WebmasterLog",name:"WebmasterLog",component:ql}],Pl=Object(b["a"])({history:Object(b["b"])(),routes:Al});var Ql=Pl;const Ml=Object(n["createApp"])(d);Ml.use(Ql),Ml.mount("#app")},"5f50":function(e,t,o){"use strict";o("fb41")},6804:function(e,t,o){},"6a83":function(e,t,o){"use strict";o("0c21")},"72a1":function(e,t,o){"use strict";o("7c67")},7855:function(e,t,o){"use strict";o("4379")},"79aa":function(e,t,o){},"7c67":function(e,t,o){},"7ce1":function(e,t,o){},"8bca":function(e,t,o){"use strict";o("4ff5")},"8d2b":function(e,t,o){"use strict";o("5542")},"8fef":function(e,t,o){},a438:function(e,t,o){},ae62:function(e,t,o){"use strict";o("6804")},b458:function(e,t,o){},b7ca:function(e,t,o){"use strict";o("e6dc")},bb7c:function(e,t,o){},c3a9:function(e,t,o){},c4f7:function(e,t,o){"use strict";o("b458")},c88a:function(e,t,o){"use strict";o("bb7c")},cfa6:function(e,t,o){"use strict";o("8fef")},d941:function(e,t,o){"use strict";o("e54d")},e54d:function(e,t,o){},e6dc:function(e,t,o){},f16b:function(e,t,o){"use strict";o("167d")},fa7e:function(e,t,o){"use strict";o("c3a9")},fb41:function(e,t,o){}});
//# sourceMappingURL=app.eb286eed.js.map